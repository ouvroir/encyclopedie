function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}!function(e){var t={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ő":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ű":"U","Ý":"Y","Þ":"TH","ß":"ss","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ő":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ű":"u","ý":"y","þ":"th","ÿ":"y","ẞ":"SS","Α":"A","Β":"B","Γ":"G","Δ":"D","Ε":"E","Ζ":"Z","Η":"H","Θ":"8","Ι":"I","Κ":"K","Λ":"L","Μ":"M","Ν":"N","Ξ":"3","Ο":"O","Π":"P","Ρ":"R","Σ":"S","Τ":"T","Υ":"Y","Φ":"F","Χ":"X","Ψ":"PS","Ω":"W","Ά":"A","Έ":"E","Ί":"I","Ό":"O","Ύ":"Y","Ή":"H","Ώ":"W","Ϊ":"I","Ϋ":"Y","α":"a","β":"b","γ":"g","δ":"d","ε":"e","ζ":"z","η":"h","θ":"8","ι":"i","κ":"k","λ":"l","μ":"m","ν":"n","ξ":"3","ο":"o","π":"p","ρ":"r","σ":"s","τ":"t","υ":"y","φ":"f","χ":"x","ψ":"ps","ω":"w","ά":"a","έ":"e","ί":"i","ό":"o","ύ":"y","ή":"h","ώ":"w","ς":"s","ϊ":"i","ΰ":"y","ϋ":"y","ΐ":"i","Ş":"S","İ":"I","Ğ":"G","ş":"s","ı":"i","ğ":"g","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"Yo","Ж":"Zh","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"Ch","Ш":"Sh","Щ":"Sh","Ъ":"U","Ы":"Y","Ь":"","Э":"E","Ю":"Yu","Я":"Ya","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"u","ы":"y","ь":"","э":"e","ю":"yu","я":"ya","Є":"Ye","І":"I","Ї":"Yi","Ґ":"G","є":"ye","і":"i","ї":"yi","ґ":"g","Č":"C","Ď":"D","Ě":"E","Ň":"N","Ř":"R","Š":"S","Ť":"T","Ů":"U","Ž":"Z","č":"c","ď":"d","ě":"e","ň":"n","ř":"r","š":"s","ť":"t","ů":"u","ž":"z","Ą":"A","Ć":"C","Ę":"e","Ł":"L","Ń":"N","Ś":"S","Ź":"Z","Ż":"Z","ą":"a","ć":"c","ę":"e","ł":"l","ń":"n","ś":"s","ź":"z","ż":"z","Ā":"A","Ē":"E","Ģ":"G","Ī":"i","Ķ":"k","Ļ":"L","Ņ":"N","Ū":"u","ā":"a","ē":"e","ģ":"g","ī":"i","ķ":"k","ļ":"l","ņ":"n","ū":"u","€":"euro","₢":"cruzeiro","₣":"french franc","£":"pound","₤":"lira","₥":"mill","₦":"naira","₧":"peseta","₨":"rupee","₩":"won","₪":"new shequel","₫":"dong","₭":"kip","₮":"tugrik","₯":"drachma","₰":"penny","₱":"peso","₲":"guarani","₳":"austral","₴":"hryvnia","₵":"cedi","¢":"cent","¥":"yen","元":"yuan","円":"yen","﷼":"rial","₠":"ecu","¤":"currency","฿":"baht",$:"dollar","₹":"indian rupee","©":"(c)","œ":"oe","Œ":"OE","∑":"sum","®":"(r)","†":"+","“":'"',"”":'"',"‘":"'","’":"'","∂":"d","ƒ":"f","™":"tm","℠":"sm","…":"...","˚":"o","º":"o","ª":"a","•":"*","∆":"delta","∞":"infinity","♥":"love","&":"and","|":"or","<":"less",">":"greater"},i=Object.keys(t).map(function(e){return e.replace(/[\|\$]/g,"\\$&")}).join("|"),n=new RegExp("("+i+")","g");e.unicodeNormalizer=function(e){return e.replace(n,function(e){return t[e]})}}(this),function(e){var t={},i=navigator.userAgent;t.history=(-1===i.indexOf("Android 2.")&&-1===i.indexOf("Android 4.0")||-1===i.indexOf("Mobile Safari")||-1!==i.indexOf("Chrome")||-1!==i.indexOf("Windows Phone")||"file:"===location.protocol)&&window.history&&"pushState"in window.history&&"replaceState"in window.history,e.support=t,e.testCSS=function(e){for(var t,i=(e=-1!=e.indexOf("-")?e.replace(/([a-z])-([a-z])/g,function(e,t,i){return t+i.toUpperCase()}).replace(/^-/,""):e).charAt(0).toUpperCase()+e.slice(1),n=(e+" "+"Moz O ms Webkit".split(" ").join(i+" ")+i).split(" "),r=document.createElement("a"),o=n.length,s=0;s<o;s++)if(t=n[s],void 0!==r.style[t])return t;return!1}}(this),function(){function e(){}for(var t,i=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],n=i.length,r=window.console=window.console||{};n--;)r[t=i[n]]||(r[t]=e)}(),function(e){e.matches=e.matches||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=this,i=(t.document||t.ownerDocument).querySelectorAll(e),n=0;i[n]&&i[n]!==t;)++n;return!!i[n]},e.closest=e.closest||function(e){for(var t=this;t&&!t.matches(e);)t=t.parentElement;return t}}(Element.prototype),function(e){e.remove=e.remove||function(){this.parentNode&&this.parentNode.removeChild(this)}}(Element.prototype),[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty("prepend")||Object.defineProperty(e,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),i=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;i.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(i,this.firstChild)}})}),[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),i=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;i.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(i)}})}),[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("before")||Object.defineProperty(e,"before",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),i=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;i.appendChild(t?e:document.createTextNode(String(e)))}),this.parentNode.insertBefore(i,this)}})}),[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("after")||Object.defineProperty(e,"after",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),i=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;i.appendChild(t?e:document.createTextNode(String(e)))}),this.parentNode.insertBefore(i,this.nextSibling)}})}),window.lazySizesConfig=window.lazySizesConfig||{},window.lazySizesConfig.expand=200,window.lazySizesConfig.loadHidden=!1,function(e){var t=function(n,d,o){"use strict";var p,g,m,F,r,f,e,h,H,s,A,N,i,M,a,c,u,v,y,w,x,j,T,t,W,U,l,S,V,G,q,E,b,Q,_,Z,$,X,P,C,R,k,Y,K,J,ee,te,D,ie,ne,re,oe,O,I,L,se,z,ae,le,he,B,ce,ue,de,pe,ge,me,fe,ve={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};for(fe in g=n.lazySizesConfig||n.lazysizesConfig||{},ve)fe in g||(g[fe]=ve[fe]);return d&&d.getElementsByClassName?(m=d.documentElement,F=n.HTMLPictureElement,f="getAttribute",e=n[r="addEventListener"].bind(n),h=n.setTimeout,H=n.requestAnimationFrame||h,s=n.requestIdleCallback,A=/^picture$/i,N=["load","error","lazyincluded","_lazyloaded"],i={},M=Array.prototype.forEach,a=function(e,t){return i[t]||(i[t]=new RegExp("(\\s|^)"+t+"(\\s|$)")),i[t].test(e[f]("class")||"")&&i[t]},c=function(e,t){a(e,t)||e.setAttribute("class",(e[f]("class")||"").trim()+" "+t)},u=function(e,t){(t=a(e,t))&&e.setAttribute("class",(e[f]("class")||"").replace(t," "))},v=function(t,i,e){var n=e?r:"removeEventListener";e&&v(t,i),N.forEach(function(e){t[n](e,i)})},y=function(e,t,i,n,r){var o=d.createEvent("Event");return(i=i||{}).instance=p,o.initEvent(t,!n,!r),o.detail=i,e.dispatchEvent(o),o},w=function(e,t){var i;!F&&(i=n.picturefill||g.pf)?(t&&t.src&&!e[f]("srcset")&&e.setAttribute("srcset",t.src),i({reevaluate:!0,elements:[e]})):t&&t.src&&(e.src=t.src)},x=function(e,t){return(getComputedStyle(e,null)||{})[t]},j=function(e,t,i){for(i=i||e.offsetWidth;i<g.minSize&&t&&!e._lazysizesWidth;)i=t.offsetWidth,t=t.parentNode;return i},ge=[],me=pe=[],Ce._lsFlush=Pe,T=Ce,t=function(i,e){return e?function(){T(i)}:function(){var e=this,t=arguments;T(function(){i.apply(e,t)})}},W=function(e){function t(){var e=o.now()-n;e<99?h(t,99-e):(s||r)(r)}var i,n,r=function(){i=null,e()};return function(){n=o.now(),i=i||h(t,99)}},ne=/^img$/i,re=/^iframe$/i,oe="onscroll"in n&&!/(gle|ing)bot/.test(navigator.userAgent),L=-1,se=function(e){return(Y=null==Y?"hidden"==x(d.body,"visibility"):Y)||!("hidden"==x(e.parentNode,"visibility")&&"hidden"==x(e,"visibility"))},K=xe,ee=I=O=0,te=g.throttleDelay,D=g.ricTimeout,ie=s&&49<D?function(){s(Te,{timeout:D}),D!==g.ricTimeout&&(D=g.ricTimeout)}:t(function(){h(Te)},!0),ae=t(Se),le=function(e){ae({target:e.target})},he=t(function(t,i,e,n,r){var o,s,a;if(!(s=y(t,"lazybeforeunveil",i)).defaultPrevented){if(n&&(e?c(t,g.autosizesClass):t.setAttribute("sizes",n)),e=t[f](g.srcsetAttr),n=t[f](g.srcAttr),r&&(o=(l=t.parentNode)&&A.test(l.nodeName||"")),a=i.firesLoad||"src"in t&&(e||n||o),s={target:t},c(t,g.loadingClass),a&&(clearTimeout(Q),Q=h(we,2500),v(t,le,!0)),o&&M.call(l.getElementsByTagName("source"),Ee),e)t.setAttribute("srcset",e);else if(n&&!o)if(re.test(t.nodeName)){var i=t,l=n;try{i.contentWindow.location.replace(l)}catch(e){i.src=l}}else t.src=n;r&&(e||o)&&w(t,{src:n})}t._lazyRace&&delete t._lazyRace,u(t,g.lazyClass),T(function(){var e=t.complete&&1<t.naturalWidth;a&&!e||(e&&c(t,"ls-is-cached"),Se(s),t._lazyCache=!0,h(function(){"_lazyCache"in t&&delete t._lazyCache},9)),"lazy"==t.loading&&I--},!0)}),ce=W(function(){g.loadMode=3,z()}),U={_:function(){Z=o.now(),p.elements=d.getElementsByClassName(g.lazyClass),E=d.getElementsByClassName(g.lazyClass+" "+g.preloadClass),e("scroll",z,!0),e("resize",z,!0),e("pageshow",function(e){var t;e.persisted&&(t=d.querySelectorAll("."+g.loadingClass)).length&&t.forEach&&H(function(){t.forEach(function(e){e.complete&&B(e)})})}),n.MutationObserver?new MutationObserver(z).observe(m,{childList:!0,subtree:!0,attributes:!0}):(m[r]("DOMNodeInserted",z,!0),m[r]("DOMAttrModified",z,!0),setInterval(z,999)),e("hashchange",z,!0),["focus","mouseover","click","load","transitionend","animationend"].forEach(function(e){d[r](e,z,!0)}),/d$|^c/.test(d.readyState)?_e():(e("load",_e),d[r]("DOMContentLoaded",z),h(_e,2e4)),p.elements.length?(xe(),T._lsFlush()):z()},checkElems:z=function(e){var t;(e=!0===e)&&(D=33),J||(J=!0,(t=te-(o.now()-ee))<0&&(t=0),e||t<9?ie():h(ie,t))},unveil:B=function(e){var t,i,n,r;e._lazyRace||!(!(r="auto"==(n=(i=ne.test(e.nodeName))&&(e[f](g.sizesAttr)||e[f]("sizes"))))&&b||!i||!e[f]("src")&&!e.srcset||e.complete||a(e,g.errorClass))&&a(e,g.lazyClass)||(t=y(e,"lazyunveilread").detail,r&&l.updateElem(e,!0,e.offsetWidth),e._lazyRace=!0,I++,he(e,t,r,n,i))},_aLSL:be},G=t(function(e,t,i,n){var r,o,s;if(e._lazysizesWidth=n,e.setAttribute("sizes",n+="px"),A.test(t.nodeName||""))for(o=0,s=(r=t.getElementsByTagName("source")).length;o<s;o++)r[o].setAttribute("sizes",n);i.detail.dataAttr||w(e,i.detail)}),l={_:function(){V=d.getElementsByClassName(g.autosizesClass),e("resize",q)},checkElems:q=W(function(){var e,t=V.length;if(t)for(e=0;e<t;e++)ye(V[e])}),updateElem:ye},S=function(){!S.i&&d.getElementsByClassName&&(S.i=!0,l._(),U._())},h(function(){g.init&&S()}),p={cfg:g,autoSizer:l,loader:U,init:S,uP:w,aC:c,rC:u,hC:a,fire:y,gW:j,rAF:T}):{init:function(){},cfg:g,noSupport:!0};function ye(e,t,i){var n=e.parentNode;n&&(i=j(e,n,i),(t=y(e,"lazybeforesizes",{width:i,dataAttr:!!t})).defaultPrevented||(i=t.detail.width)&&i!==e._lazysizesWidth&&G(e,n,t,i))}function we(e){I--,e&&!(I<0)&&e.target||(I=0)}function xe(){var e,t,i,n,r,o,s,a,l,h,c,u=p.elements;if((_=g.loadMode)&&I<8&&(e=u.length)){for(t=0,L++;t<e;t++)if(u[t]&&!u[t]._lazyRace)if(!oe||p.prematureUnveil&&p.prematureUnveil(u[t]))B(u[t]);else if((s=u[t][f]("data-expand"))&&(r=+s)||(r=O),l||(l=!g.expand||g.expand<1?500<m.clientHeight&&500<m.clientWidth?500:370:g.expand,h=(p._defEx=l)*g.expFactor,c=g.hFac,Y=null,O<h&&I<1&&2<L&&2<_&&!d.hidden?(O=h,L=0):O=1<_&&1<L&&I<6?l:0),a!==r&&($=innerWidth+r*c,X=innerHeight+r,o=-1*r,a=r),h=u[t].getBoundingClientRect(),(k=h.bottom)>=o&&(P=h.top)<=X&&(R=h.right)>=o*c&&(C=h.left)<=$&&(k||R||C||P)&&(g.loadHidden||se(u[t]))&&(b&&I<3&&!s&&(_<3||L<4)||function(e,t){var i,n=e,r=se(e);for(P-=t,k+=t,C-=t,R+=t;r&&(n=n.offsetParent)&&n!=d.body&&n!=m;)(r=0<(x(n,"opacity")||1))&&"visible"!=x(n,"overflow")&&(i=n.getBoundingClientRect(),r=R>i.left&&C<i.right&&k>i.top-1&&P<i.bottom+1);return r}(u[t],r))){if(B(u[t]),n=!0,9<I)break}else!n&&b&&!i&&I<4&&L<4&&2<_&&(E[0]||g.preloadAfterLoad)&&(E[0]||!s&&(k||R||C||P||"auto"!=u[t][f](g.sizesAttr)))&&(i=E[0]||u[t]);i&&!n&&B(i)}}function Te(){J=!1,ee=o.now(),K()}function Se(e){var t=e.target;t._lazyCache?delete t._lazyCache:(we(e),c(t,g.loadedClass),u(t,g.loadingClass),v(t,le),y(t,"lazyloaded"))}function Ee(e){var t,i=e[f](g.srcsetAttr);(t=g.customMedia[e[f]("data-media")||e[f]("media")])&&e.setAttribute("media",t),i&&e.setAttribute("srcset",i)}function be(){3==g.loadMode&&(g.loadMode=2),ce()}function _e(){b||(o.now()-Z<999?h(_e,999):(b=!0,g.loadMode=3,z(),e("scroll",be,!0)))}function Pe(){var e=me;for(me=pe.length?ge:pe,de=!(ue=!0);e.length;)e.shift()();ue=!1}function Ce(e,t){ue&&!t?e.apply(this,arguments):(me.push(e),de||(de=!0,(d.hidden?h:H)(Pe)))}}(e,e.document,Date);e.lazySizes=t,"object"==typeof module&&module.exports&&(module.exports=t)}("undefined"!=typeof window?window:{}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("whatInput",[],t):"object"==typeof exports?exports.whatInput=t():e.whatInput=t()}(this,function(){return r={},i.m=n=[function(e,t){"use strict";e.exports=function(){if("undefined"==typeof document||"undefined"==typeof window)return{ask:function(){return"initial"},element:function(){return null},ignoreKeys:function(){},specificKeys:function(){},registerOnChange:function(){},unRegisterOnChange:function(){}};var r=document.documentElement,t=null,o="initial",s=o,i=Date.now(),n="false",a=["button","input","select","textarea"],l=[],h=[16,17,18,91,93],c=[],u={keydown:"keyboard",keyup:"keyboard",mousedown:"mouse",mousemove:"mouse",MSPointerDown:"pointer",MSPointerMove:"pointer",pointerdown:"pointer",pointermove:"pointer",touchstart:"touch",touchend:"touch"},d=!1,p={x:null,y:null},g={2:"touch",3:"touch",4:"mouse"},e=!1;try{var m=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,m)}catch(m){}function f(){if(n=!(r.getAttribute("data-whatpersist")||"false"===document.body.getAttribute("data-whatpersist")))try{window.sessionStorage.getItem("what-input")&&(o=window.sessionStorage.getItem("what-input")),window.sessionStorage.getItem("what-intent")&&(s=window.sessionStorage.getItem("what-intent"))}catch(e){}S("input"),S("intent")}function v(e){var t=e.which,i=u[e.type],e=("pointer"===i&&(i=_(e)),!c.length&&-1===h.indexOf(t)),n=c.length&&-1!==c.indexOf(t),t="keyboard"===i&&t&&(e||n)||"mouse"===i||"touch"===i;(t=P(i)?!1:t)&&o!==i&&(b("input",o=i),S("input")),t&&s!==i&&(e=document.activeElement)&&e.nodeName&&(-1===a.indexOf(e.nodeName.toLowerCase())||"button"===e.nodeName.toLowerCase()&&!R(e,"form"))&&(b("intent",s=i),S("intent"))}function y(e){var t=u[e.type];"pointer"===t&&(t=_(e)),C(e),(!d&&!P(t)||d&&"wheel"===e.type||"mousewheel"===e.type||"DOMMouseScroll"===e.type)&&s!==t&&(b("intent",s=t),S("intent"))}function w(e){e.target.nodeName?(t=e.target.nodeName.toLowerCase(),r.setAttribute("data-whatelement",t),e.target.classList&&e.target.classList.length&&r.setAttribute("data-whatclasses",e.target.classList.toString().replace(" ",","))):E()}function x(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"}var T,S=function(e){r.setAttribute("data-what"+e,"input"===e?o:s);for(var t=e,i=0,n=l.length;i<n;i++)l[i].type===t&&l[i].fn.call(void 0,"input"===t?o:s)},E=function(){t=null,r.removeAttribute("data-whatelement"),r.removeAttribute("data-whatclasses")},b=function(e,t){if(n)try{window.sessionStorage.setItem("what-"+e,t)}catch(e){}},_=function(e){return"number"==typeof e.pointerType?g[e.pointerType]:"pen"===e.pointerType?"touch":e.pointerType},P=function(e){var t=Date.now(),e="mouse"===e&&"touch"===o&&t-i<200;return i=t,e},C=function(e){p.x!==e.screenX||p.y!==e.screenY?(d=!1,p.x=e.screenX,p.y=e.screenY):d=!0},R=function(e,t){var i=window.Element.prototype;if(i.matches||(i.matches=i.msMatchesSelector||i.webkitMatchesSelector),i.closest)return e.closest(t);do{if(e.matches(t))return e}while(null!==(e=e.parentElement||e.parentNode)&&1===e.nodeType);return null};return"addEventListener"in window&&Array.prototype.indexOf&&(u[x()]="mouse",T=!!e&&{passive:!0},document.addEventListener("DOMContentLoaded",f),window.PointerEvent?(window.addEventListener("pointerdown",v),window.addEventListener("pointermove",y)):window.MSPointerEvent?(window.addEventListener("MSPointerDown",v),window.addEventListener("MSPointerMove",y)):(window.addEventListener("mousedown",v),window.addEventListener("mousemove",y),"ontouchstart"in window&&(window.addEventListener("touchstart",v,T),window.addEventListener("touchend",v))),window.addEventListener(x(),y,T),window.addEventListener("keydown",v),window.addEventListener("keyup",v),window.addEventListener("focusin",w),window.addEventListener("focusout",E)),{ask:function(e){return"intent"===e?s:o},element:function(){return t},ignoreKeys:function(e){h=e},specificKeys:function(e){c=e},registerOnChange:function(e,t){l.push({fn:e,type:t||"input"})},unRegisterOnChange:function(e){e=function(e){for(var t=0,i=l.length;t<i;t++)if(l[t].fn===e)return t}(e);!e&&0!==e||l.splice(e,1)},clearStorage:function(){window.sessionStorage.clear()}}}()}],i.c=r,i.p="",i(0);function i(e){var t;return(r[e]||(t=r[e]={exports:{},id:e,loaded:!1},n[e].call(t.exports,t,t.exports,i),t.loaded=!0,t)).exports}var n,r}),function(){function H(e){var t=new H.Builder;return t.pipeline.add(H.trimmer,H.stopWordFilter,H.stemmer),t.searchPipeline.add(H.stemmer),e.call(t,t),t.build()}var t,h,c,u,d,p,g,m,f,v,y,w,x,T,S,E,b,_,P,C,R,k,D,e,i;function n(e){var t,i,n,r,o,s,a,l;return e.length<3||("y"==(l=e.substr(0,1))&&(e=l.toUpperCase()+e.substr(1)),s=f,(r=m).test(e)?e=e.replace(r,"$1$2"):s.test(e)&&(e=e.replace(s,"$1$2")),s=y,(r=v).test(e)?(a=r.exec(e),(r=u).test(a[1])&&(e=e.replace(r=w,""))):s.test(e)&&(o=(a=s.exec(e))[1],(s=g).test(o))&&(e=o,i=T,n=S,(s=x).test(e)?e+="e":i.test(e)?e=e.replace(r=w,""):n.test(e)&&(e+="e")),(r=E).test(e)&&(e=(o=(a=r.exec(e))[1])+"i"),(r=b).test(e)&&(o=(a=r.exec(e))[1],t=a[2],(r=u).test(o))&&(e=o+h[t]),(r=_).test(e)&&(o=(a=r.exec(e))[1],t=a[2],(r=u).test(o))&&(e=o+c[t]),s=C,(r=P).test(e)?(o=(a=r.exec(e))[1],(r=d).test(o)&&(e=o)):s.test(e)&&(o=(a=s.exec(e))[1]+a[2],(s=d).test(o))&&(e=o),(r=R).test(e)&&(o=(a=r.exec(e))[1],s=p,i=D,(r=d).test(o)||s.test(o)&&!i.test(o))&&(e=o),s=d,(r=k).test(e)&&s.test(e)&&(e=e.replace(r=w,"")),"y"==l&&(e=l.toLowerCase()+e.substr(1))),e}H.version="2.3.9",(H.utils={}).warn=(t=this,function(e){t.console&&console.warn&&console.warn(e)}),H.utils.asString=function(e){return null==e?"":e.toString()},H.utils.clone=function(e){if(null==e)return e;for(var t=Object.create(null),i=Object.keys(e),n=0;n<i.length;n++){var r=i[n],o=e[r];if(Array.isArray(o))t[r]=o.slice();else{if("string"!=typeof o&&"number"!=typeof o&&"boolean"!=typeof o)throw new TypeError("clone is not deep and does not support nested objects");t[r]=o}}return t},(H.FieldRef=function(e,t,i){this.docRef=e,this.fieldName=t,this._stringValue=i}).joiner="/",H.FieldRef.fromString=function(e){var t=e.indexOf(H.FieldRef.joiner);if(-1===t)throw"malformed field ref string";var i=e.slice(0,t),t=e.slice(t+1);return new H.FieldRef(t,i,e)},H.FieldRef.prototype.toString=function(){return null==this._stringValue&&(this._stringValue=this.fieldName+H.FieldRef.joiner+this.docRef),this._stringValue},(H.Set=function(e){if(this.elements=Object.create(null),e){this.length=e.length;for(var t=0;t<this.length;t++)this.elements[e[t]]=!0}else this.length=0}).complete={intersect:function(e){return e},union:function(){return this},contains:function(){return!0}},H.Set.empty={intersect:function(){return this},union:function(e){return e},contains:function(){return!1}},H.Set.prototype.contains=function(e){return!!this.elements[e]},H.Set.prototype.intersect=function(e){var t,i=[];if(e===H.Set.complete)return this;if(e===H.Set.empty)return e;for(var n=this.length<e.length?(t=this,e):(t=e,this),r=Object.keys(t.elements),o=0;o<r.length;o++){var s=r[o];s in n.elements&&i.push(s)}return new H.Set(i)},H.Set.prototype.union=function(e){return e===H.Set.complete?H.Set.complete:e===H.Set.empty?this:new H.Set(Object.keys(this.elements).concat(Object.keys(e.elements)))},H.idf=function(e,t){var i,n=0;for(i in e)"_index"!=i&&(n+=Object.keys(e[i]).length);return Math.log(1+Math.abs((t-n+.5)/(n+.5)))},(H.Token=function(e,t){this.str=e||"",this.metadata=t||{}}).prototype.toString=function(){return this.str},H.Token.prototype.update=function(e){return this.str=e(this.str,this.metadata),this},H.Token.prototype.clone=function(e){return new H.Token((e=e||function(e){return e})(this.str,this.metadata),this.metadata)},(H.tokenizer=function(e,t){if(null==e)return[];if(Array.isArray(e))return e.map(function(e){return new H.Token(unicodeNormalizer(H.utils.asString(e)).toLowerCase(),H.utils.clone(t))});for(var i=unicodeNormalizer(e.toString()).toLowerCase(),n=i.length,r=[],o=0,s=0;o<=n;o++){var a,l=o-s;!i.charAt(o).match(H.tokenizer.separator)&&o!=n||(0<l&&((a=H.utils.clone(t)||{}).position=[s,l],a.index=r.length,r.push(new H.Token(i.slice(s,o),a))),s=o+1)}return r}).separator=/[\s\-]+/,(H.Pipeline=function(){this._stack=[]}).registeredFunctions=Object.create(null),H.Pipeline.registerFunction=function(e,t){t in this.registeredFunctions&&H.utils.warn("Overwriting existing registered function: "+t),e.label=t,H.Pipeline.registeredFunctions[e.label]=e},H.Pipeline.warnIfFunctionNotRegistered=function(e){e.label&&e.label in this.registeredFunctions||H.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",e)},H.Pipeline.load=function(e){var i=new H.Pipeline;return e.forEach(function(e){var t=H.Pipeline.registeredFunctions[e];if(!t)throw new Error("Cannot load unregistered function: "+e);i.add(t)}),i},H.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(e){H.Pipeline.warnIfFunctionNotRegistered(e),this._stack.push(e)},this)},H.Pipeline.prototype.after=function(e,t){H.Pipeline.warnIfFunctionNotRegistered(t);e=this._stack.indexOf(e);if(-1==e)throw new Error("Cannot find existingFn");this._stack.splice(e+=1,0,t)},H.Pipeline.prototype.before=function(e,t){H.Pipeline.warnIfFunctionNotRegistered(t);e=this._stack.indexOf(e);if(-1==e)throw new Error("Cannot find existingFn");this._stack.splice(e,0,t)},H.Pipeline.prototype.remove=function(e){e=this._stack.indexOf(e);-1!=e&&this._stack.splice(e,1)},H.Pipeline.prototype.run=function(e){for(var t=this._stack.length,i=0;i<t;i++){for(var n=this._stack[i],r=[],o=0;o<e.length;o++){var s=n(e[o],o,e);if(null!=s&&""!==s)if(Array.isArray(s))for(var a=0;a<s.length;a++)r.push(s[a]);else r.push(s)}e=r}return e},H.Pipeline.prototype.runString=function(e,t){e=new H.Token(e,t);return this.run([e]).map(function(e){return e.toString()})},H.Pipeline.prototype.reset=function(){this._stack=[]},H.Pipeline.prototype.toJSON=function(){return this._stack.map(function(e){return H.Pipeline.warnIfFunctionNotRegistered(e),e.label})},(H.Vector=function(e){this._magnitude=0,this.elements=e||[]}).prototype.positionForIndex=function(e){if(0==this.elements.length)return 0;for(var t=0,i=this.elements.length/2,n=i-t,r=Math.floor(n/2),o=this.elements[2*r];1<n&&(o<e&&(t=r),e<o&&(i=r),o!=e);)n=i-t,r=t+Math.floor(n/2),o=this.elements[2*r];return o==e||e<o?2*r:o<e?2*(r+1):void 0},H.Vector.prototype.insert=function(e,t){this.upsert(e,t,function(){throw"duplicate index"})},H.Vector.prototype.upsert=function(e,t,i){this._magnitude=0;var n=this.positionForIndex(e);this.elements[n]==e?this.elements[n+1]=i(this.elements[n+1],t):this.elements.splice(n,0,e,t)},H.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var e=0,t=this.elements.length,i=1;i<t;i+=2){var n=this.elements[i];e+=n*n}return this._magnitude=Math.sqrt(e)},H.Vector.prototype.dot=function(e){for(var t,i,n=0,r=this.elements,o=e.elements,s=r.length,a=o.length,l=0,h=0;l<s&&h<a;)(t=r[l])<(i=o[h])?l+=2:i<t?h+=2:t==i&&(n+=r[l+1]*o[h+1],l+=2,h+=2);return n},H.Vector.prototype.similarity=function(e){return this.dot(e)/this.magnitude()||0},H.Vector.prototype.toArray=function(){for(var e=new Array(this.elements.length/2),t=1,i=0;t<this.elements.length;t+=2,i++)e[i]=this.elements[t];return e},H.Vector.prototype.toJSON=function(){return this.elements},h={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},c={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},i="[aeiouy]",e="[^aeiou][^aeiouy]*",u=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*"),d=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*"),p=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$"),g=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy]"),m=/^(.+?)(ss|i)es$/,f=/^(.+?)([^s])s$/,v=/^(.+?)eed$/,y=/^(.+?)(ed|ing)$/,w=/.$/,x=/(at|bl|iz)$/,T=new RegExp("([^aeiouylsz])\\1$"),S=new RegExp("^"+e+i+"[^aeiouwxy]$"),E=/^(.+?[^aeiou])y$/,b=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,_=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,P=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,C=/^(.+?)(s|t)(ion)$/,R=/^(.+?)e$/,k=/ll$/,D=new RegExp("^"+e+i+"[^aeiouwxy]$"),H.Pipeline.registerFunction(H.stemmer=function(e){return e.update(n)},"stemmer"),H.stopWordFilter=(H.generateStopWordFilter=function(e){var t=e.reduce(function(e,t){return e[t]=t,e},{});return function(e){if(e&&t[e.toString()]!==e.toString())return e}})(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]),H.Pipeline.registerFunction(H.stopWordFilter,"stopWordFilter"),H.Pipeline.registerFunction(H.trimmer=function(e){return e.update(function(e){return e.replace(/^\W+/,"").replace(/\W+$/,"")})},"trimmer"),(H.TokenSet=function(){this.final=!1,this.edges={},this.id=H.TokenSet._nextId,H.TokenSet._nextId+=1})._nextId=1,H.TokenSet.fromArray=function(e){for(var t=new H.TokenSet.Builder,i=0,n=e.length;i<n;i++)t.insert(e[i]);return t.finish(),t.root},H.TokenSet.fromClause=function(e){return"editDistance"in e?H.TokenSet.fromFuzzyString(e.term,e.editDistance):H.TokenSet.fromString(e.term)},H.TokenSet.fromFuzzyString=function(e,t){for(var i=new H.TokenSet,n=[{node:i,editsRemaining:t,str:e}];n.length;){var r,o,s,a,l,h,c=n.pop();0<c.str.length&&((a=c.str.charAt(0))in c.node.edges?r=c.node.edges[a]:(r=new H.TokenSet,c.node.edges[a]=r),1==c.str.length&&(r.final=!0),n.push({node:r,editsRemaining:c.editsRemaining,str:c.str.slice(1)})),0!=c.editsRemaining&&("*"in c.node.edges?o=c.node.edges["*"]:(o=new H.TokenSet,c.node.edges["*"]=o),0==c.str.length&&(o.final=!0),n.push({node:o,editsRemaining:c.editsRemaining-1,str:c.str}),1<c.str.length&&n.push({node:c.node,editsRemaining:c.editsRemaining-1,str:c.str.slice(1)}),1==c.str.length&&(c.node.final=!0),1<=c.str.length&&("*"in c.node.edges?s=c.node.edges["*"]:(s=new H.TokenSet,c.node.edges["*"]=s),1==c.str.length&&(s.final=!0),n.push({node:s,editsRemaining:c.editsRemaining-1,str:c.str.slice(1)})),1<c.str.length)&&(a=c.str.charAt(0),(l=c.str.charAt(1))in c.node.edges?h=c.node.edges[l]:(h=new H.TokenSet,c.node.edges[l]=h),1==c.str.length&&(h.final=!0),n.push({node:h,editsRemaining:c.editsRemaining-1,str:a+c.str.slice(2)}))}return i},H.TokenSet.fromString=function(e){for(var t=new H.TokenSet,i=t,n=0,r=e.length;n<r;n++){var o,s=e[n],a=n==r-1;"*"==s?(t.edges[s]=t).final=a:((o=new H.TokenSet).final=a,t.edges[s]=o,t=o)}return i},H.TokenSet.prototype.toArray=function(){for(var e=[],t=[{prefix:"",node:this}];t.length;){var i=t.pop(),n=Object.keys(i.node.edges),r=n.length;i.node.final&&(i.prefix.charAt(0),e.push(i.prefix));for(var o=0;o<r;o++){var s=n[o];t.push({prefix:i.prefix.concat(s),node:i.node.edges[s]})}}return e},H.TokenSet.prototype.toString=function(){if(this._str)return this._str;for(var e=this.final?"1":"0",t=Object.keys(this.edges).sort(),i=t.length,n=0;n<i;n++)var r=t[n],e=e+r+this.edges[r].id;return e},H.TokenSet.prototype.intersect=function(e){for(var t=new H.TokenSet,i=void 0,n=[{qNode:e,output:t,node:this}];n.length;)for(var i=n.pop(),r=Object.keys(i.qNode.edges),o=r.length,s=Object.keys(i.node.edges),a=s.length,l=0;l<o;l++)for(var h=r[l],c=0;c<a;c++){var u,d,p,g,m=s[c];m!=h&&"*"!=h||(u=i.node.edges[m],d=i.qNode.edges[h],p=u.final&&d.final,g=void 0,m in i.output.edges?(g=i.output.edges[m]).final=g.final||p:((g=new H.TokenSet).final=p,i.output.edges[m]=g),n.push({qNode:d,output:g,node:u}))}return t},H.TokenSet.Builder=function(){this.previousWord="",this.root=new H.TokenSet,this.uncheckedNodes=[],this.minimizedNodes={}},H.TokenSet.Builder.prototype.insert=function(e){var t=0;if(e<this.previousWord)throw new Error("Out of order word insertion");for(var i=0;i<e.length&&i<this.previousWord.length&&e[i]==this.previousWord[i];i++)t++;this.minimize(t);for(var n=0==this.uncheckedNodes.length?this.root:this.uncheckedNodes[this.uncheckedNodes.length-1].child,i=t;i<e.length;i++){var r=new H.TokenSet,o=e[i];n.edges[o]=r,this.uncheckedNodes.push({parent:n,char:o,child:r}),n=r}n.final=!0,this.previousWord=e},H.TokenSet.Builder.prototype.finish=function(){this.minimize(0)},H.TokenSet.Builder.prototype.minimize=function(e){for(var t=this.uncheckedNodes.length-1;e<=t;t--){var i=this.uncheckedNodes[t],n=i.child.toString();n in this.minimizedNodes?i.parent.edges[i.char]=this.minimizedNodes[n]:(i.child._str=n,this.minimizedNodes[n]=i.child),this.uncheckedNodes.pop()}},(H.Index=function(e){this.invertedIndex=e.invertedIndex,this.fieldVectors=e.fieldVectors,this.tokenSet=e.tokenSet,this.fields=e.fields,this.pipeline=e.pipeline}).prototype.search=function(t){return this.query(function(e){new H.QueryParser(t,e).parse()})},H.Index.prototype.query=function(e){for(var t=new H.Query(this.fields),i=Object.create(null),n=Object.create(null),r=Object.create(null),o=Object.create(null),s=Object.create(null),a=0;a<this.fields.length;a++)n[this.fields[a]]=new H.Vector;e.call(t,t);for(a=0;a<t.clauses.length;a++){for(var l=t.clauses[a],h=null,c=H.Set.empty,h=l.usePipeline?this.pipeline.runString(l.term,{fields:l.fields}):[l.term],u=0;u<h.length;u++){var d=h[u],d=(l.term=d,H.TokenSet.fromClause(l)),p=this.tokenSet.intersect(d).toArray();if(0===p.length&&l.presence===H.Query.presence.REQUIRED){for(var g=0;g<l.fields.length;g++)o[P=l.fields[g]]=H.Set.empty;break}for(var m=0;m<p.length;m++)for(var f=p[m],v=this.invertedIndex[f],F=v._index,g=0;g<l.fields.length;g++){var y=v[P=l.fields[g]],w=Object.keys(y),x=f+"/"+P,T=new H.Set(w);if(l.presence==H.Query.presence.REQUIRED&&(c=c.union(T),void 0===o[P])&&(o[P]=H.Set.complete),l.presence==H.Query.presence.PROHIBITED)void 0===s[P]&&(s[P]=H.Set.empty),s[P]=s[P].union(T);else if(n[P].upsert(F,l.boost,function(e,t){return e+t}),!r[x]){for(var S=0;S<w.length;S++){var E,b=w[S],_=new H.FieldRef(b,P),b=y[b];void 0===(E=i[_])?i[_]=new H.MatchData(f,P,b):E.add(f,P,b)}r[x]=!0}}}if(l.presence===H.Query.presence.REQUIRED)for(g=0;g<l.fields.length;g++)o[P=l.fields[g]]=o[P].intersect(c)}for(var P,C=H.Set.complete,R=H.Set.empty,a=0;a<this.fields.length;a++)o[P=this.fields[a]]&&(C=C.intersect(o[P])),s[P]&&(R=R.union(s[P]));var k=Object.keys(i),D=[],O=Object.create(null);if(t.isNegated())for(k=Object.keys(this.fieldVectors),a=0;a<k.length;a++){var _=k[a],I=H.FieldRef.fromString(_);i[_]=new H.MatchData}for(a=0;a<k.length;a++){var L,z,B=(I=H.FieldRef.fromString(k[a])).docRef;!C.contains(B)||R.contains(B)||(L=this.fieldVectors[I],L=n[I.fieldName].similarity(L),void 0!==(z=O[B])?(z.score+=L,z.matchData.combine(i[I])):(z={ref:B,score:L,matchData:i[I]},O[B]=z,D.push(z)))}return D.sort(function(e,t){return t.score-e.score})},H.Index.prototype.toJSON=function(){var e=Object.keys(this.invertedIndex).sort().map(function(e){return[e,this.invertedIndex[e]]},this),t=Object.keys(this.fieldVectors).map(function(e){return[e,this.fieldVectors[e].toJSON()]},this);return{version:H.version,fields:this.fields,fieldVectors:t,invertedIndex:e,pipeline:this.pipeline.toJSON()}},H.Index.load=function(e){var t={},i={},n=e.fieldVectors,r=Object.create(null),o=e.invertedIndex,s=new H.TokenSet.Builder,a=H.Pipeline.load(e.pipeline);e.version!=H.version&&H.utils.warn("Version mismatch when loading serialised index. Current version of lunr '"+H.version+"' does not match serialized index '"+e.version+"'");for(var l=0;l<n.length;l++){var h=(u=n[l])[0],c=u[1];i[h]=new H.Vector(c)}for(l=0;l<o.length;l++){var u,d=(u=o[l])[0],p=u[1];s.insert(d),r[d]=p}return s.finish(),t.fields=e.fields,t.fieldVectors=i,t.invertedIndex=r,t.tokenSet=s.root,t.pipeline=a,new H.Index(t)},(H.Builder=function(){this._ref="id",this._fields=Object.create(null),this._documents=Object.create(null),this.invertedIndex=Object.create(null),this.fieldTermFrequencies={},this.fieldLengths={},this.tokenizer=H.tokenizer,this.pipeline=new H.Pipeline,this.searchPipeline=new H.Pipeline,this.documentCount=0,this._b=.75,this._k1=1.2,this.termIndex=0,this.metadataWhitelist=[]}).prototype.ref=function(e){this._ref=e},H.Builder.prototype.field=function(e,t){if(/\//.test(e))throw new RangeError("Field '"+e+"' contains illegal character '/'");this._fields[e]=t||{}},H.Builder.prototype.b=function(e){this._b=e<0?0:1<e?1:e},H.Builder.prototype.k1=function(e){this._k1=e},H.Builder.prototype.add=function(e,t){var i=e[this._ref],n=Object.keys(this._fields);this._documents[i]=t||{},this.documentCount+=1;for(var r=0;r<n.length;r++){var o=n[r],s=this._fields[o].extractor,s=s?s(e):e[o],s=this.tokenizer(s,{fields:[o]}),a=this.pipeline.run(s),s=new H.FieldRef(i,o),l=Object.create(null);this.fieldTermFrequencies[s]=l,this.fieldLengths[s]=0,this.fieldLengths[s]+=a.length;for(var h=0;h<a.length;h++){var c=a[h];if(null==l[c]&&(l[c]=0),l[c]+=1,null==this.invertedIndex[c]){var u=Object.create(null);u._index=this.termIndex,this.termIndex+=1;for(var d=0;d<n.length;d++)u[n[d]]=Object.create(null);this.invertedIndex[c]=u}null==this.invertedIndex[c][o][i]&&(this.invertedIndex[c][o][i]=Object.create(null));for(var p=0;p<this.metadataWhitelist.length;p++){var g=this.metadataWhitelist[p],m=c.metadata[g];null==this.invertedIndex[c][o][i][g]&&(this.invertedIndex[c][o][i][g]=[]),this.invertedIndex[c][o][i][g].push(m)}}}},H.Builder.prototype.calculateAverageFieldLengths=function(){for(var e=Object.keys(this.fieldLengths),t=e.length,i={},n={},r=0;r<t;r++){var o=H.FieldRef.fromString(e[r]),s=o.fieldName;n[s]||(n[s]=0),n[s]+=1,i[s]||(i[s]=0),i[s]+=this.fieldLengths[o]}for(var a=Object.keys(this._fields),r=0;r<a.length;r++){var l=a[r];i[l]=i[l]/n[l]}this.averageFieldLength=i},H.Builder.prototype.createFieldVectors=function(){for(var e={},t=Object.keys(this.fieldTermFrequencies),i=t.length,n=Object.create(null),r=0;r<i;r++){for(var o=H.FieldRef.fromString(t[r]),s=o.fieldName,a=this.fieldLengths[o],l=new H.Vector,h=this.fieldTermFrequencies[o],c=Object.keys(h),u=c.length,d=this._fields[s].boost||1,p=this._documents[o.docRef].boost||1,g=0;g<u;g++){var m,f=c[g],v=h[f],y=this.invertedIndex[f]._index;void 0===n[f]?(m=H.idf(this.invertedIndex[f],this.documentCount),n[f]=m):m=n[f],f=(f=m*((this._k1+1)*v)/(this._k1*(1-this._b+this._b*(a/this.averageFieldLength[s]))+v))*d*p,v=Math.round(1e3*f)/1e3,l.insert(y,v)}e[o]=l}this.fieldVectors=e},H.Builder.prototype.createTokenSet=function(){this.tokenSet=H.TokenSet.fromArray(Object.keys(this.invertedIndex).sort())},H.Builder.prototype.build=function(){return this.calculateAverageFieldLengths(),this.createFieldVectors(),this.createTokenSet(),new H.Index({invertedIndex:this.invertedIndex,fieldVectors:this.fieldVectors,tokenSet:this.tokenSet,fields:Object.keys(this._fields),pipeline:this.searchPipeline})},H.Builder.prototype.use=function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(this),e.apply(this,t)},(H.MatchData=function(e,t,i){for(var n=Object.create(null),r=Object.keys(i||{}),o=0;o<r.length;o++){var s=r[o];n[s]=i[s].slice()}this.metadata=Object.create(null),void 0!==e&&(this.metadata[e]=Object.create(null),this.metadata[e][t]=n)}).prototype.combine=function(e){for(var t=Object.keys(e.metadata),i=0;i<t.length;i++){var n=t[i],r=Object.keys(e.metadata[n]);null==this.metadata[n]&&(this.metadata[n]=Object.create(null));for(var o=0;o<r.length;o++){var s=r[o],a=Object.keys(e.metadata[n][s]);null==this.metadata[n][s]&&(this.metadata[n][s]=Object.create(null));for(var l=0;l<a.length;l++){var h=a[l];null==this.metadata[n][s][h]?this.metadata[n][s][h]=e.metadata[n][s][h]:this.metadata[n][s][h]=this.metadata[n][s][h].concat(e.metadata[n][s][h])}}}},H.MatchData.prototype.add=function(e,t,i){if(e in this.metadata)if(t in this.metadata[e])for(var n=Object.keys(i),r=0;r<n.length;r++){var o=n[r];o in this.metadata[e][t]?this.metadata[e][t][o]=this.metadata[e][t][o].concat(i[o]):this.metadata[e][t][o]=i[o]}else this.metadata[e][t]=i;else this.metadata[e]=Object.create(null),this.metadata[e][t]=i},(H.Query=function(e){this.clauses=[],this.allFields=e}).wildcard=new String("*"),H.Query.wildcard.NONE=0,H.Query.wildcard.LEADING=1,H.Query.wildcard.TRAILING=2,H.Query.presence={OPTIONAL:1,REQUIRED:2,PROHIBITED:3},H.Query.prototype.clause=function(e){return"fields"in e||(e.fields=this.allFields),"boost"in e||(e.boost=1),"usePipeline"in e||(e.usePipeline=!0),"wildcard"in e||(e.wildcard=H.Query.wildcard.NONE),e.wildcard&H.Query.wildcard.LEADING&&e.term.charAt(0)!=H.Query.wildcard&&(e.term="*"+e.term),e.wildcard&H.Query.wildcard.TRAILING&&e.term.slice(-1)!=H.Query.wildcard&&(e.term=e.term+"*"),"presence"in e||(e.presence=H.Query.presence.OPTIONAL),this.clauses.push(e),this},H.Query.prototype.isNegated=function(){for(var e=0;e<this.clauses.length;e++)if(this.clauses[e].presence!=H.Query.presence.PROHIBITED)return!1;return!0},H.Query.prototype.term=function(e,t){var i;return Array.isArray(e)?e.forEach(function(e){this.term(e,H.utils.clone(t))},this):((i=t||{}).term=e.toString(),this.clause(i)),this},(H.QueryParseError=function(e,t,i){this.name="QueryParseError",this.message=e,this.start=t,this.end=i}).prototype=new Error,(H.QueryLexer=function(e){this.lexemes=[],this.str=e,this.length=e.length,this.pos=0,this.start=0,this.escapeCharPositions=[]}).prototype.run=function(){for(var e=H.QueryLexer.lexText;e;)e=e(this)},H.QueryLexer.prototype.sliceString=function(){for(var e,t=[],i=this.start,n=(this.pos,0);n<this.escapeCharPositions.length;n++)e=this.escapeCharPositions[n],t.push(this.str.slice(i,e)),i=e+1;return t.push(this.str.slice(i,this.pos)),this.escapeCharPositions.length=0,t.join("")},H.QueryLexer.prototype.emit=function(e){this.lexemes.push({type:e,str:this.sliceString(),start:this.start,end:this.pos}),this.start=this.pos},H.QueryLexer.prototype.escapeCharacter=function(){this.escapeCharPositions.push(this.pos-1),this.pos+=1},H.QueryLexer.prototype.next=function(){var e;return this.pos>=this.length?H.QueryLexer.EOS:(e=this.str.charAt(this.pos),this.pos+=1,e)},H.QueryLexer.prototype.width=function(){return this.pos-this.start},H.QueryLexer.prototype.ignore=function(){this.start==this.pos&&(this.pos+=1),this.start=this.pos},H.QueryLexer.prototype.backup=function(){--this.pos},H.QueryLexer.prototype.acceptDigitRun=function(){for(var e,t;47<(t=(e=this.next()).charCodeAt(0))&&t<58;);e!=H.QueryLexer.EOS&&this.backup()},H.QueryLexer.prototype.more=function(){return this.pos<this.length},H.QueryLexer.EOS="EOS",H.QueryLexer.FIELD="FIELD",H.QueryLexer.TERM="TERM",H.QueryLexer.EDIT_DISTANCE="EDIT_DISTANCE",H.QueryLexer.BOOST="BOOST",H.QueryLexer.PRESENCE="PRESENCE",H.QueryLexer.lexField=function(e){return e.backup(),e.emit(H.QueryLexer.FIELD),e.ignore(),H.QueryLexer.lexText},H.QueryLexer.lexTerm=function(e){if(1<e.width()&&(e.backup(),e.emit(H.QueryLexer.TERM)),e.ignore(),e.more())return H.QueryLexer.lexText},H.QueryLexer.lexEditDistance=function(e){return e.ignore(),e.acceptDigitRun(),e.emit(H.QueryLexer.EDIT_DISTANCE),H.QueryLexer.lexText},H.QueryLexer.lexBoost=function(e){return e.ignore(),e.acceptDigitRun(),e.emit(H.QueryLexer.BOOST),H.QueryLexer.lexText},H.QueryLexer.lexEOS=function(e){0<e.width()&&e.emit(H.QueryLexer.TERM)},H.QueryLexer.termSeparator=H.tokenizer.separator,H.QueryLexer.lexText=function(e){for(;;){var t=e.next();if(t==H.QueryLexer.EOS)return H.QueryLexer.lexEOS;if(92==t.charCodeAt(0))e.escapeCharacter();else{if(":"==t)return H.QueryLexer.lexField;if("~"==t)return e.backup(),0<e.width()&&e.emit(H.QueryLexer.TERM),H.QueryLexer.lexEditDistance;if("^"==t)return e.backup(),0<e.width()&&e.emit(H.QueryLexer.TERM),H.QueryLexer.lexBoost;if("+"==t&&1===e.width())return e.emit(H.QueryLexer.PRESENCE),H.QueryLexer.lexText;if("-"==t&&1===e.width())return e.emit(H.QueryLexer.PRESENCE),H.QueryLexer.lexText;if(t.match(H.QueryLexer.termSeparator))return H.QueryLexer.lexTerm}}},(H.QueryParser=function(e,t){this.lexer=new H.QueryLexer(e),this.query=t,this.currentClause={},this.lexemeIdx=0}).prototype.parse=function(){this.lexer.run(),this.lexemes=this.lexer.lexemes;for(var e=H.QueryParser.parseClause;e;)e=e(this);return this.query},H.QueryParser.prototype.peekLexeme=function(){return this.lexemes[this.lexemeIdx]},H.QueryParser.prototype.consumeLexeme=function(){var e=this.peekLexeme();return this.lexemeIdx+=1,e},H.QueryParser.prototype.nextClause=function(){var e=this.currentClause;this.query.clause(e),this.currentClause={}},H.QueryParser.parseClause=function(e){var t=e.peekLexeme();if(null!=t)switch(t.type){case H.QueryLexer.PRESENCE:return H.QueryParser.parsePresence;case H.QueryLexer.FIELD:return H.QueryParser.parseField;case H.QueryLexer.TERM:return H.QueryParser.parseTerm;default:var i="expected either a field or a term, found "+t.type;throw 1<=t.str.length&&(i+=" with value '"+t.str+"'"),new H.QueryParseError(i,t.start,t.end)}},H.QueryParser.parsePresence=function(e){var t=e.consumeLexeme();if(null!=t){switch(t.str){case"-":e.currentClause.presence=H.Query.presence.PROHIBITED;break;case"+":e.currentClause.presence=H.Query.presence.REQUIRED;break;default:var i="unrecognised presence operator'"+t.str+"'";throw new H.QueryParseError(i,t.start,t.end)}var n=e.peekLexeme();if(null==n)throw new H.QueryParseError(i="expecting term or field, found nothing",t.start,t.end);switch(n.type){case H.QueryLexer.FIELD:return H.QueryParser.parseField;case H.QueryLexer.TERM:return H.QueryParser.parseTerm;default:i="expecting term or field, found '"+n.type+"'";throw new H.QueryParseError(i,n.start,n.end)}}},H.QueryParser.parseField=function(e){var t=e.consumeLexeme();if(null!=t){if(-1==e.query.allFields.indexOf(t.str))throw i=e.query.allFields.map(function(e){return"'"+e+"'"}).join(", "),i="unrecognised field '"+t.str+"', possible fields: "+i,new H.QueryParseError(i,t.start,t.end);e.currentClause.fields=[t.str];e=e.peekLexeme();if(null==e)throw new H.QueryParseError(i="expecting term, found nothing",t.start,t.end);if(e.type===H.QueryLexer.TERM)return H.QueryParser.parseTerm;var i="expecting term, found '"+e.type+"'";throw new H.QueryParseError(i,e.start,e.end)}},H.QueryParser.parseTerm=function(e){var t=e.consumeLexeme();if(null!=t){e.currentClause.term=t.str.toLowerCase(),-1!=t.str.indexOf("*")&&(e.currentClause.usePipeline=!1);var i=e.peekLexeme();if(null==i)e.nextClause();else switch(i.type){case H.QueryLexer.TERM:return e.nextClause(),H.QueryParser.parseTerm;case H.QueryLexer.FIELD:return e.nextClause(),H.QueryParser.parseField;case H.QueryLexer.EDIT_DISTANCE:return H.QueryParser.parseEditDistance;case H.QueryLexer.BOOST:return H.QueryParser.parseBoost;case H.QueryLexer.PRESENCE:return e.nextClause(),H.QueryParser.parsePresence;default:var n="Unexpected lexeme type '"+i.type+"'";throw new H.QueryParseError(n,i.start,i.end)}}},H.QueryParser.parseEditDistance=function(e){var t=e.consumeLexeme();if(null!=t){var i=parseInt(t.str,10);if(isNaN(i))throw new H.QueryParseError(r="edit distance must be numeric",t.start,t.end);e.currentClause.editDistance=i;var n=e.peekLexeme();if(null==n)e.nextClause();else switch(n.type){case H.QueryLexer.TERM:return e.nextClause(),H.QueryParser.parseTerm;case H.QueryLexer.FIELD:return e.nextClause(),H.QueryParser.parseField;case H.QueryLexer.EDIT_DISTANCE:return H.QueryParser.parseEditDistance;case H.QueryLexer.BOOST:return H.QueryParser.parseBoost;case H.QueryLexer.PRESENCE:return e.nextClause(),H.QueryParser.parsePresence;default:var r="Unexpected lexeme type '"+n.type+"'";throw new H.QueryParseError(r,n.start,n.end)}}},H.QueryParser.parseBoost=function(e){var t=e.consumeLexeme();if(null!=t){var i=parseInt(t.str,10);if(isNaN(i))throw new H.QueryParseError(r="boost must be numeric",t.start,t.end);e.currentClause.boost=i;var n=e.peekLexeme();if(null==n)e.nextClause();else switch(n.type){case H.QueryLexer.TERM:return e.nextClause(),H.QueryParser.parseTerm;case H.QueryLexer.FIELD:return e.nextClause(),H.QueryParser.parseField;case H.QueryLexer.EDIT_DISTANCE:return H.QueryParser.parseEditDistance;case H.QueryLexer.BOOST:return H.QueryParser.parseBoost;case H.QueryLexer.PRESENCE:return e.nextClause(),H.QueryParser.parsePresence;default:var r="Unexpected lexeme type '"+n.type+"'";throw new H.QueryParseError(r,n.start,n.end)}}},e=this,i=function(){return H},"function"==typeof define&&define.amd?define(i):"object"==typeof exports?module.exports=H:e.lunr=H}(),function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():t()(e.lunr)}(this,function(){return function(e){e.stemmerSupport={Among:function(e,t,i,n){if(this.toCharArray=function(e){for(var t=e.length,i=new Array(t),n=0;n<t;n++)i[n]=e.charCodeAt(n);return i},!e&&""!=e||!t&&0!=t||!i)throw"Bad Among initialisation: s:"+e+", substring_i: "+t+", result: "+i;this.s_size=e.length,this.s=this.toCharArray(e),this.substring_i=t,this.result=i,this.method=n},SnowballProgram:function(){var m;return{bra:0,ket:0,limit:0,cursor:0,limit_backward:0,setCurrent:function(e){m=e,this.cursor=0,this.limit=e.length,this.limit_backward=0,this.bra=this.cursor,this.ket=this.limit},getCurrent:function(){var e=m;return m=null,e},in_grouping:function(e,t,i){if(this.cursor<this.limit){var n=m.charCodeAt(this.cursor);if(n<=i&&t<=n&&e[(n-=t)>>3]&1<<(7&n))return this.cursor++,!0}return!1},in_grouping_b:function(e,t,i){if(this.cursor>this.limit_backward){var n=m.charCodeAt(this.cursor-1);if(n<=i&&t<=n&&e[(n-=t)>>3]&1<<(7&n))return this.cursor--,!0}return!1},out_grouping:function(e,t,i){if(this.cursor<this.limit){var n=m.charCodeAt(this.cursor);if(i<n||n<t)return this.cursor++,!0;if(!(e[(n-=t)>>3]&1<<(7&n)))return this.cursor++,!0}return!1},out_grouping_b:function(e,t,i){if(this.cursor>this.limit_backward){var n=m.charCodeAt(this.cursor-1);if(i<n||n<t)return this.cursor--,!0;if(!(e[(n-=t)>>3]&1<<(7&n)))return this.cursor--,!0}return!1},eq_s:function(e,t){if(this.limit-this.cursor<e)return!1;for(var i=0;i<e;i++)if(m.charCodeAt(this.cursor+i)!=t.charCodeAt(i))return!1;return this.cursor+=e,!0},eq_s_b:function(e,t){if(this.cursor-this.limit_backward<e)return!1;for(var i=0;i<e;i++)if(m.charCodeAt(this.cursor-e+i)!=t.charCodeAt(i))return!1;return this.cursor-=e,!0},find_among:function(e,t){for(var i=0,n=t,r=this.cursor,o=this.limit,s=0,a=0,l=!1;;){for(var h=i+(n-i>>1),c=0,u=s<a?s:a,d=e[h],p=u;p<d.s_size;p++){if(r+u==o){c=-1;break}if(c=m.charCodeAt(r+u)-d.s[p])break;u++}if(c<0?(n=h,a=u):(i=h,s=u),n-i<=1){if(0<i||n==i||l)break;l=!0}}for(;;){if(s>=(d=e[i]).s_size){if(this.cursor=r+d.s_size,!d.method)return d.result;var g=d.method();if(this.cursor=r+d.s_size,g)return d.result}if((i=d.substring_i)<0)return 0}},find_among_b:function(e,t){for(var i=0,n=t,r=this.cursor,o=this.limit_backward,s=0,a=0,l=!1;;){for(var h,c=i+(n-i>>1),u=0,d=s<a?s:a,p=(h=e[c]).s_size-1-d;0<=p;p--){if(r-d==o){u=-1;break}if(u=m.charCodeAt(r-1-d)-h.s[p])break;d++}if(u<0?(n=c,a=d):(i=c,s=d),n-i<=1){if(0<i||n==i||l)break;l=!0}}for(;;){if(s>=(h=e[i]).s_size){if(this.cursor=r-h.s_size,!h.method)return h.result;var g=h.method();if(this.cursor=r-h.s_size,g)return h.result}if((i=h.substring_i)<0)return 0}},replace_s:function(e,t,i){var n=i.length-(t-e);return m=m.substring(0,e)+i+m.substring(t),this.limit+=n,this.cursor>=t?this.cursor+=n:this.cursor>e&&(this.cursor=e),n},slice_check:function(){if(this.bra<0||this.bra>this.ket||this.ket>this.limit||this.limit>m.length)throw"faulty slice operation"},slice_from:function(e){this.slice_check(),this.replace_s(this.bra,this.ket,e)},slice_del:function(){this.slice_from("")},insert:function(e,t,i){t=this.replace_s(e,t,i);e<=this.bra&&(this.bra+=t),e<=this.ket&&(this.ket+=t)},slice_to:function(){return this.slice_check(),m.substring(this.bra,this.ket)},eq_v_b:function(e){return this.eq_s_b(e.length,e)}}}},e.trimmerSupport={generateTrimmer:function(e){var t=new RegExp("^[^"+e+"]+"),i=new RegExp("[^"+e+"]+$");return function(e){return"function"==typeof e.update?e.update(function(e){return e.replace(t,"").replace(i,"")}):e.replace(t,"").replace(i,"")}}}}}),function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():t()(e.lunr)}(this,function(){return function(e){if(void 0===e)throw new Error("Lunr is not present. Please include / require Lunr before this script.");if(void 0===e.stemmerSupport)throw new Error("Lunr stemmer support is not present. Please include / require Lunr stemmer support before this script.");var t,i,n;e.fr=function(){this.pipeline.reset(),this.pipeline.add(e.fr.trimmer,e.fr.stopWordFilter,e.fr.stemmer),this.searchPipeline&&(this.searchPipeline.reset(),this.searchPipeline.add(e.fr.stemmer))},e.fr.wordCharacters="A-Za-zªºÀ-ÖØ-öø-ʸˠ-ˤᴀ-ᴥᴬ-ᵜᵢ-ᵥᵫ-ᵷᵹ-ᶾḀ-ỿⁱⁿₐ-ₜKÅℲⅎⅠ-ↈⱠ-ⱿꜢ-ꞇꞋ-ꞭꞰ-ꞷꟷ-ꟿꬰ-ꭚꭜ-ꭤﬀ-ﬆＡ-Ｚａ-ｚ",e.fr.trimmer=e.trimmerSupport.generateTrimmer(e.fr.wordCharacters),e.Pipeline.registerFunction(e.fr.trimmer,"trimmer-fr"),e.fr.stemmer=(t=e.stemmerSupport.Among,i=e.stemmerSupport.SnowballProgram,n=new function(){var n,r,o,s=[new t("col",-1,-1),new t("par",-1,-1),new t("tap",-1,-1)],a=[new t("",-1,4),new t("I",0,1),new t("U",0,2),new t("Y",0,3)],l=[new t("iqU",-1,3),new t("abl",-1,3),new t("Ièr",-1,4),new t("ièr",-1,4),new t("eus",-1,2),new t("iv",-1,1)],h=[new t("ic",-1,2),new t("abil",-1,1),new t("iv",-1,3)],c=[new t("iqUe",-1,1),new t("atrice",-1,2),new t("ance",-1,1),new t("ence",-1,5),new t("logie",-1,3),new t("able",-1,1),new t("isme",-1,1),new t("euse",-1,11),new t("iste",-1,1),new t("ive",-1,8),new t("if",-1,8),new t("usion",-1,4),new t("ation",-1,2),new t("ution",-1,4),new t("ateur",-1,2),new t("iqUes",-1,1),new t("atrices",-1,2),new t("ances",-1,1),new t("ences",-1,5),new t("logies",-1,3),new t("ables",-1,1),new t("ismes",-1,1),new t("euses",-1,11),new t("istes",-1,1),new t("ives",-1,8),new t("ifs",-1,8),new t("usions",-1,4),new t("ations",-1,2),new t("utions",-1,4),new t("ateurs",-1,2),new t("ments",-1,15),new t("ements",30,6),new t("issements",31,12),new t("ités",-1,7),new t("ment",-1,15),new t("ement",34,6),new t("issement",35,12),new t("amment",34,13),new t("emment",34,14),new t("aux",-1,10),new t("eaux",39,9),new t("eux",-1,1),new t("ité",-1,7)],u=[new t("ira",-1,1),new t("ie",-1,1),new t("isse",-1,1),new t("issante",-1,1),new t("i",-1,1),new t("irai",4,1),new t("ir",-1,1),new t("iras",-1,1),new t("ies",-1,1),new t("îmes",-1,1),new t("isses",-1,1),new t("issantes",-1,1),new t("îtes",-1,1),new t("is",-1,1),new t("irais",13,1),new t("issais",13,1),new t("irions",-1,1),new t("issions",-1,1),new t("irons",-1,1),new t("issons",-1,1),new t("issants",-1,1),new t("it",-1,1),new t("irait",21,1),new t("issait",21,1),new t("issant",-1,1),new t("iraIent",-1,1),new t("issaIent",-1,1),new t("irent",-1,1),new t("issent",-1,1),new t("iront",-1,1),new t("ît",-1,1),new t("iriez",-1,1),new t("issiez",-1,1),new t("irez",-1,1),new t("issez",-1,1)],d=[new t("a",-1,3),new t("era",0,2),new t("asse",-1,3),new t("ante",-1,3),new t("ée",-1,2),new t("ai",-1,3),new t("erai",5,2),new t("er",-1,2),new t("as",-1,3),new t("eras",8,2),new t("âmes",-1,3),new t("asses",-1,3),new t("antes",-1,3),new t("âtes",-1,3),new t("ées",-1,2),new t("ais",-1,3),new t("erais",15,2),new t("ions",-1,1),new t("erions",17,2),new t("assions",17,3),new t("erons",-1,2),new t("ants",-1,3),new t("és",-1,2),new t("ait",-1,3),new t("erait",23,2),new t("ant",-1,3),new t("aIent",-1,3),new t("eraIent",26,2),new t("èrent",-1,2),new t("assent",-1,3),new t("eront",-1,2),new t("ât",-1,3),new t("ez",-1,2),new t("iez",32,2),new t("eriez",33,2),new t("assiez",33,3),new t("erez",32,2),new t("é",-1,2)],p=[new t("e",-1,3),new t("Ière",0,2),new t("ière",0,2),new t("ion",-1,1),new t("Ier",-1,2),new t("ier",-1,2),new t("ë",-1,4)],g=[new t("ell",-1,-1),new t("eill",-1,-1),new t("enn",-1,-1),new t("onn",-1,-1),new t("ett",-1,-1)],m=[17,65,16,1,0,0,0,0,0,0,0,0,0,0,0,128,130,103,8,5],f=[1,65,20,0,0,0,0,0,0,0,0,0,0,0,0,0,128],v=new i;function y(e,t,i){return v.eq_s(1,e)&&(v.ket=v.cursor,v.in_grouping(m,97,251))&&(v.slice_from(t),v.cursor=i,1)}function w(e,t,i){return v.eq_s(1,e)&&(v.ket=v.cursor,v.slice_from(t),v.cursor=i,1)}function x(){for(;!v.in_grouping(m,97,251);){if(v.cursor>=v.limit)return 1;v.cursor++}for(;!v.out_grouping(m,97,251);){if(v.cursor>=v.limit)return 1;v.cursor++}}function T(){return o<=v.cursor}function S(){return r<=v.cursor}function E(){return n<=v.cursor}function b(){if(function(){var e,t;if(v.ket=v.cursor,e=v.find_among_b(c,43)){switch(v.bra=v.cursor,e){case 1:if(!E())return;v.slice_del();break;case 2:if(!E())return;v.slice_del(),v.ket=v.cursor,v.eq_s_b(2,"ic")&&(v.bra=v.cursor,E()?v.slice_del():v.slice_from("iqU"));break;case 3:if(!E())return;v.slice_from("log");break;case 4:if(!E())return;v.slice_from("u");break;case 5:if(!E())return;v.slice_from("ent");break;case 6:if(!T())return;if(v.slice_del(),v.ket=v.cursor,e=v.find_among_b(l,6))switch(v.bra=v.cursor,e){case 1:E()&&(v.slice_del(),v.ket=v.cursor,v.eq_s_b(2,"at"))&&(v.bra=v.cursor,E())&&v.slice_del();break;case 2:E()?v.slice_del():S()&&v.slice_from("eux");break;case 3:E()&&v.slice_del();break;case 4:T()&&v.slice_from("i")}break;case 7:if(!E())return;if(v.slice_del(),v.ket=v.cursor,e=v.find_among_b(h,3))switch(v.bra=v.cursor,e){case 1:E()?v.slice_del():v.slice_from("abl");break;case 2:E()?v.slice_del():v.slice_from("iqU");break;case 3:E()&&v.slice_del()}break;case 8:if(!E())return;v.slice_del(),v.ket=v.cursor,v.eq_s_b(2,"at")&&(v.bra=v.cursor,E())&&(v.slice_del(),v.ket=v.cursor,v.eq_s_b(2,"ic"))&&(v.bra=v.cursor,E()?v.slice_del():v.slice_from("iqU"));break;case 9:v.slice_from("eau");break;case 10:if(!S())return;v.slice_from("al");break;case 11:if(E())v.slice_del();else{if(!S())return;v.slice_from("eux")}break;case 12:if(!S()||!v.out_grouping_b(m,97,251))return;v.slice_del();break;case 13:return T()&&v.slice_from("ant"),0;case 14:return T()&&v.slice_from("ent"),0;case 15:return t=v.limit-v.cursor,v.in_grouping_b(m,97,251)&&T()&&(v.cursor=v.limit-t,v.slice_del()),0}return 1}}()||(v.cursor=v.limit,function(){var e,t;if(!(v.cursor<o)){if(t=v.limit_backward,v.limit_backward=o,v.ket=v.cursor,e=v.find_among_b(u,35)){if(v.bra=v.cursor,1==e){if(!v.out_grouping_b(m,97,251))return v.limit_backward=t,0;v.slice_del()}return v.limit_backward=t,1}v.limit_backward=t}}())||(v.cursor=v.limit,function(){var e,t,i;if(!(v.cursor<o)){if(t=v.limit_backward,v.limit_backward=o,v.ket=v.cursor,e=v.find_among_b(d,38)){switch(v.bra=v.cursor,e){case 1:if(!E())return v.limit_backward=t,0;v.slice_del();break;case 2:v.slice_del();break;case 3:v.slice_del(),i=v.limit-v.cursor,v.ket=v.cursor,v.eq_s_b(1,"e")?(v.bra=v.cursor,v.slice_del()):v.cursor=v.limit-i}return v.limit_backward=t,1}v.limit_backward=t}}()))v.cursor=v.limit,v.ket=v.cursor,v.eq_s_b(1,"Y")?(v.bra=v.cursor,v.slice_from("i")):(v.cursor=v.limit,v.eq_s_b(1,"ç")&&(v.bra=v.cursor,v.slice_from("c")));else{v.cursor=v.limit;var e,t,i=v.limit-v.cursor;if(v.ket=v.cursor,v.eq_s_b(1,"s")&&(v.bra=v.cursor,e=v.limit-v.cursor,v.out_grouping_b(f,97,232))?(v.cursor=v.limit-e,v.slice_del()):v.cursor=v.limit-i,v.cursor>=o){if(e=v.limit_backward,v.limit_backward=o,v.ket=v.cursor,i=v.find_among_b(p,7))switch(v.bra=v.cursor,i){case 1:if(E()){if(t=v.limit-v.cursor,!v.eq_s_b(1,"s")&&(v.cursor=v.limit-t,!v.eq_s_b(1,"t")))break;v.slice_del()}break;case 2:v.slice_from("i");break;case 3:v.slice_del();break;case 4:v.eq_s_b(2,"gu")&&v.slice_del()}v.limit_backward=e}}}this.setCurrent=function(e){v.setCurrent(e)},this.getCurrent=function(){return v.getCurrent()},this.stem=function(){var e=v.cursor,t=(!function(){for(var e,t;;){if(e=v.cursor,v.in_grouping(m,97,251)){if(v.bra=v.cursor,t=v.cursor,y("u","U",e))continue;if(v.cursor=t,y("i","I",e))continue;if(v.cursor=t,w("y","Y",e))continue}if(v.cursor=e,v.bra=e,!y("y","Y",e)&&(v.cursor=e,!v.eq_s(1,"q")||(v.bra=v.cursor,!w("u","U",e)))){if((v.cursor=e)>=v.limit)return;v.cursor++}}}(),v.cursor=e,v.cursor);if(o=v.limit,n=r=o,v.in_grouping(m,97,251)&&v.in_grouping(m,97,251)&&v.cursor<v.limit)v.cursor++;else if(v.cursor=t,!v.find_among(s,3)){v.cursor=t;do{if(v.cursor>=v.limit){v.cursor=o;break}}while(v.cursor++,!v.in_grouping(m,97,251))}o=v.cursor,v.cursor=t,x()||(r=v.cursor,x())||(n=v.cursor),v.limit_backward=e,v.cursor=v.limit,b(),v.cursor=v.limit,t=v.limit-v.cursor,v.find_among_b(g,5)&&(v.cursor=v.limit-t,v.ket=v.cursor,v.cursor>v.limit_backward)&&(v.cursor--,v.bra=v.cursor,v.slice_del()),v.cursor=v.limit;for(var i=1;v.out_grouping_b(m,97,251);)i--;return i<=0&&(v.ket=v.cursor,e=v.limit-v.cursor,v.eq_s_b(1,"é")||(v.cursor=v.limit-e,v.eq_s_b(1,"è")))&&(v.bra=v.cursor,v.slice_from("e")),v.cursor=v.limit_backward,function(){for(var e;e=v.cursor,v.bra=e,e=v.find_among(a,4);)switch(v.ket=v.cursor,e){case 1:v.slice_from("i");break;case 2:v.slice_from("u");break;case 3:v.slice_from("y");break;case 4:if(v.cursor>=v.limit)return;v.cursor++}}(),!0}},function(e){return"function"==typeof e.update?e.update(function(e){return n.setCurrent(e),n.stem(),n.getCurrent()}):(n.setCurrent(e),n.stem(),n.getCurrent())}),e.Pipeline.registerFunction(e.fr.stemmer,"stemmer-fr"),e.fr.stopWordFilter=e.generateStopWordFilter("ai aie aient aies ait as au aura aurai auraient aurais aurait auras aurez auriez aurions aurons auront aux avaient avais avait avec avez aviez avions avons ayant ayez ayons c ce ceci celà ces cet cette d dans de des du elle en es est et eu eue eues eurent eus eusse eussent eusses eussiez eussions eut eux eûmes eût eûtes furent fus fusse fussent fusses fussiez fussions fut fûmes fût fûtes ici il ils j je l la le les leur leurs lui m ma mais me mes moi mon même n ne nos notre nous on ont ou par pas pour qu que quel quelle quelles quels qui s sa sans se sera serai seraient serais serait seras serez seriez serions serons seront ses soi soient sois soit sommes son sont soyez soyons suis sur t ta te tes toi ton tu un une vos votre vous y à étaient étais était étant étiez étions été étée étées étés êtes".split(" ")),e.Pipeline.registerFunction(e.fr.stopWordFilter,"stopWordFilter-fr")}}),function(n){n.version={versionStr:"3.1.0",major:parseInt("3",10),minor:parseInt("1",10),revision:parseInt("0",10)};var e,t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,r=Object.prototype.hasOwnProperty;n.isFunction=function(e){return"function"===n.type(e)},n.isArray=Array.isArray||function(e){return"array"===n.type(e)},n.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},n.type=function(e){return null==e?String(e):t[i.call(e)]||"object"},n.isPlainObject=function(e){if(!e||"object"!==OpenSeadragon.type(e)||e.nodeType||n.isWindow(e))return!1;if(e.constructor&&!r.call(e,"constructor")&&!r.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t,i;for(i in e)t=i;return void 0===t||r.call(e,t)},n.isEmptyObject=function(e){for(var t in e)return!1;return!0},n.freezeObject=function(e){return Object.freeze?n.freezeObject=Object.freeze:n.freezeObject=function(e){return e},n.freezeObject(e)},n.supportsCanvas=(e=document.createElement("canvas"),!(!n.isFunction(e.getContext)||!e.getContext("2d"))),n.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){t=!0}return t},n.supportsAddEventListener=!(!document.documentElement.addEventListener||!document.addEventListener),n.supportsRemoveEventListener=!(!document.documentElement.removeEventListener||!document.removeEventListener),n.supportsEventListenerOptions=function(){var e=0;if(n.supportsAddEventListener)try{var t={get capture(){return e++,!1},get once(){return e++,!1},get passive(){return e++,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=0}return 3<=e}(),n.getCurrentPixelDensityRatio=function(){var e,t;return n.supportsCanvas?(t=document.createElement("canvas").getContext("2d"),e=window.devicePixelRatio||1,t=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,Math.max(e,1)/t):1},n.pixelDensityRatio=n.getCurrentPixelDensityRatio()}(OpenSeadragon),function(u){var e;function t(e){}u.extend=function(){var e,t,i,n,r,o=arguments[0]||{},s=arguments.length,a=!1,l=1;for("boolean"==typeof o&&(a=o,o=arguments[1]||{},l=2),"object"==typeof o||OpenSeadragon.isFunction(o)||(o={}),s===l&&(o=this,--l);l<s;l++)if(null!==(e=arguments[l])||void 0!==e)for(t in e)r=o[t],o!==(i=e[t])&&(a&&i&&(OpenSeadragon.isPlainObject(i)||(n=OpenSeadragon.isArray(i)))?(r=n?(n=!1,r&&OpenSeadragon.isArray(r)?r:[]):r&&OpenSeadragon.isPlainObject(r)?r:{},o[t]=OpenSeadragon.extend(a,r,i)):void 0!==i&&(o[t]=i));return o},u.extend(u,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:"object"==typeof navigator&&"string"==typeof(e=navigator.userAgent)&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod")),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(t,i){return function(){var e=arguments;return i.apply(t,void 0===e?[]:e)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(e){return u._viewers.get(this.getElement(e))},getElement:function(e){return"string"==typeof e?document.getElementById(e):e},getElementPosition:function(e){for(var t,i=new u.Point,n=w(e=u.getElement(e),t="fixed"===u.getElementStyle(e).position);n;)i.x+=e.offsetLeft,i.y+=e.offsetTop,t&&(i=i.plus(u.getPageScroll())),n=w(e=n,t="fixed"===u.getElementStyle(e).position);return i},getElementOffset:function(e){var t,i=(e=u.getElement(e))&&e.ownerDocument,n={top:0,left:0};return i?(t=i.documentElement,void 0!==e.getBoundingClientRect&&(n=e.getBoundingClientRect()),i=i===i.window?i:9===i.nodeType&&(i.defaultView||i.parentWindow),new u.Point(n.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0),n.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0))):new u.Point},getElementSize:function(e){return e=u.getElement(e),new u.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return(e=u.getElement(e)).currentStyle}:function(e){return e=u.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var a={};return u.getCssPropertyWithVendorPrefix=function(e){if(void 0!==a[e])return a[e];var t=document.createElement("div").style,i=null;if(void 0!==t[e])i=e;else for(var n=["Webkit","Moz","MS","O","webkit","moz","ms","o"],r=u.capitalizeFirstLetter(e),o=0;o<n.length;o++){var s=n[o]+r;if(void 0!==t[s]){i=s;break}}return a[e]=i},u.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){return(e%=t)<0&&(e+=t),e},pointInElement:function(e,t){e=u.getElement(e);var i=u.getElementOffset(e),e=u.getElementSize(e);return t.x>=i.x&&t.x<i.x+e.x&&t.y<i.y+e.y&&t.y>=i.y},getMousePosition:function(e){if("number"==typeof e.pageX)u.getMousePosition=function(e){var t=new u.Point;return t.x=e.pageX,t.y=e.pageY,t};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");u.getMousePosition=function(e){var t=new u.Point;return t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t}}return u.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.pageXOffset)u.getPageScroll=function(){return new u.Point(window.pageXOffset,window.pageYOffset)};else if(t.scrollLeft||t.scrollTop)u.getPageScroll=function(){return new u.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new u.Point(0,0);u.getPageScroll=function(){return new u.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return u.getPageScroll()},setPageScroll:function(e){if(void 0!==window.scrollTo)u.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var t=u.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var i=u.getPageScroll();if(i.x!==t.x&&i.y!==t.y)return void(u.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(i=u.getPageScroll()).x!==t.x&&i.y!==t.y)return void(u.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});u.setPageScroll=function(e){}}u.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.innerWidth)u.getWindowSize=function(){return new u.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)u.getWindowSize=function(){return new u.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!t.clientWidth&&!t.clientHeight)throw new Error("Unknown window size, no known technique.");u.getWindowSize=function(){return new u.Point(document.body.clientWidth,document.body.clientHeight)}}return u.getWindowSize()},makeCenteredNode:function(e){e=u.getElement(e);var t=[u.makeNeutralElement("div"),u.makeNeutralElement("div"),u.makeNeutralElement("div")];return u.extend(t[0].style,{display:"table",height:"100%",width:"100%"}),u.extend(t[1].style,{display:"table-row"}),u.extend(t[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),t[0].appendChild(t[1]),t[1].appendChild(t[2]),t[2].appendChild(e),t[0]},makeNeutralElement:function(e){var t=document.createElement(e);return(e=t.style).background="transparent none",e.border="none",e.margin="0px",e.padding="0px",e.position="static",t},now:function(){return Date.now?u.now=Date.now:u.now=function(){return(new Date).getTime()},u.now()},makeTransparentImage:function(e){var t=u.makeNeutralElement("img");return t.src=e,t},setElementOpacity:function(e,t,i){e=u.getElement(e),i&&!u.Browser.alpha&&(t=Math.round(t)),u.Browser.opacity?e.style.opacity=t<1?t:"":t<1?(t=Math.round(100*t),e.style.filter="alpha(opacity="+t+")"):e.style.filter=""},setElementTouchActionNone:function(e){void 0!==(e=u.getElement(e)).style.touchAction?e.style.touchAction="none":void 0!==e.style.msTouchAction&&(e.style.msTouchAction="none")},setElementPointerEvents:function(e,t){void 0!==(e=u.getElement(e)).style&&void 0!==e.style.pointerEvents&&(e.style.pointerEvents=t)},setElementPointerEventsNone:function(e){u.setElementPointerEvents(e,"none")},addClass:function(e,t){(e=u.getElement(e)).className?-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t):e.className=t},indexOf:function(e,t,i){return Array.prototype.indexOf?this.indexOf=function(e,t,i){return e.indexOf(t,i)}:this.indexOf=function(e,t,i){var n,r,i=i||0;if(!e)throw new TypeError;if(!(0===(r=e.length)||r<=i))for(n=i=i<0?r-Math.abs(i):i;n<r;n++)if(e[n]===t)return n;return-1},this.indexOf(e,t,i)},removeClass:function(e,t){for(var i=[],n=(e=u.getElement(e)).className.split(/\s+/),r=0;r<n.length;r++)n[r]&&n[r]!==t&&i.push(n[r]);e.className=i.join(" ")},normalizeEventListenerOptions:function(e){return void 0!==e?"boolean"==typeof e?u.supportsEventListenerOptions?{capture:e}:e:u.supportsEventListenerOptions?e:void 0!==e.capture&&e.capture:!!u.supportsEventListenerOptions&&{capture:!1}},addEvent:function(){if(u.supportsAddEventListener)return function(e,t,i,n){n=u.normalizeEventListenerOptions(n),(e=u.getElement(e)).addEventListener(t,i,n)};if(document.documentElement.attachEvent&&document.attachEvent)return function(e,t,i){(e=u.getElement(e)).attachEvent("on"+t,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(u.supportsRemoveEventListener)return function(e,t,i,n){n=u.normalizeEventListenerOptions(n),(e=u.getElement(e)).removeEventListener(t,i,n)};if(document.documentElement.detachEvent&&document.detachEvent)return function(e,t,i){(e=u.getElement(e)).detachEvent("on"+t,i)};throw new Error("No known event model.")}(),cancelEvent:function(e){e.preventDefault()},eventIsCanceled:function(e){return e.defaultPrevented},stopEvent:function(e){e.stopPropagation()},createCallback:function(i,n){for(var r=[],e=2;e<arguments.length;e++)r.push(arguments[e]);return function(){for(var e=r.concat([]),t=0;t<arguments.length;t++)e.push(arguments[t]);return n.apply(i,e)}},getUrlParameter:function(e){return(e=c[e])||null},getUrlProtocol:function(e){return null===(e=e.match(/^([a-z]+:)\/\//i))?window.location.protocol:e[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}if(t)window.XMLHttpRequest?u.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:u.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");u.createAjaxRequest=function(){return new XMLHttpRequest}}return u.createAjaxRequest(e)},makeAjaxRequest:function(e,t,i){u.isPlainObject(e)&&(t=e.success,i=e.error,n=e.withCredentials,r=e.headers,o=e.responseType||null,s=e.postData||null,e=e.url);var n,r,o,s,a=u.getUrlProtocol(e),l=u.createAjaxRequest("file:"===a);if(!u.isFunction(t))throw new Error("makeAjaxRequest requires a success callback");l.onreadystatechange=function(){4===l.readyState&&(l.onreadystatechange=function(){},200<=l.status&&l.status<300||0===l.status&&"http:"!==a&&"https:"!==a?t(l):u.isFunction(i)?i(l):u.console.error("AJAX request returned %d: %s",l.status,e))};var h=s?"POST":"GET";try{if(l.open(h,e,!0),o&&(l.responseType=o),r)for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&r[c]&&l.setRequestHeader(c,r[c]);n&&(l.withCredentials=!0),l.send(s)}catch(e){u.console.error("%s while making AJAX request: %s",e.name,e.message),l.onreadystatechange=function(){},u.isFunction(i)&&i(l,e)}return l},jsonp:function(e){var i,t=e.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=e.callbackName||"openseadragon"+u.now(),o=window[r],s=e.param||"callback",a=e.callback,t=t.replace(/(=)\?(&|$)|\?\?/i,"$1"+r+"$2");t+=(/\?/.test(t)?"&":"?")+s+"="+r,window[r]=function(e){if(o)window[r]=o;else try{delete window[r]}catch(e){}a&&u.isFunction(a)&&a(e)},i=document.createElement("script"),void 0===e.async&&!1===e.async||(i.async="async"),e.scriptCharset&&(i.charset=e.scriptCharset),i.src=t,i.onload=i.onreadystatechange=function(e,t){!t&&i.readyState&&!/loaded|complete/.test(i.readyState)||(i.onload=i.onreadystatechange=null,n&&i.parentNode&&n.removeChild(i),i=void 0)},n.insertBefore(i,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)u.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");u.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return u.parseXml(e)},parseJSON:function(e){return u.parseJSON=window.JSON.parse,u.parseJSON(e)},imageFormatSupported:function(e){return!!h[(e=e||"").toLowerCase()]},setImageFormatsSupported:function(e){u.extend(h,e)}}),u.console=window.console||{log:t,debug:t,info:t,warn:t,error:t,assert:t};var i,n,r,o,s,a,l,h={bmp:!(u.Browser={vendor:u.BROWSERS.UNKNOWN,version:0,alpha:!0}),jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},c={},d=navigator.appVersion,p=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(u.Browser.vendor=u.BROWSERS.IE,u.Browser.version=parseFloat(p.substring(p.indexOf("MSIE")+5,p.indexOf(";",p.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=p.indexOf("Edge")?(u.Browser.vendor=u.BROWSERS.EDGE,u.Browser.version=parseFloat(p.substring(p.indexOf("Edge")+5))):0<=p.indexOf("Edg")?(u.Browser.vendor=u.BROWSERS.CHROMEEDGE,u.Browser.version=parseFloat(p.substring(p.indexOf("Edg")+4))):0<=p.indexOf("Firefox")?(u.Browser.vendor=u.BROWSERS.FIREFOX,u.Browser.version=parseFloat(p.substring(p.indexOf("Firefox")+8))):0<=p.indexOf("Safari")?(u.Browser.vendor=0<=p.indexOf("Chrome")?u.BROWSERS.CHROME:u.BROWSERS.SAFARI,u.Browser.version=parseFloat(p.substring(p.substring(0,p.indexOf("Safari")).lastIndexOf("/")+1,p.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(p)&&(u.Browser.vendor=u.BROWSERS.IE,u.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":u.Browser.vendor=u.BROWSERS.OPERA,u.Browser.version=parseFloat(d)}for(var g,m=window.location.search.substring(1).split("&"),f=0;f<m.length;f++)if(0<(y=(g=m[f]).indexOf("="))){var v=g.substring(0,y),y=g.substring(y+1);try{c[v]=decodeURIComponent(y)}catch(d){u.console.error("Ignoring malformed URL parameter: %s=%s",v,y)}}function w(e,t){return t&&e!==document.body?document.body:e.offsetParent}u.Browser.alpha=!(u.Browser.vendor===u.BROWSERS.CHROME&&u.Browser.version<2),u.Browser.opacity=!0,u.Browser.vendor===u.BROWSERS.IE&&u.Browser.version<11&&u.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon"),i=window,a=i.requestAnimationFrame||i.mozRequestAnimationFrame||i.webkitRequestAnimationFrame||i.msRequestAnimationFrame,l=i.cancelAnimationFrame||i.mozCancelAnimationFrame||i.webkitCancelAnimationFrame||i.msCancelAnimationFrame,a&&l?(u.requestAnimationFrame=function(){return a.apply(i,arguments)},u.cancelAnimationFrame=function(){return l.apply(i,arguments)}):(r=[],o=[],s=0,u.requestAnimationFrame=function(e){return r.push([++s,e]),n=n||setInterval(function(){if(r.length){var e=u.now(),t=o;for(o=r,r=t;o.length;)o.shift()[1](e)}else clearInterval(n),n=void 0},20),s},u.cancelAnimationFrame=function(e){for(var t=0,i=r.length;t<i;t+=1)if(r[t][0]===e)return void r.splice(t,1);for(t=0,i=o.length;t<i;t+=1)if(o[t][0]===e)return void o.splice(t,1)})}(OpenSeadragon),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.OpenSeadragon=t()}(this,function(){return OpenSeadragon}),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(e){return e.requestFullscreen()},t.exitFullScreen=function(){document.exitFullscreen()},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(e){return e.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(e){return e.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return null!==t.getFullScreenElement()},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(OpenSeadragon),function(o){o.EventSource=function(){this.events={}},o.EventSource.prototype={addOnceHandler:function(i,n,e,r){var o=this,s=(r=r||1,0);this.addHandler(i,function e(t){++s===r&&o.removeHandler(i,e),n(t)},e)},addHandler:function(e,t,i){var n=this.events[e];n||(this.events[e]=n=[]),t&&o.isFunction(t)&&(n[n.length]={handler:t,userData:i||null})},removeHandler:function(e,t){var i,n=this.events[e],r=[];if(n&&o.isArray(n)){for(i=0;i<n.length;i++)n[i].handler!==t&&r.push(n[i]);this.events[e]=r}},numberOfHandlers:function(e){return(e=this.events[e])?e.length:0},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var r=this.events[e];return r&&r.length?(r=1===r.length?[r[0]]:Array.apply(null,r),function(e,t){for(var i=r.length,n=0;n<i;n++)r[n]&&(t.eventSource=e,t.userData=r[n].userData,r[n].handler(t))}):null},raiseEvent:function(e,t){(e=this.getHandler(e))&&e(this,t=t||{})}}}(OpenSeadragon),function(c){var a,o,l,e,i=[],u={},s=(c.MouseTracker=function(e){i.push(this);var t=arguments,h=(c.isPlainObject(e)||(e={element:t[0],clickTimeThreshold:t[1],clickDistThreshold:t[2]}),this.hash=Math.random(),this.element=c.getElement(e.element),this.clickTimeThreshold=e.clickTimeThreshold||c.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=e.clickDistThreshold||c.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=e.dblClickTimeThreshold||c.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=e.dblClickDistThreshold||c.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=e.userData||null,this.stopDelay=e.stopDelay||50,this.preProcessEventHandler=e.preProcessEventHandler||null,this.contextMenuHandler=e.contextMenuHandler||null,this.enterHandler=e.enterHandler||null,this.leaveHandler=e.leaveHandler||null,this.exitHandler=e.exitHandler||null,this.overHandler=e.overHandler||null,this.outHandler=e.outHandler||null,this.pressHandler=e.pressHandler||null,this.nonPrimaryPressHandler=e.nonPrimaryPressHandler||null,this.releaseHandler=e.releaseHandler||null,this.nonPrimaryReleaseHandler=e.nonPrimaryReleaseHandler||null,this.moveHandler=e.moveHandler||null,this.scrollHandler=e.scrollHandler||null,this.clickHandler=e.clickHandler||null,this.dblClickHandler=e.dblClickHandler||null,this.dragHandler=e.dragHandler||null,this.dragEndHandler=e.dragEndHandler||null,this.pinchHandler=e.pinchHandler||null,this.stopHandler=e.stopHandler||null,this.keyDownHandler=e.keyDownHandler||null,this.keyUpHandler=e.keyUpHandler||null,this.keyHandler=e.keyHandler||null,this.focusHandler=e.focusHandler||null,this.blurHandler=e.blurHandler||null,this);u[this.hash]={click:function(e){var t;z(h,t={originalEvent:e=e,eventType:"click",pointerType:"mouse",isEmulated:!1}),t.preventDefault&&!t.defaultPrevented&&c.cancelEvent(e),t.stopPropagation&&c.stopEvent(e)},dblclick:function(e){var t;z(h,t={originalEvent:e=e,eventType:"dblclick",pointerType:"mouse",isEmulated:!1}),t.preventDefault&&!t.defaultPrevented&&c.cancelEvent(e),t.stopPropagation&&c.stopEvent(e)},keydown:function(e){var t,i,n;i=null,z(t=h,n={originalEvent:e=e,eventType:"keydown",pointerType:"",isEmulated:!1}),!t.keyDownHandler||n.preventGesture||n.defaultPrevented||(i={eventSource:t,keyCode:e.keyCode||e.charCode,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e,preventDefault:n.preventDefault||n.defaultPrevented,userData:t.userData},t.keyDownHandler(i)),(i&&i.preventDefault||n.preventDefault&&!n.defaultPrevented)&&c.cancelEvent(e),n.stopPropagation&&c.stopEvent(e)},keyup:function(e){var t,i,n;i=null,z(t=h,n={originalEvent:e=e,eventType:"keyup",pointerType:"",isEmulated:!1}),!t.keyUpHandler||n.preventGesture||n.defaultPrevented||(i={eventSource:t,keyCode:e.keyCode||e.charCode,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e,preventDefault:n.preventDefault||n.defaultPrevented,userData:t.userData},t.keyUpHandler(i)),(i&&i.preventDefault||n.preventDefault&&!n.defaultPrevented)&&c.cancelEvent(e),n.stopPropagation&&c.stopEvent(e)},keypress:function(e){var t,i,n;i=null,z(t=h,n={originalEvent:e=e,eventType:"keypress",pointerType:"",isEmulated:!1}),!t.keyHandler||n.preventGesture||n.defaultPrevented||(i={eventSource:t,keyCode:e.keyCode||e.charCode,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e,preventDefault:n.preventDefault||n.defaultPrevented,userData:t.userData},t.keyHandler(i)),(i&&i.preventDefault||n.preventDefault&&!n.defaultPrevented)&&c.cancelEvent(e),n.stopPropagation&&c.stopEvent(e)},focus:function(e){var t,i;z(t=h,i={originalEvent:e=e,eventType:"focus",pointerType:"",isEmulated:!1}),t.focusHandler&&!i.preventGesture&&t.focusHandler({eventSource:t,originalEvent:e,userData:t.userData})},blur:function(e){var t,i;z(t=h,i={originalEvent:e=e,eventType:"blur",pointerType:"",isEmulated:!1}),t.blurHandler&&!i.preventGesture&&t.blurHandler({eventSource:t,originalEvent:e,userData:t.userData})},contextmenu:function(e){var t,i,n;i=null,z(t=h,n={originalEvent:e=e,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1}),!t.contextMenuHandler||n.preventGesture||n.defaultPrevented||(i={eventSource:t,position:x(y(e),t.element),originalEvent:n.originalEvent,preventDefault:n.preventDefault||n.defaultPrevented,userData:t.userData},t.contextMenuHandler(i)),(i&&i.preventDefault||n.preventDefault&&!n.defaultPrevented)&&c.cancelEvent(e),n.stopPropagation&&c.stopEvent(e)},wheel:function(e){S(h,e,e)},mousewheel:function(e){n(h,e)},DOMMouseScroll:function(e){n(h,e)},MozMousePixelScroll:function(e){n(h,e)},losecapture:function(e){var t,i,n;t=h,e=e,i={id:c.MouseTracker.mousePointerId,type:"mouse"},z(t,n={originalEvent:e,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1}),e.target===t.element&&B(t,i,!1),n.stopPropagation&&c.stopEvent(e)},mouseenter:function(e){E(h,e)},mouseleave:function(e){b(h,e)},mouseover:function(e){_(h,e)},mouseout:function(e){P(h,e)},mousedown:function(e){C(h,e)},mouseup:function(e){R(h,e)},mousemove:function(e){D(h,e)},touchstart:function(e){var t,i,n=h,r=e,o=r.changedTouches.length,s=n.getActivePointersListByType("touch"),a=c.now(),l=(s.getLength()>r.touches.length-o&&c.console.warn("Tracked touch contact count doesn't match event.touches.length"),{originalEvent:r,eventType:"pointerdown",pointerType:"touch",isEmulated:!1});for(z(n,l),t=0;t<o;t++)H(n,l,i={id:r.changedTouches[t].identifier,type:"touch",isPrimary:0===s.getLength(),currentPos:y(r.changedTouches[t]),currentTime:a}),N(n,l,i,0),B(n,i,!0);l.preventDefault&&!l.defaultPrevented&&c.cancelEvent(r),l.stopPropagation&&c.stopEvent(r)},touchend:function(e){var t,i,n=h,r=e,o=r.changedTouches.length,s=c.now(),a={originalEvent:r,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(z(n,a),t=0;t<o;t++)M(n,a,i={id:r.changedTouches[t].identifier,type:"touch",currentPos:y(r.changedTouches[t]),currentTime:s},0),B(n,i,!1),A(n,a,i);a.preventDefault&&!a.defaultPrevented&&c.cancelEvent(r),a.stopPropagation&&c.stopEvent(r)},touchmove:function(e){var t,i=h,n=e,r=n.changedTouches.length,o=c.now(),s={originalEvent:n,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(z(i,s),t=0;t<r;t++)j(i,s,{id:n.changedTouches[t].identifier,type:"touch",currentPos:y(n.changedTouches[t]),currentTime:o});s.preventDefault&&!s.defaultPrevented&&c.cancelEvent(n),s.stopPropagation&&c.stopEvent(n)},touchcancel:function(e){var t,i=h,n=e,r=n.changedTouches.length,e={originalEvent:n,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(z(i,e),t=0;t<r;t++)W(i,0,{id:n.changedTouches[t].identifier,type:"touch"});e.stopPropagation&&c.stopEvent(n)},gesturestart:function(e){c.eventIsCanceled(e)||e.preventDefault()},gesturechange:function(e){c.eventIsCanceled(e)||e.preventDefault()},gotpointercapture:function(e){var t,i;t=h,i={originalEvent:e=e,eventType:"gotpointercapture",pointerType:f(e),isEmulated:!1},z(t,i),e.target===t.element&&B(t,{id:e.pointerId,type:f(e)},!0),i.stopPropagation&&c.stopEvent(e)},lostpointercapture:function(e){var t,i;t=h,i={originalEvent:e=e,eventType:"lostpointercapture",pointerType:f(e),isEmulated:!1},z(t,i),e.target===t.element&&B(t,{id:e.pointerId,type:f(e)},!1),i.stopPropagation&&c.stopEvent(e)},pointerenter:function(e){E(h,e)},pointerleave:function(e){b(h,e)},pointerover:function(e){_(h,e)},pointerout:function(e){P(h,e)},pointerdown:function(e){C(h,e)},pointerup:function(e){R(h,e)},pointermove:function(e){D(h,e)},pointercancel:function(e){var t,i,n;t=h,i={id:(e=e).pointerId,type:f(e)},z(t,n={originalEvent:e,eventType:"pointercancel",pointerType:i.type,isEmulated:!1}),W(t,0,i),n.stopPropagation&&c.stopEvent(e)},pointerupcaptured:function(e){var t;e=e,(t=h).getActivePointersListByType(f(e)).getById(e.pointerId)&&k(t,e),c.stopEvent(e)},pointermovecaptured:function(e){var t;e=e,(t=h).getActivePointersListByType(f(e)).getById(e.pointerId)&&O(t,e),c.stopEvent(e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,c.MouseTracker.havePointerEvents&&c.setElementPointerEvents(this.element,"auto"),this.exitHandler&&c.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),e.startDisabled||this.setTracking(!0)},c.MouseTracker.prototype={destroy:function(){var e;for(t(this),this.element=null,e=0;e<i.length;e++)if(i[e]===this){i.splice(e,1);break}u[this.hash]=null,delete u[this.hash]},isTracking:function(){return u[this.hash].tracking},setTracking:function(e){return(e?function(e){var t,i,n=u[e.hash];if(!n.tracking){for(i=0;i<c.MouseTracker.subscribeEvents.length;i++)t=c.MouseTracker.subscribeEvents[i],c.addEvent(e.element,t,n[t],t===c.MouseTracker.wheelEventName&&{passive:!1,capture:!1});r(e),n.tracking=!0}}:t)(this),this},getActivePointersListByType:function(e){for(var t,i=u[this.hash],n=i.activePointersLists.length,r=0;r<n;r++)if(i.activePointersLists[r].type===e)return i.activePointersLists[r];return t=new c.MouseTracker.GesturePointList(e),i.activePointersLists.push(t),t},getActivePointerCount:function(){for(var e=u[this.hash],t=e.activePointersLists.length,i=0,n=0;n<t;n++)i+=e.activePointersLists[n].getLength();return i},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},function(){try{return window.self!==window.top}catch(e){return!0}}());function h(e){try{return e.addEventListener&&e.removeEventListener}catch(e){}}function d(e,t){return e.hash.toString()+t.type+t.id.toString()}function F(){var e,t,i,n,r=a.length,o=c.now(),s=o-l;for(l=o,e=0;e<r;e++)(i=(t=a[e]).gPoint).direction=Math.atan2(i.currentPos.y-t.lastPos.y,i.currentPos.x-t.lastPos.x),n=t.lastPos.distanceTo(i.currentPos),t.lastPos=i.currentPos,i.speed=1e3*n/(1+s)*.75+.25*i.speed}function r(e){for(var t,i,n,r,o=u[e.hash],s=o.activePointersLists.length,a=0;a<s;a++)if(0<(i=o.activePointersLists[a]).getLength()){for(r=[],n=i.asArray(),t=0;t<n.length;t++)r.push(n[t]);for(t=0;t<r.length;t++)L(e,i,r[t])}for(a=0;a<s;a++)o.activePointersLists.pop();o.sentDragEvent=!1}function t(e){var t,i,n=u[e.hash];if(n.tracking){for(i=0;i<c.MouseTracker.subscribeEvents.length;i++)t=c.MouseTracker.subscribeEvents[i],c.removeEvent(e.element,t,n[t],!1);r(e),n.tracking=!1}}function p(e,t){if(e=u[e.hash],"pointerevent"===t)return{upName:"pointerup",upHandler:e.pointerupcaptured,moveName:"pointermove",moveHandler:e.pointermovecaptured};if("mouse"===t)return{upName:"pointerup",upHandler:e.pointerupcaptured,moveName:"pointermove",moveHandler:e.pointermovecaptured};if("touch"===t)return{upName:"touchend",upHandler:e.touchendcaptured,moveName:"touchmove",moveHandler:e.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function g(e,t){var i;if(c.MouseTracker.havePointerCapture)if(c.MouseTracker.havePointerEvents){if(!(i=e.getActivePointersListByType(t.type).getById(t.id))||!i.captured)return;try{e.element.releasePointerCapture(t.id)}catch(e){}}else e.element.releaseCapture();else i=p(e,c.MouseTracker.havePointerEvents?"pointerevent":t.type),s&&h(window.top)&&c.removeEvent(window.top,i.upName,i.upHandler,!0),c.removeEvent(c.MouseTracker.captureElement,i.moveName,i.moveHandler,!0),c.removeEvent(c.MouseTracker.captureElement,i.upName,i.upHandler,!0);B(e,t,!1)}function m(e){return c.MouseTracker.havePointerEvents?e.pointerId:c.MouseTracker.mousePointerId}function f(e){return c.MouseTracker.havePointerEvents?e.pointerType||(c.Browser.vendor===c.BROWSERS.IE?"mouse":""):"mouse"}function v(e){return!c.MouseTracker.havePointerEvents||e.isPrimary}function y(e){return c.getMousePosition(e)}function w(e,t){return x(y(e),t)}function x(e,t){return t=c.getElementOffset(t),e.minus(t)}function T(e,t){return new c.Point((e.x+t.x)/2,(e.y+t.y)/2)}function n(e,t){var i={target:t.target||t.srcElement,type:"wheel",shiftKey:t.shiftKey||!1,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX||t.clientX,pageY:t.pageY||t.clientY,deltaMode:"MozMousePixelScroll"===t.type?0:1,deltaX:0,deltaZ:0};"mousewheel"===c.MouseTracker.wheelEventName?i.deltaY=-t.wheelDelta/c.DEFAULT_SETTINGS.pixelsPerWheelLine:i.deltaY=t.detail,S(e,i,t)}function S(e,t,i){var n,r=null,o=t.deltaY<0?1:-1;z(e,n={originalEvent:t,eventType:"wheel",pointerType:"mouse",isEmulated:t!==i}),!e.scrollHandler||n.preventGesture||n.defaultPrevented||(r={eventSource:e,pointerType:"mouse",position:w(t,e.element),scroll:o,shift:t.shiftKey,isTouchEvent:!1,originalEvent:i,preventDefault:n.preventDefault||n.defaultPrevented,userData:e.userData},e.scrollHandler(r)),n.stopPropagation&&c.stopEvent(i),(r&&r.preventDefault||n.preventDefault&&!n.defaultPrevented)&&c.cancelEvent(i)}function E(e,t){var i={id:m(t),type:f(t),isPrimary:v(t),currentPos:y(t),currentTime:c.now()};z(e,t={originalEvent:t,eventType:"pointerenter",pointerType:i.type,isEmulated:!1}),H(e,t,i)}function b(e,t){var i={id:m(t),type:f(t),isPrimary:v(t),currentPos:y(t),currentTime:c.now()};z(e,t={originalEvent:t,eventType:"pointerleave",pointerType:i.type,isEmulated:!1}),A(e,t,i)}function _(e,t){var i,n,r,o={id:m(t),type:f(t),isPrimary:v(t),currentPos:y(t),currentTime:c.now()},s={originalEvent:t,eventType:"pointerover",pointerType:o.type,isEmulated:!1};z(e,s),i=s,o=o,r=(e=e).getActivePointersListByType(o.type),(n=r.getById(o.id))?o=n:(o.captured=!1,o.insideElementPressed=!1),e.overHandler&&e.overHandler({eventSource:e,pointerType:o.type,position:x(o.currentPos,e.element),buttons:r.buttons,pointers:e.getActivePointerCount(),insideElementPressed:o.insideElementPressed,buttonDownAny:0!==r.buttons,isTouchEvent:"touch"===o.type,originalEvent:i.originalEvent,userData:e.userData}),s.preventDefault&&!s.defaultPrevented&&c.cancelEvent(t),s.stopPropagation&&c.stopEvent(t)}function P(e,t){var i,n,r,o={id:m(t),type:f(t),isPrimary:v(t),currentPos:y(t),currentTime:c.now()},s={originalEvent:t,eventType:"pointerout",pointerType:o.type,isEmulated:!1};z(e,s),i=s,o=o,r=(e=e).getActivePointersListByType(o.type),(n=r.getById(o.id))?o=n:(o.captured=!1,o.insideElementPressed=!1),e.outHandler&&e.outHandler({eventSource:e,pointerType:o.type,position:o.currentPos&&x(o.currentPos,e.element),buttons:r.buttons,pointers:e.getActivePointerCount(),insideElementPressed:o.insideElementPressed,buttonDownAny:0!==r.buttons,isTouchEvent:"touch"===o.type,originalEvent:i.originalEvent,userData:e.userData}),s.preventDefault&&!s.defaultPrevented&&c.cancelEvent(t),s.stopPropagation&&c.stopEvent(t)}function C(e,t){var i={id:m(t),type:f(t),isPrimary:v(t),currentPos:y(t),currentTime:c.now()},n=c.MouseTracker.havePointerEvents&&"touch"===i.type&&c.Browser.vendor!==c.BROWSERS.IE,r={originalEvent:t,eventType:"pointerdown",pointerType:i.type,isEmulated:!1};if(z(e,r),N(e,r,i,t.button),r.preventDefault&&!r.defaultPrevented&&c.cancelEvent(t),r.stopPropagation&&c.stopEvent(t),r.shouldCapture)if(n)B(e,i,!0);else{var o=e,t=i;if(c.MouseTracker.havePointerCapture)if(c.MouseTracker.havePointerEvents)try{o.element.setPointerCapture(t.id)}catch(o){return void c.console.warn("setPointerCapture() called on invalid pointer ID")}else o.element.setCapture(!0);else r=p(o,c.MouseTracker.havePointerEvents?"pointerevent":t.type),s&&h(window.top)&&c.addEvent(window.top,r.upName,r.upHandler,!0),c.addEvent(c.MouseTracker.captureElement,r.upName,r.upHandler,!0),c.addEvent(c.MouseTracker.captureElement,r.moveName,r.moveHandler,!0);B(o,t,!0)}}function R(e,t){k(e,t)}function k(e,t){var i,n={originalEvent:t,eventType:"pointerup",pointerType:(i={id:m(t),type:f(t),isPrimary:v(t),currentPos:y(t),currentTime:c.now()}).type,isEmulated:!1};z(e,n),M(e,n,i,t.button),n.preventDefault&&!n.defaultPrevented&&c.cancelEvent(t),n.stopPropagation&&c.stopEvent(t),n.shouldReleaseCapture&&(t.target===e.element?g(e,i):B(e,i,!1))}function D(e,t){O(e,t)}function O(e,t){var i={id:m(t),type:f(t),isPrimary:v(t),currentPos:y(t),currentTime:c.now()},n={originalEvent:t,eventType:"pointermove",pointerType:i.type,isEmulated:!1};z(e,n),j(e,n,i),n.preventDefault&&!n.defaultPrevented&&c.cancelEvent(t),n.stopPropagation&&c.stopEvent(t)}function I(e,t){t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function L(e,t,i){var n=t.getById(i.id);n?(n.captured&&(c.console.warn("stopTrackingPointer() called on captured pointer"),g(e,n)),t.removeContact(),t.removeById(i.id)):t.getLength()}function z(e,t){t.eventSource=e,t.eventPhase=t.originalEvent&&void 0!==t.originalEvent.eventPhase?t.originalEvent.eventPhase:0,t.defaultPrevented=c.eventIsCanceled(t.originalEvent),t.shouldCapture=!1,t.shouldReleaseCapture=!1,t.userData=e.userData;var i=e,n=t;switch(n.eventType){case"pointermove":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!1,n.preventGesture=!i.hasGestureHandlers,n.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!1,n.preventGesture=!1,n.stopPropagation=!1;break;case"pointerdown":case"pointerup":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!1,n.preventGesture=!i.hasGestureHandlers,n.stopPropagation=!1;break;case"wheel":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!1,n.preventGesture=!i.hasScrollHandler,n.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":n.isStoppable=!0,n.isCancelable=!1,n.preventDefault=!1,n.preventGesture=!1,n.stopPropagation=!1;break;case"click":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!!i.clickHandler,n.preventGesture=!1,n.stopPropagation=!1;break;case"dblclick":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!!i.dblClickHandler,n.preventGesture=!1,n.stopPropagation=!1;break;default:n.isStoppable=!1,n.isCancelable=!1,n.preventDefault=!1,n.preventGesture=!1,n.stopPropagation=!1}e.preProcessEventHandler&&e.preProcessEventHandler(t)}function B(e,t,i){(t=(e=e.getActivePointersListByType(t.type)).getById(t.id))?i&&!t.captured?(t.captured=!0,e.captureCount++):!i&&t.captured&&(t.captured=!1,e.captureCount--,e.captureCount<0)&&(e.captureCount=0,c.console.warn("updatePointerCaptured() - pointsList.captureCount went negative")):c.console.warn("updatePointerCaptured() called on untracked pointer")}function H(e,t,i){var n,r=e.getActivePointersListByType(i.type);(n=r.getById(i.id))?(n.insideElement=!0,n.lastPos=n.currentPos,n.lastTime=n.currentTime,n.currentPos=i.currentPos,n.currentTime=i.currentTime,i=n):(i.captured=!1,i.insideElementPressed=!1,i.insideElement=!0,I(r,i)),e.enterHandler&&e.enterHandler({eventSource:e,pointerType:i.type,position:x(i.currentPos,e.element),buttons:r.buttons,pointers:e.getActivePointerCount(),insideElementPressed:i.insideElementPressed,buttonDownAny:0!==r.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData})}function A(e,t,i){var n,r=e.getActivePointersListByType(i.type);(n=r.getById(i.id))?(n.captured?(n.insideElement=!1,n.lastPos=n.currentPos,n.lastTime=n.currentTime,n.currentPos=i.currentPos,n.currentTime=i.currentTime):L(e,r,n),i=n):(i.captured=!1,i.insideElementPressed=!1),(e.leaveHandler||e.exitHandler)&&(t={eventSource:e,pointerType:i.type,position:i.currentPos&&x(i.currentPos,e.element),buttons:r.buttons,pointers:e.getActivePointerCount(),insideElementPressed:i.insideElementPressed,buttonDownAny:0!==r.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData},e.leaveHandler&&e.leaveHandler(t),e.exitHandler)&&e.exitHandler(t)}function N(e,t,i,n){var r,o=u[e.hash],s=e.getActivePointersListByType(i.type);void 0!==t.originalEvent.buttons?s.buttons=t.originalEvent.buttons:0===n?s.buttons|=1:1===n?s.buttons|=4:2===n?s.buttons|=2:3===n?s.buttons|=8:4===n?s.buttons|=16:5===n&&(s.buttons|=32),0===n?((r=s.getById(i.id))?(r.insideElementPressed=!0,r.insideElement=!0,r.originalTarget=t.originalEvent.target,r.contactPos=i.currentPos,r.contactTime=i.currentTime,r.lastPos=r.currentPos,r.lastTime=r.currentTime,r.currentPos=i.currentPos,r.currentTime=i.currentTime,i=r):(i.captured=!1,i.insideElementPressed=!0,i.insideElement=!0,i.originalTarget=t.originalEvent.target,I(s,i)),s.addContact(),t.preventGesture||t.defaultPrevented?(t.shouldCapture=!1,t.shouldReleaseCapture=!1):(t.shouldCapture=!0,t.shouldReleaseCapture=!1,t.preventDefault=!0,(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&c.MouseTracker.gesturePointVelocityTracker.addPoint(e,i),1===s.contacts?e.pressHandler&&!t.preventGesture&&e.pressHandler({eventSource:e,pointerType:i.type,position:x(i.contactPos,e.element),buttons:s.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData}):2===s.contacts&&e.pinchHandler&&"touch"===i.type&&(o.pinchGPoints=s.asArray(),o.lastPinchDist=o.currentPinchDist=o.pinchGPoints[0].currentPos.distanceTo(o.pinchGPoints[1].currentPos),o.lastPinchCenter=o.currentPinchCenter=T(o.pinchGPoints[0].currentPos,o.pinchGPoints[1].currentPos)))):(t.shouldCapture=!1,t.shouldReleaseCapture=!1,!e.nonPrimaryPressHandler||t.preventGesture||t.defaultPrevented||(t.preventDefault=!0,e.nonPrimaryPressHandler({eventSource:e,pointerType:i.type,position:x(i.currentPos,e.element),button:n,buttons:s.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData})))}function M(e,t,i,n){var r,o,s,a=u[e.hash],l=e.getActivePointersListByType(i.type),h=!1;void 0!==t.originalEvent.buttons?l.buttons=t.originalEvent.buttons:0===n?l.buttons^=-2:1===n?l.buttons^=-5:2===n?l.buttons^=-3:3===n?l.buttons^=-9:4===n?l.buttons^=-17:5===n&&(l.buttons^=-33),t.shouldCapture=!1,0===n?((o=l.getById(i.id))?(l.removeContact(),o.captured&&(h=!0),o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=i.currentPos,o.currentTime=i.currentTime,o.insideElement||L(e,l,o),r=o.currentPos,s=o.currentTime):(i.captured=!1,i.insideElementPressed=!1,i.insideElement=!0,I(l,i),o=i),t.preventGesture||t.defaultPrevented||(h?(t.shouldReleaseCapture=!0,t.preventDefault=!0,(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&c.MouseTracker.gesturePointVelocityTracker.removePoint(e,o),0===l.contacts?(e.releaseHandler&&r&&e.releaseHandler({eventSource:e,pointerType:o.type,position:x(r,e.element),buttons:l.buttons,insideElementPressed:o.insideElementPressed,insideElementReleased:o.insideElement,isTouchEvent:"touch"===o.type,originalEvent:t.originalEvent,userData:e.userData}),e.dragEndHandler&&a.sentDragEvent&&e.dragEndHandler({eventSource:e,pointerType:o.type,position:x(o.currentPos,e.element),speed:o.speed,direction:o.direction,shift:t.originalEvent.shiftKey,isTouchEvent:"touch"===o.type,originalEvent:t.originalEvent,userData:e.userData}),a.sentDragEvent=!1,(e.clickHandler||e.dblClickHandler)&&o.insideElement&&(s=s-o.contactTime<=e.clickTimeThreshold&&o.contactPos.distanceTo(r)<=e.clickDistThreshold,e.clickHandler&&e.clickHandler({eventSource:e,pointerType:o.type,position:x(o.currentPos,e.element),quick:s,shift:t.originalEvent.shiftKey,isTouchEvent:"touch"===o.type,originalEvent:t.originalEvent,originalTarget:o.originalTarget,userData:e.userData}),e.dblClickHandler)&&s&&(l.clicks++,1===l.clicks?(a.lastClickPos=r,a.dblClickTimeOut=setTimeout(function(){l.clicks=0},e.dblClickTimeThreshold)):2===l.clicks&&(clearTimeout(a.dblClickTimeOut),l.clicks=0,a.lastClickPos.distanceTo(r)<=e.dblClickDistThreshold&&e.dblClickHandler({eventSource:e,pointerType:o.type,position:x(o.currentPos,e.element),shift:t.originalEvent.shiftKey,isTouchEvent:"touch"===o.type,originalEvent:t.originalEvent,userData:e.userData}),a.lastClickPos=null))):2===l.contacts&&e.pinchHandler&&"touch"===o.type&&(a.pinchGPoints=l.asArray(),a.lastPinchDist=a.currentPinchDist=a.pinchGPoints[0].currentPos.distanceTo(a.pinchGPoints[1].currentPos),a.lastPinchCenter=a.currentPinchCenter=T(a.pinchGPoints[0].currentPos,a.pinchGPoints[1].currentPos))):(t.shouldReleaseCapture=!1,e.releaseHandler&&r&&(e.releaseHandler({eventSource:e,pointerType:o.type,position:x(r,e.element),buttons:l.buttons,insideElementPressed:o.insideElementPressed,insideElementReleased:o.insideElement,isTouchEvent:"touch"===o.type,originalEvent:t.originalEvent,userData:e.userData}),t.preventDefault=!0)))):(t.shouldReleaseCapture=!1,!e.nonPrimaryReleaseHandler||t.preventGesture||t.defaultPrevented||(t.preventDefault=!0,e.nonPrimaryReleaseHandler({eventSource:e,pointerType:i.type,position:x(i.currentPos,e.element),button:n,buttons:l.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData})))}function j(n,r,o){var e,t,i=u[n.hash],s=n.getActivePointersListByType(o.type);void 0!==r.originalEvent.buttons&&(s.buttons=r.originalEvent.buttons),(e=s.getById(o.id))&&(e.lastPos=e.currentPos,e.lastTime=e.currentTime,e.currentPos=o.currentPos,e.currentTime=o.currentTime,r.shouldCapture=!1,r.shouldReleaseCapture=!1,n.stopHandler&&"mouse"===o.type&&(clearTimeout(n.stopTimeOut),n.stopTimeOut=setTimeout(function(){var e=n,t=r.originalEvent,i=o.type;e.stopHandler&&e.stopHandler({eventSource:e,pointerType:i,position:w(t,e.element),buttons:e.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:t,userData:e.userData})},n.stopDelay)),0===s.contacts?n.moveHandler&&n.moveHandler({eventSource:n,pointerType:o.type,position:x(o.currentPos,n.element),buttons:s.buttons,isTouchEvent:"touch"===o.type,originalEvent:r.originalEvent,userData:n.userData}):1===s.contacts?(n.moveHandler&&(e=s.asArray()[0],n.moveHandler({eventSource:n,pointerType:e.type,position:x(e.currentPos,n.element),buttons:s.buttons,isTouchEvent:"touch"===e.type,originalEvent:r.originalEvent,userData:n.userData})),!n.dragHandler||r.preventGesture||r.defaultPrevented||(t=(e=s.asArray()[0]).currentPos.minus(e.lastPos),n.dragHandler({eventSource:n,pointerType:e.type,position:x(e.currentPos,n.element),buttons:s.buttons,delta:t,speed:e.speed,direction:e.direction,shift:r.originalEvent.shiftKey,isTouchEvent:"touch"===e.type,originalEvent:r.originalEvent,userData:n.userData}),r.preventDefault=!0,i.sentDragEvent=!0)):2===s.contacts&&(n.moveHandler&&(e=s.asArray(),n.moveHandler({eventSource:n,pointerType:e[0].type,position:x(T(e[0].currentPos,e[1].currentPos),n.element),buttons:s.buttons,isTouchEvent:"touch"===e[0].type,originalEvent:r.originalEvent,userData:n.userData})),!n.pinchHandler||"touch"!==o.type||r.preventGesture||r.defaultPrevented||(t=i.pinchGPoints[0].currentPos.distanceTo(i.pinchGPoints[1].currentPos))===i.currentPinchDist||(i.lastPinchDist=i.currentPinchDist,i.currentPinchDist=t,i.lastPinchCenter=i.currentPinchCenter,i.currentPinchCenter=T(i.pinchGPoints[0].currentPos,i.pinchGPoints[1].currentPos),n.pinchHandler({eventSource:n,pointerType:"touch",gesturePoints:i.pinchGPoints,lastCenter:x(i.lastPinchCenter,n.element),center:x(i.currentPinchCenter,n.element),lastDistance:i.lastPinchDist,distance:i.currentPinchDist,shift:r.originalEvent.shiftKey,originalEvent:r.originalEvent,userData:n.userData}),r.preventDefault=!0)))}function W(e,t,i){var n=e.getActivePointersListByType(i.type);(i=n.getById(i.id))&&L(e,n,i)}c.MouseTracker.gesturePointVelocityTracker=(a=[],l=o=0,{addPoint:function(e,t){e=d(e,t),a.push({guid:e,gPoint:t,lastPos:t.currentPos}),1===a.length&&(l=c.now(),o=window.setInterval(F,50))},removePoint:function(e,t){for(var i=d(e,t),n=a.length,r=0;r<n;r++)if(a[r].guid===i){a.splice(r,1),0==--n&&window.clearInterval(o);break}}}),c.MouseTracker.captureElement=document,c.MouseTracker.wheelEventName=c.Browser.vendor===c.BROWSERS.IE&&8<c.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",c.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",c.MouseTracker.wheelEventName],"DOMMouseScroll"===c.MouseTracker.wheelEventName&&c.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(c.MouseTracker.havePointerEvents=!0,c.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),c.MouseTracker.havePointerCapture=(e=document.createElement("div"),c.isFunction(e.setPointerCapture)&&c.isFunction(e.releasePointerCapture)),c.MouseTracker.havePointerCapture&&c.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(c.MouseTracker.havePointerEvents=!1,c.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),c.MouseTracker.mousePointerId="legacy-mouse",c.MouseTracker.havePointerCapture=(e=document.createElement("div"),c.isFunction(e.setCapture)&&c.isFunction(e.releaseCapture)),c.MouseTracker.havePointerCapture&&c.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&c.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&c.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),c.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},c.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){for(var t=this._gPoints.length,i=0;i<t;i++)if(this._gPoints[i].id===e){this._gPoints.splice(i,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){for(var t=this._gPoints.length,i=0;i<t;i++)if(this._gPoints[i].id===e)return this._gPoints[i];return null},getPrimary:function(e){for(var t=this._gPoints.length,i=0;i<t;i++)if(this._gPoints[i].isPrimary)return this._gPoints[i];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(c.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}}}(OpenSeadragon),function(r){r.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},r.Control=function(e,t,i){var n=e.parentNode;"number"==typeof t&&(r.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),t={anchor:t}),t.attachToViewer=void 0===t.attachToViewer||t.attachToViewer,this.autoFade=void 0===t.autoFade||t.autoFade,this.element=e,this.anchor=t.anchor,this.container=i,this.anchor===r.ControlAnchor.ABSOLUTE?(this.wrapper=r.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof t.top?t.top+"px":t.top,this.wrapper.style.left="number"==typeof t.left?t.left+"px":t.left,this.wrapper.style.height="number"==typeof t.height?t.height+"px":t.height,this.wrapper.style.width="number"==typeof t.width?t.width+"px":t.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=r.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===r.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),t.attachToViewer?this.anchor===r.ControlAnchor.TOP_RIGHT||this.anchor===r.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):n.appendChild(this.wrapper)},r.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==r.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!==this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?this.anchor===r.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(e){this.element[r.SIGNAL]&&r.Browser.vendor===r.BROWSERS.IE?r.setElementOpacity(this.element,e,!0):r.setElementOpacity(this.wrapper,e,!0)}}}(OpenSeadragon),function(r){function n(e,t){for(var i=e.controls,n=i.length-1;0<=n;n--)if(i[n].element===t)return n;return-1}r.ControlDock=function(e){var t,i,n=["topleft","topright","bottomright","bottomleft"];for(r.extend(!0,this,{id:"controldock-"+r.now()+"-"+Math.floor(1e6*Math.random()),container:r.makeNeutralElement("div"),controls:[]},e),this.container.onsubmit=function(){return!1},this.element&&(this.element=r.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),i=0;i<n.length;i++)this.controls[t=n[i]]=r.makeNeutralElement("div"),this.controls[t].style.position="absolute",t.match("left")&&(this.controls[t].style.left="0px"),t.match("right")&&(this.controls[t].style.right="0px"),t.match("top")&&(this.controls[t].style.top="0px"),t.match("bottom")&&(this.controls[t].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},r.ControlDock.prototype={addControl:function(e,t){var i=null;if(!(0<=n(this,e=r.getElement(e)))){switch(t.anchor){case r.ControlAnchor.TOP_RIGHT:i=this.controls.topright,e.style.position="relative",e.style.paddingRight="0px",e.style.paddingTop="0px";break;case r.ControlAnchor.BOTTOM_RIGHT:i=this.controls.bottomright,e.style.position="relative",e.style.paddingRight="0px",e.style.paddingBottom="0px";break;case r.ControlAnchor.BOTTOM_LEFT:i=this.controls.bottomleft,e.style.position="relative",e.style.paddingLeft="0px",e.style.paddingBottom="0px";break;case r.ControlAnchor.TOP_LEFT:i=this.controls.topleft,e.style.position="relative",e.style.paddingLeft="0px",e.style.paddingTop="0px";break;case r.ControlAnchor.ABSOLUTE:i=this.container,e.style.margin="0px",e.style.padding="0px";break;default:case r.ControlAnchor.NONE:i=this.container,e.style.margin="0px",e.style.padding="0px"}this.controls.push(new r.Control(e,t,i)),e.style.display="inline-block"}},removeControl:function(e){return 0<=(e=n(this,e=r.getElement(e)))&&(this.controls[e].destroy(),this.controls.splice(e,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){for(var e=this.controls.length-1;0<=e;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){for(var t=this.controls.length-1;0<=t;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(m){var c={},r=1;function a(e){return e=m.getElement(e),new m.Point(0===e.clientWidth?1:e.clientWidth,0===e.clientHeight?1:e.clientHeight)}function h(e,t){var i,n,r,o,s,a;return t instanceof m.Overlay?t:(i=null,t.element?i=m.getElement(t.element):(s=t.id||"openseadragon-overlay-"+Math.floor(1e7*Math.random()),(i=m.getElement(t.id))||((i=document.createElement("a")).href="#/overlay/"+s),i.id=s,m.addClass(i,t.className||"openseadragon-overlay")),n=t.location,r=t.width,o=t.height,n||(s=t.x,a=t.y,void 0!==t.px&&(s=(e=e.viewport.imageToViewportRectangle(new m.Rect(t.px,t.py,r||0,o||0))).x,a=e.y,r=void 0!==r?e.width:void 0,o=void 0!==o?e.height:void 0),n=new m.Point(s,a)),(a=t.placement)&&"string"===m.type(a)&&(a=m.Placement[t.placement.toUpperCase()]),new m.Overlay({element:i,location:n,placement:a,onDraw:t.onDraw,checkResize:t.checkResize,width:r,height:o,rotationMode:t.rotationMode}))}function o(e,t){for(var i=e.length-1;0<=i;i--)if(e[i].element===t)return i;return-1}function l(e,t){return m.requestAnimationFrame(function(){t(e)})}function s(r){m.requestAnimationFrame(function(){var e,t,i,n=r;if(n.controlsShouldFade){for(e=m.now(),t=1-(e-=n.controlsFadeBeginTime)/n.controlsFadeLength,t=Math.min(1,t),t=Math.max(0,t),i=n.controls.length-1;0<=i;i--)n.controls[i].autoFade&&n.controls[i].setOpacity(t);0<t&&s(n)}})}function u(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=m.now()+e.controlsFadeDelay,window.setTimeout(function(){s(e)},e.controlsFadeDelay))}function d(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;0<=t;t--)e.controls[t].setOpacity(1)}function f(){d(this)}function v(){u(this)}function p(e){var t={tracker:e.eventSource,position:e.position,originalEvent:e.originalEvent,preventDefault:e.preventDefault};this.raiseEvent("canvas-contextmenu",t),e.preventDefault=t.preventDefault}function g(e){var t={originalEvent:e.originalEvent,preventDefaultAction:!1,preventVerticalPan:e.preventVerticalPan||!this.panVertical,preventHorizontalPan:e.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",t),t.preventDefaultAction||e.ctrl||e.alt||e.meta)e.preventDefault=!1;else switch(e.keyCode){case 38:t.preventVerticalPan||(e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new m.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 40:t.preventVerticalPan||(e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new m.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 37:t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new m.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 39:t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new m.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),e.preventDefault=!0;break;default:e.preventDefault=!1}}function y(e){var t={originalEvent:e.originalEvent,preventDefaultAction:!1,preventVerticalPan:e.preventVerticalPan||!this.panVertical,preventHorizontalPan:e.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",t),t.preventDefaultAction||e.ctrl||e.alt||e.meta)e.preventDefault=!1;else switch(e.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),e.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),e.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),e.preventDefault=!0;break;case 119:case 87:t.preventVerticalPan||(e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new m.Point(0,-40))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 115:case 83:t.preventVerticalPan||(e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new m.Point(0,40))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 97:t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new m.Point(-40,0))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 100:t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new m.Point(40,0))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 114:this.viewport.flipped?this.viewport.setRotation(m.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(m.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),e.preventDefault=!0;break;case 82:this.viewport.flipped?this.viewport.setRotation(m.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(m.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),e.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),e.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:e.preventDefault=!1}}function w(e){document.activeElement!==this.canvas&&this.canvas.focus(),this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,originalTarget:e.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",t),!t.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType)).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function x(e){var t={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",t),!t.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function T(e){var t,i,n,r={tracker:e.eventSource,pointerType:e.pointerType,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-drag",r),(t=this.gestureSettingsByDeviceType(e.pointerType)).dragToPan&&!r.preventDefaultAction&&this.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan&&(i=this.viewport.deltaPointsFromPixels(e.delta.negate()),this.viewport.centerSpringX.target.value+=i.x,this.viewport.centerSpringY.target.value+=i.y,n=this.viewport.getBounds(),r=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=i.x,this.viewport.centerSpringY.target.value-=i.y,n.x!==r.x&&(e.delta.x=0),n.y!==r.y)&&(e.delta.y=0),this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled&&!this.constrainDuringPan))}function S(e){var t,i,n={tracker:e.eventSource,pointerType:e.pointerType,position:e.position,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-drag-end",n),!n.preventDefaultAction&&this.viewport&&((t=this.gestureSettingsByDeviceType(e.pointerType)).flickEnabled&&e.speed>=t.flickMinSpeed&&(i=0,this.panHorizontal&&(i=t.flickMomentum*e.speed*Math.cos(e.direction)),n=0,this.panVertical&&(n=t.flickMomentum*e.speed*Math.sin(e.direction)),e=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),n=this.viewport.pointFromPixel(new m.Point(e.x-i,e.y-n)),this.viewport.panTo(n,!1)),this.viewport.applyConstraints())}function E(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function b(e){this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function _(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function P(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function C(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function R(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function k(e){var t,i,n,r={tracker:e.eventSource,pointerType:e.pointerType,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};this.raiseEvent("canvas-pinch",r),this.viewport&&(!(t=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom||r.preventDefaultPanAction&&r.preventDefaultZoomAction||(i=this.viewport.pointFromPixel(e.center,!0),t.zoomToRefPoint&&!r.preventDefaultPanAction&&(n=this.viewport.pointFromPixel(e.lastCenter,!0).minus(i),this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewport.panBy(n,!0)),r.preventDefaultZoomAction||this.viewport.zoomBy(e.distance/e.lastDistance,i,!0),this.viewport.applyConstraints()),t.pinchRotate)&&!r.preventDefaultRotateAction&&(r=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),e=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x),this.viewport.setRotation(this.viewport.getRotation()+(r-e)*(180/Math.PI)))}function D(e){var t,i,n;(n=m.now())-this._lastScrollTime>this.minScrollDeltaTime?(this._lastScrollTime=n,t={tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",t),!t.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x),(i=this.gestureSettingsByDeviceType(e.pointerType)).scrollToZoom)&&(n=Math.pow(this.zoomPerScroll,e.scroll),this.viewport.zoomBy(n,i.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints()),e.preventDefault=t.preventDefault):e.preventDefault=!0}function O(e){c[this.hash].mouseInside=!0,d(this),this.raiseEvent("container-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function I(e){e.pointers<1&&(c[this.hash].mouseInside=!1,c[this.hash].animating||u(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function L(e){var t,i,n,r,o,s;!(t=e)._opening&&c[t.hash]&&(t.autoResize&&(i=a(t.container),s=c[t.hash].prevContainerSize,i.equals(s)||(n=t.viewport,t.preserveImageSizeOnResize?(r=s.x/i.x,s=n.getZoom()*r,r=n.getCenter(),n.resize(i,!1),n.zoomTo(s,null,!0),n.panTo(r,!0)):(o=n.getBounds(),n.resize(i,!0),n.fitBoundsWithConstraints(o,!0)),c[t.hash].prevContainerSize=i,c[t.hash].forceRedraw=!0)),o=t.viewport.update(),i=t.world.update()||o,o&&t.raiseEvent("viewport-change"),t.referenceStrip&&(i=t.referenceStrip.update(t.viewport)||i),!(o=c[t.hash].animating)&&i&&(t.raiseEvent("animation-start"),d(t)),(o=o&&!i)&&(c[t.hash].animating=!1),(i||o||c[t.hash].forceRedraw||t.world.needsDraw())&&((s=t).imageLoader.clear(),s.drawer.clear(),s.world.draw(),s.raiseEvent("update-viewport",{}),t._drawOverlays(),t.navigator&&t.navigator.update(t.viewport),c[t.hash].forceRedraw=!1,i)&&t.raiseEvent("animation"),o&&(t.raiseEvent("animation-finish"),c[t.hash].mouseInside||u(t)),c[t.hash].animating=i),e.isOpen()?e._updateRequestId=l(e,L):e._updateRequestId=!1}function z(e,t){return e?e+t:t}function B(){c[this.hash].lastZoomTime=m.now(),c[this.hash].zoomFactor=this.zoomPerSecond,c[this.hash].zooming=!0,i(this)}function F(){c[this.hash].lastZoomTime=m.now(),c[this.hash].zoomFactor=1/this.zoomPerSecond,c[this.hash].zooming=!0,i(this)}function H(){c[this.hash].zooming=!1}function i(e){m.requestAnimationFrame(m.delegate(e,t))}function t(){var e,t;c[this.hash].zooming&&this.viewport&&(t=(e=m.now())-c[this.hash].lastZoomTime,t=Math.pow(c[this.hash].zoomFactor,t/1e3),this.viewport.zoomBy(t),this.viewport.applyConstraints(),c[this.hash].lastZoomTime=e,i(this))}function A(){this.viewport&&(c[this.hash].zooming=!1,this.viewport.zoomBy(+this.zoomPerClick),this.viewport.applyConstraints())}function N(){this.viewport&&(c[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function M(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function j(){this.viewport&&this.viewport.goHome()}function W(){this.isFullPage()&&!m.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function U(){var e;this.viewport&&(e=this.viewport.getRotation(),e=this.viewport.flipped?m.positiveModulo(e+this.rotationIncrement,360):m.positiveModulo(e-this.rotationIncrement,360),this.viewport.setRotation(e))}function V(){var e;this.viewport&&(e=this.viewport.getRotation(),e=this.viewport.flipped?m.positiveModulo(e-this.rotationIncrement,360):m.positiveModulo(e+this.rotationIncrement,360),this.viewport.setRotation(e))}function G(){this.viewport.toggleFlip()}m.Viewer=function(e){var t,i=arguments,n=this;if((e=m.isPlainObject(e)?e:{id:i[0],xmlPath:1<i.length?i[1]:void 0,prefixUrl:2<i.length?i[2]:void 0,controls:3<i.length?i[3]:void 0,overlays:4<i.length?i[4]:void 0}).config&&(m.extend(!0,e,e.config),delete e.config),m.extend(!0,this,{id:e.id,hash:e.hash||r++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},m.DEFAULT_SETTINGS,e),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==c[this.hash]&&m.console.warn("Hash "+this.hash+" has already been used."),c[this.hash]={fsBoundsDelta:new m.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=m.now(),m.EventSource.call(this),this.addHandler("open-failed",function(e){e=m.getString("Errors.OpenFailed",e.eventSource,e.message),n._showMessage(e)}),m.ControlDock.call(this,e),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=m.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(i=this.canvas.style).width="100%",i.height="100%",i.overflow="hidden",i.position="absolute",i.top="0px",i.left="0px",m.setElementTouchActionNone(this.canvas),""!==e.tabIndex&&(this.canvas.tabIndex=void 0===e.tabIndex?0:e.tabIndex),this.container.className="openseadragon-container",(i=this.container.style).width="100%",i.height="100%",i.position="relative",i.overflow="hidden",i.left="0px",i.top="0px",i.textAlign="left",m.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new m.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:m.delegate(this,p),keyDownHandler:m.delegate(this,g),keyHandler:m.delegate(this,y),clickHandler:m.delegate(this,w),dblClickHandler:m.delegate(this,x),dragHandler:m.delegate(this,T),dragEndHandler:m.delegate(this,S),enterHandler:m.delegate(this,E),leaveHandler:m.delegate(this,b),pressHandler:m.delegate(this,_),releaseHandler:m.delegate(this,P),nonPrimaryPressHandler:m.delegate(this,C),nonPrimaryReleaseHandler:m.delegate(this,R),scrollHandler:m.delegate(this,D),pinchHandler:m.delegate(this,k)}),this.outerTracker=new m.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:m.delegate(this,O),leaveHandler:m.delegate(this,I)}),this.toolbar&&(this.toolbar=new m.ControlDock({element:this.toolbar})),this.bindStandardControls(),c[this.hash].prevContainerSize=a(this.container),this.world=new m.World({viewer:this}),this.world.addHandler("add-item",function(e){n.source=n.world.getItemAt(0).source,c[n.hash].forceRedraw=!0,n._updateRequestId||(n._updateRequestId=l(n,L))}),this.world.addHandler("remove-item",function(e){n.world.getItemCount()?n.source=n.world.getItemAt(0).source:n.source=null,c[n.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(e){n.viewport&&n.viewport._setContentBounds(n.world.getHomeBounds(),n.world.getContentFactor())}),this.world.addHandler("item-index-change",function(e){n.source=n.world.getItemAt(0).source}),this.viewport=new m.Viewport({containerSize:c[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new m.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:e.timeout}),this.tileCache=new m.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new m.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=m.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(t=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(t,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(t=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(t,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new m.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),t=0;t<this.customControls.length;t++)this.addControl(this.customControls[t].id,{anchor:this.customControls[t].anchor});m.requestAnimationFrame(function(){u(n)}),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),m._viewers.set(this.element,this)},m.extend(m.Viewer.prototype,m.EventSource.prototype,m.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(e){return m.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(e)},openTileSource:function(e){return m.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(e)},get buttons(){return m.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(i,e){var r=this;if(this.close(),i)if(this.sequenceMode&&m.isArray(i))this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===e||isNaN(e)||(this.initialPage=e),this.tileSources=i,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip)&&this.addReferenceStrip(),this._updateSequenceButtons(this._sequenceIndex);else if((i=m.isArray(i)?i:[i]).length){this._opening=!0;function o(){if(a+l===n)if(a){!r._firstOpen&&r.preserveViewport||(r.viewport.goHome(!0),r.viewport.update()),r._firstOpen=!1;var e=i[0];if(e.tileSource&&(e=e.tileSource),r.overlays&&!r.preserveOverlays)for(var t=0;t<r.overlays.length;t++)r.currentOverlays[t]=h(r,r.overlays[t]);r._drawOverlays(),r._opening=!1,r.raiseEvent("open",{source:e})}else r._opening=!1,r.raiseEvent("open-failed",s)}for(var s,n=i.length,a=0,l=0,t=0;t<i.length;t++)!function(i){void 0!==(i=m.isPlainObject(i)&&i.tileSource?i:{tileSource:i}).index&&(m.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete i.index),void 0===i.collectionImmediately&&(i.collectionImmediately=!0);var n=i.success,t=(i.success=function(e){if(a++,i.tileSource.overlays)for(var t=0;t<i.tileSource.overlays.length;t++)r.addOverlay(i.tileSource.overlays[t]);n&&n(e),o()},i.error);i.error=function(e){l++,s=s||e,t&&t(e),o()},r.addTiledImage(i)}(i[t])}return this},close:function(){return c[this.hash]&&(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),c[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close")),this},destroy:function(){if(c[this.hash]){if(this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(m.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),c[this.navigator.hash]=null,delete c[this.navigator.hash],this.navigator=null),this.removeAllHandlers(),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),c[this.hash]=null,delete c[this.hash],this.canvas=null,this.container=null,m._viewers.delete(this.element),this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){for(var e=this.controls.length,t=0;t<this.controls.length;t++)e=e&&this.controls[t].isVisible();return e},setControlsEnabled:function(e){return(e?d:u)(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return c[this.hash].fullPage},setFullPage:function(e){var t,i,n=document.body,r=n.style,o=document.documentElement.style,s=this;if(e!==this.isFullPage()){var a={fullPage:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",a),!a.preventDefaultAction){if(e){for(this.elementSize=m.getElementSize(this.element),this.pageScroll=m.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=r.margin,this.docMargin=o.margin,r.margin="0",o.margin="0",this.bodyPadding=r.padding,this.docPadding=o.padding,r.padding="0",o.padding="0",this.bodyWidth=r.width,this.docWidth=o.width,r.width="100%",o.width="100%",this.bodyHeight=r.height,this.docHeight=o.height,r.height="100%",o.height="100%",this.bodyDisplay=r.display,r.display="block",this.previousBody=[],c[this.hash].prevElementParent=this.element.parentNode,c[this.hash].prevNextSibling=this.element.nextSibling,c[this.hash].prevElementWidth=this.element.style.width,c[this.hash].prevElementHeight=this.element.style.height,t=n.childNodes.length,i=0;i<t;i++)this.previousBody.push(n.childNodes[0]),n.removeChild(n.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,n.appendChild(this.toolbar.element),m.addClass(this.toolbar.element,"fullpage")),m.addClass(this.element,"fullpage"),n.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=m.getElementSize(this.element).y-m.getElementSize(this.toolbar.element).y+"px"),c[this.hash].fullPage=!0,m.delegate(this,O)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,r.margin=this.bodyMargin,o.margin=this.docMargin,r.padding=this.bodyPadding,o.padding=this.docPadding,r.width=this.bodyWidth,o.width=this.docWidth,r.height=this.bodyHeight,o.height=this.docHeight,r.display=this.bodyDisplay,n.removeChild(this.element),t=this.previousBody.length,i=0;i<t;i++)n.appendChild(this.previousBody.shift());m.removeClass(this.element,"fullpage"),c[this.hash].prevElementParent.insertBefore(this.element,c[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(n.removeChild(this.toolbar.element),m.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=c[this.hash].prevElementWidth,this.element.style.height=c[this.hash].prevElementHeight;var l=0,h=function(){m.setPageScroll(s.pageScroll);var e=m.getPageScroll();++l<10&&(e.x!==s.pageScroll.x||e.y!==s.pageScroll.y)&&m.requestAnimationFrame(h)};m.requestAnimationFrame(h),c[this.hash].fullPage=!1,m.delegate(this,I)({})}this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:e})}}return this},setFullScreen:function(e){var t=this;if(!m.supportsFullScreen)return this.setFullPage(e);if(m.isFullScreen()!==e){var i={fullScreen:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",i),!i.preventDefaultAction)if(e){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var n=function(){var e=m.isFullScreen();e||(m.removeEvent(document,m.fullScreenEventName,n),m.removeEvent(document,m.fullScreenErrorEventName,n),t.setFullPage(!1),t.isFullPage()&&(t.element.style.width=t.fullPageStyleWidth,t.element.style.height=t.fullPageStyleHeight)),t.navigator&&t.viewport&&setTimeout(function(){t.navigator.update(t.viewport)}),t.raiseEvent("full-screen",{fullScreen:e})};m.addEvent(document,m.fullScreenEventName,n),m.addEvent(document,m.fullScreenErrorEventName,n),m.requestFullScreen(document.body)}else m.exitFullScreen()}return this},isVisible:function(){return"hidden"!==this.container.style.visibility},isFullScreen:function(){return m.isFullScreen()&&this.isFullPage()},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(i){m.console.assert(i,"[Viewer.addTiledImage] options is required"),m.console.assert(i.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),m.console.assert(!i.replace||-1<i.index&&i.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var n=this,r=(i.replace&&(i.replaceItem=n.world.getItemAt(i.index)),this._hideMessage(),void 0===i.placeholderFillStyle&&(i.placeholderFillStyle=this.placeholderFillStyle),void 0===i.opacity&&(i.opacity=this.opacity),void 0===i.preload&&(i.preload=this.preload),void 0===i.compositeOperation&&(i.compositeOperation=this.compositeOperation),void 0===i.crossOriginPolicy&&(i.crossOriginPolicy=(void 0!==i.tileSource.crossOriginPolicy?i.tileSource:this).crossOriginPolicy),void 0===i.ajaxWithCredentials&&(i.ajaxWithCredentials=this.ajaxWithCredentials),void 0===i.loadTilesWithAjax&&(i.loadTilesWithAjax=this.loadTilesWithAjax),void 0===i.ajaxHeaders||null===i.ajaxHeaders?i.ajaxHeaders=this.ajaxHeaders:m.isPlainObject(i.ajaxHeaders)&&m.isPlainObject(this.ajaxHeaders)&&(i.ajaxHeaders=m.extend({},this.ajaxHeaders,i.ajaxHeaders)),{options:i});function t(e){for(var t=0;t<n._loadQueue.length;t++)if(n._loadQueue[t]===r){n._loadQueue.splice(t,1);break}0===n._loadQueue.length&&o(r),n.raiseEvent("add-item-failed",e),i.error&&i.error(e)}function o(e){n.collectionMode&&(n.world.arrange({immediately:e.options.collectionImmediately,rows:n.collectionRows,columns:n.collectionColumns,layout:n.collectionLayout,tileSize:n.collectionTileSize,tileMargin:n.collectionTileMargin}),n.world.setAutoRefigureSizes(!0))}if(m.isArray(i.tileSource))setTimeout(function(){t({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:i.tileSource,options:i})});else{this._loadQueue.push(r);function s(e){r.tileSource=e,p()}function a(e){e.options=i,t(e),p()}var l=this,h=i.tileSource,c=i,u=l;if("string"===m.type(h))if(h.match(/^\s*<.*>\s*$/))h=m.parseXml(h);else if(h.match(/^\s*[{[].*[}\]]\s*$/))try{var e=m.parseJSON(h);h=e}catch(e){}function d(e,t){e.ready?s(e):(e.addHandler("ready",function(){s(e)}),e.addHandler("open-failed",function(e){a({message:e.message,source:t})}))}setTimeout(function(){var e,t;"string"===m.type(h)?(h=new m.TileSource({url:h,crossOriginPolicy:(void 0!==c.crossOriginPolicy?c:l).crossOriginPolicy,ajaxWithCredentials:l.ajaxWithCredentials,ajaxHeaders:c.ajaxHeaders||l.ajaxHeaders,splitHashDataForPost:l.splitHashDataForPost,useCanvas:l.useCanvas,success:function(e){s(e.tileSource)}})).addHandler("open-failed",function(e){a(e)}):m.isPlainObject(h)||h.nodeType?(void 0!==h.crossOriginPolicy||void 0===c.crossOriginPolicy&&void 0===l.crossOriginPolicy||(h.crossOriginPolicy=(void 0!==c.crossOriginPolicy?c:l).crossOriginPolicy),void 0===h.ajaxWithCredentials&&(h.ajaxWithCredentials=l.ajaxWithCredentials),void 0===h.useCanvas&&(h.useCanvas=l.useCanvas),m.isFunction(h.getTileUrl)?((e=new m.TileSource(h)).getTileUrl=h.getTileUrl,s(e)):(t=m.TileSource.determineType(u,h))?(e=t.prototype.configure.apply(u,[h]),d(new t(e),h)):a({message:"Unable to load TileSource",source:h})):d(h,h)})}function p(){for(var e,t,i;n._loadQueue.length&&(e=n._loadQueue[0]).tileSource;)n._loadQueue.splice(0,1),e.options.replace&&(-1!==(i=n.world.getIndexOfItem(e.options.replaceItem))&&(e.options.index=i),n.world.removeItem(e.options.replaceItem)),t=new m.TiledImage({viewer:n,source:e.tileSource,viewport:n.viewport,drawer:n.drawer,tileCache:n.tileCache,imageLoader:n.imageLoader,x:e.options.x,y:e.options.y,width:e.options.width,height:e.options.height,fitBounds:e.options.fitBounds,fitBoundsPlacement:e.options.fitBoundsPlacement,clip:e.options.clip,placeholderFillStyle:e.options.placeholderFillStyle,opacity:e.options.opacity,preload:e.options.preload,degrees:e.options.degrees,flipped:e.options.flipped,compositeOperation:e.options.compositeOperation,springStiffness:n.springStiffness,animationTime:n.animationTime,minZoomImageRatio:n.minZoomImageRatio,wrapHorizontal:n.wrapHorizontal,wrapVertical:n.wrapVertical,immediateRender:n.immediateRender,blendTime:n.blendTime,alwaysBlend:n.alwaysBlend,minPixelRatio:n.minPixelRatio,smoothTileEdgesMinZoom:n.smoothTileEdgesMinZoom,iOSDevice:n.iOSDevice,crossOriginPolicy:e.options.crossOriginPolicy,ajaxWithCredentials:e.options.ajaxWithCredentials,loadTilesWithAjax:e.options.loadTilesWithAjax,ajaxHeaders:e.options.ajaxHeaders,debugMode:n.debugMode,subPixelRoundingForTransparency:n.subPixelRoundingForTransparency}),n.collectionMode&&n.world.setAutoRefigureSizes(!1),n.navigator&&(i=m.extend({},e.options,{replace:!1,originalTiledImage:t,tileSource:e.tileSource}),n.navigator.addTiledImage(i)),n.world.addItem(t,{index:e.options.index}),0===n._loadQueue.length&&o(e),1!==n.world.getItemCount()||n.preserveViewport||n.viewport.goHome(!0),e.options.success&&e.options.success({item:t})}},addSimpleImage:function(e){m.console.assert(e,"[Viewer.addSimpleImage] options is required"),m.console.assert(e.url,"[Viewer.addSimpleImage] options.url is required"),delete(e=m.extend({},e,{tileSource:{type:"image",url:e.url}})).url,this.addTiledImage(e)},addLayer:function(t){var i=this,e=(m.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead."),m.extend({},t,{success:function(e){i.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){i.raiseEvent("add-layer-failed",e)}}));return this.addTiledImage(e),this},getLayerAtLevel:function(e){return m.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(e)},getLevelOfLayer:function(e){return m.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(e)},getLayersCount:function(){return m.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(e,t){return m.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(e,t)},removeLayer:function(e){return m.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(e)},forceRedraw:function(){return c[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var e=m.delegate(this,f),t=m.delegate(this,v),i=m.delegate(this,this.goToNextPage),n=m.delegate(this,this.goToPreviousPage),r=this.navImages,o=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(o=!1),this.previousButton=new m.Button({element:this.previousButton?m.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:m.getString("Tooltips.PreviousPage"),srcRest:z(this.prefixUrl,r.previous.REST),srcGroup:z(this.prefixUrl,r.previous.GROUP),srcHover:z(this.prefixUrl,r.previous.HOVER),srcDown:z(this.prefixUrl,r.previous.DOWN),onRelease:n,onFocus:e,onBlur:t}),this.nextButton=new m.Button({element:this.nextButton?m.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:m.getString("Tooltips.NextPage"),srcRest:z(this.prefixUrl,r.next.REST),srcGroup:z(this.prefixUrl,r.next.GROUP),srcHover:z(this.prefixUrl,r.next.HOVER),srcDown:z(this.prefixUrl,r.next.DOWN),onRelease:i,onFocus:e,onBlur:t}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),o)&&(this.paging=new m.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:m.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||m.ControlAnchor.TOP_LEFT})),this},bindStandardControls:function(){var e=m.delegate(this,B),t=m.delegate(this,H),i=m.delegate(this,A),n=m.delegate(this,F),r=m.delegate(this,N),o=m.delegate(this,j),s=m.delegate(this,W),a=m.delegate(this,U),l=m.delegate(this,V),h=m.delegate(this,G),c=m.delegate(this,f),u=m.delegate(this,v),d=this.navImages,p=[],g=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(g=!1),this.showZoomControl&&(p.push(this.zoomInButton=new m.Button({element:this.zoomInButton?m.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:m.getString("Tooltips.ZoomIn"),srcRest:z(this.prefixUrl,d.zoomIn.REST),srcGroup:z(this.prefixUrl,d.zoomIn.GROUP),srcHover:z(this.prefixUrl,d.zoomIn.HOVER),srcDown:z(this.prefixUrl,d.zoomIn.DOWN),onPress:e,onRelease:t,onClick:i,onEnter:e,onExit:t,onFocus:c,onBlur:u})),p.push(this.zoomOutButton=new m.Button({element:this.zoomOutButton?m.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:m.getString("Tooltips.ZoomOut"),srcRest:z(this.prefixUrl,d.zoomOut.REST),srcGroup:z(this.prefixUrl,d.zoomOut.GROUP),srcHover:z(this.prefixUrl,d.zoomOut.HOVER),srcDown:z(this.prefixUrl,d.zoomOut.DOWN),onPress:n,onRelease:t,onClick:r,onEnter:n,onExit:t,onFocus:c,onBlur:u}))),this.showHomeControl&&p.push(this.homeButton=new m.Button({element:this.homeButton?m.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:m.getString("Tooltips.Home"),srcRest:z(this.prefixUrl,d.home.REST),srcGroup:z(this.prefixUrl,d.home.GROUP),srcHover:z(this.prefixUrl,d.home.HOVER),srcDown:z(this.prefixUrl,d.home.DOWN),onRelease:o,onFocus:c,onBlur:u})),this.showFullPageControl&&p.push(this.fullPageButton=new m.Button({element:this.fullPageButton?m.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:m.getString("Tooltips.FullPage"),srcRest:z(this.prefixUrl,d.fullpage.REST),srcGroup:z(this.prefixUrl,d.fullpage.GROUP),srcHover:z(this.prefixUrl,d.fullpage.HOVER),srcDown:z(this.prefixUrl,d.fullpage.DOWN),onRelease:s,onFocus:c,onBlur:u})),this.showRotationControl&&(p.push(this.rotateLeftButton=new m.Button({element:this.rotateLeftButton?m.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:m.getString("Tooltips.RotateLeft"),srcRest:z(this.prefixUrl,d.rotateleft.REST),srcGroup:z(this.prefixUrl,d.rotateleft.GROUP),srcHover:z(this.prefixUrl,d.rotateleft.HOVER),srcDown:z(this.prefixUrl,d.rotateleft.DOWN),onRelease:a,onFocus:c,onBlur:u})),p.push(this.rotateRightButton=new m.Button({element:this.rotateRightButton?m.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:m.getString("Tooltips.RotateRight"),srcRest:z(this.prefixUrl,d.rotateright.REST),srcGroup:z(this.prefixUrl,d.rotateright.GROUP),srcHover:z(this.prefixUrl,d.rotateright.HOVER),srcDown:z(this.prefixUrl,d.rotateright.DOWN),onRelease:l,onFocus:c,onBlur:u}))),this.showFlipControl&&p.push(this.flipButton=new m.Button({element:this.flipButton?m.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:m.getString("Tooltips.Flip"),srcRest:z(this.prefixUrl,d.flip.REST),srcGroup:z(this.prefixUrl,d.flip.GROUP),srcHover:z(this.prefixUrl,d.flip.HOVER),srcDown:z(this.prefixUrl,d.flip.DOWN),onRelease:h,onFocus:c,onBlur:u})),g?(this.buttonGroup=new m.ButtonGroup({buttons:p,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",m.delegate(this,M)),(this.toolbar||this).addControl(this.navControl,{anchor:this.navigationControlAnchor||m.ControlAnchor.TOP_LEFT})):this.customButtons=p),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&0<=e&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(e,t,i,n){return i=m.isPlainObject(e)?e:{element:e,location:t,placement:i,onDraw:n},e=m.getElement(i.element),0<=o(this.currentOverlays,e)||(n=h(this,i),this.currentOverlays.push(n),n.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:e,location:i.location,placement:i.placement})),this},updateOverlay:function(e,t,i){var n;return e=m.getElement(e),0<=(n=o(this.currentOverlays,e))&&(this.currentOverlays[n].update(t,i),c[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:e,location:t,placement:i})),this},removeOverlay:function(e){var t;return e=m.getElement(e),0<=(t=o(this.currentOverlays,e))&&(this.currentOverlays[t].destroy(),this.currentOverlays.splice(t,1),c[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:e})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return c[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(e){return e=m.getElement(e),0<=(e=o(this.currentOverlays,e))?this.currentOverlays[e]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<e?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(e){this._hideMessage();var t=m.makeNeutralElement("div");t.appendChild(document.createTextNode(e)),this.messageDiv=m.makeCenteredNode(t),m.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){for(var e=this.currentOverlays.length,t=0;t<e;t++)this.currentOverlays[t].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){this.showReferenceStrip=!0,this.sequenceMode?!this.referenceStrip&&this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new m.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex)):m.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),m.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){m.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var e=m.pixelDensityRatio,t=m.getCurrentPixelDensityRatio();e!==t&&(m.pixelDensityRatio=t,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)},goToNextPage:function(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)},isAnimating:function(){return c[this.hash].animating}})}(OpenSeadragon),function(a){function l(e){var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-click",t),!t.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x),e=this.viewport.pointFromPixel(e.position),this.panVertical?this.panHorizontal||(e.x=this.viewer.viewport.getCenter(!0).x):e.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(e),this.viewer.viewport.applyConstraints())}function h(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan)&&this.viewer.viewport.applyConstraints()}function c(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function u(e){var t={tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent,preventDefault:e.preventDefault};this.viewer.raiseEvent("navigator-scroll",t),e.preventDefault=t.preventDefault}function d(e,t){i(e,"rotate("+t+"deg)")}function i(e,t){e.style.webkitTransform=t,e.style.mozTransform=t,e.style.msTransform=t,e.style.oTransform=t,e.style.transform=t}a.Navigator=function(e){var t,i,n,r=e.viewer,o=this;function s(e){d(o.displayRegionContainer,e),d(o.displayRegion,-e),o.viewport.setRotation(e)}e.id?(this.element=document.getElementById(e.id),e.controlOptions={anchor:a.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(e.id="navigator-"+a.now(),this.element=a.makeNeutralElement("div"),e.controlOptions={anchor:a.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:e.autoFade},e.position&&("BOTTOM_RIGHT"===e.position?e.controlOptions.anchor=a.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===e.position?e.controlOptions.anchor=a.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===e.position?e.controlOptions.anchor=a.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===e.position?e.controlOptions.anchor=a.ControlAnchor.TOP_LEFT:"ABSOLUTE"===e.position&&(e.controlOptions.anchor=a.ControlAnchor.ABSOLUTE,e.controlOptions.top=e.top,e.controlOptions.left=e.left,e.controlOptions.height=e.height,e.controlOptions.width=e.width))),this.element.id=e.id,this.element.className+=" navigator",(e=a.extend(!0,{sizeRatio:a.DEFAULT_SETTINGS.navigatorSizeRatio},e,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:e.autoResize,minZoomImageRatio:1,background:e.background,opacity:e.opacity,borderColor:e.borderColor,displayRegionColor:e.displayRegionColor})).minPixelRatio=this.minPixelRatio=r.minPixelRatio,a.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new a.Point(1,1),this.totalBorderWidths=new a.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),e.controlOptions.anchor!==a.ControlAnchor.NONE&&(n=this.element.style,i=this.borderWidth,n.margin="0px",n.border=i+"px solid "+e.borderColor,n.padding="0px",n.background=e.background,n.opacity=e.opacity,n.overflow="hidden"),this.displayRegion=a.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",i=this.displayRegion.style,n=this.borderWidth,i.position="relative",i.top="0px",i.left="0px",i.fontSize="0px",i.overflow="hidden",i.border=n+"px solid "+e.displayRegionColor,i.margin="0px",i.padding="0px",i.background="transparent",i.float="left",i.cssFloat="left",i.styleFloat="left",i.zIndex=999999999,i.cursor="default",a.setElementPointerEventsNone(this.displayRegion),a.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=a.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",a.setElementPointerEventsNone(this.displayRegionContainer),a.setElementTouchActionNone(this.displayRegionContainer),r.addControl(this.element,e.controlOptions),this._resizeWithViewer=e.controlOptions.anchor!==a.ControlAnchor.ABSOLUTE&&e.controlOptions.anchor!==a.ControlAnchor.NONE,e.width&&e.height?(this.setWidth(e.width),this.setHeight(e.height)):this._resizeWithViewer&&(t=a.getElementSize(r.element),this.element.style.height=Math.round(t.y*e.sizeRatio)+"px",this.element.style.width=Math.round(t.x*e.sizeRatio)+"px",this.oldViewerSize=t,t=a.getElementSize(this.element),this.elementArea=t.x*t.y),this.oldContainerSize=new a.Point(0,0),a.Viewer.apply(this,[e]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),e.navigatorRotate&&(s(e.viewer.viewport?e.viewer.viewport.getRotation():e.viewer.degrees||0),e.viewer.addHandler("rotate",function(e){s(e.degrees)})),this.innerTracker.destroy(),this.innerTracker=new a.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:a.delegate(this,h),clickHandler:a.delegate(this,l),releaseHandler:a.delegate(this,c),scrollHandler:a.delegate(this,u),preProcessEventHandler:function(e){"wheel"===e.eventType&&(e.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",a.setElementPointerEventsNone(this.canvas),a.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){o.viewport&&o.viewport.goHome(!0)}),r.world.addHandler("item-index-change",function(t){window.setTimeout(function(){var e=o.world.getItemAt(t.previousIndex);o.world.setItemIndex(e,t.newIndex)},1)}),r.world.addHandler("remove-item",function(e){e=e.item,(e=o._getMatchingItem(e))&&o.world.removeItem(e)}),this.update(r.viewport)},a.extend(a.Navigator.prototype,a.EventSource.prototype,a.Viewer.prototype,{updateSize:function(){var e;this.viewport&&!(e=new a.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight)).equals(this.oldContainerSize)&&(this.viewport.resize(e,!0),this.viewport.goHome(!0),this.oldContainerSize=e,this.drawer.clear(),this.world.draw())},setWidth:function(e){this.width=e,this.element.style.width="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setHeight:function(e){this.height=e,this.element.style.height="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){i(this.displayRegion,e),i(this.canvas,e),i(this.element,e)},update:function(e){var t,i,n=a.getElementSize(this.viewer.element);this._resizeWithViewer&&n.x&&n.y&&!n.equals(this.oldViewerSize)&&(this.oldViewerSize=n,i=this.maintainSizeRatio||!this.elementArea?(t=n.x*this.sizeRatio,n.y*this.sizeRatio):(t=Math.sqrt(this.elementArea*(n.x/n.y)),this.elementArea/t),this.element.style.width=Math.round(t)+"px",this.element.style.height=Math.round(i)+"px",this.elementArea||(this.elementArea=t*i),this.updateSize()),e&&this.viewport&&(n=e.getBoundsNoRotate(!0),t=this.viewport.pixelFromPointNoRotate(n.getTopLeft(),!1),i=this.viewport.pixelFromPointNoRotate(n.getBottomRight(),!1).minus(this.totalBorderWidths),(e=this.displayRegion.style).display=this.world.getItemCount()?"block":"none",e.top=Math.round(t.y)+"px",e.left=Math.round(t.x)+"px",n=Math.abs(t.x-i.x),i=Math.abs(t.y-i.y),e.width=Math.round(Math.max(n,0))+"px",e.height=Math.round(Math.max(i,0))+"px")},addTiledImage:function(e){var n=this,r=e.originalTiledImage;return delete e.original,e=a.extend({},e,{success:function(e){var t=e.item;function i(){n._matchBounds(t,r)}t._originalForNavigator=r,n._matchBounds(t,r,!0),n._matchOpacity(t,r),n._matchCompositeOperation(t,r),r.addHandler("bounds-change",i),r.addHandler("clip-change",i),r.addHandler("opacity-change",function(){n._matchOpacity(t,r)}),r.addHandler("composite-operation-change",function(){n._matchCompositeOperation(t,r)})}}),a.Viewer.prototype.addTiledImage.apply(this,[e])},destroy:function(){return a.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),n=0;n<i;n++)if((t=this.world.getItemAt(n))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var n=t.getBoundsNoRotate();e.setPosition(n.getTopLeft(),i),e.setWidth(n.width,i),e.setRotation(t.getRotation(),i),e.setClip(t.getClip()),e.setFlip(t.getFlip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}})}(OpenSeadragon),function(s){var a={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};s.extend(s,{getString:function(e){for(var t=e.split("."),i=null,n=arguments,r=a,o=0;o<t.length-1;o++)r=r[t[o]]||{};return"string"!=typeof(i=r[t[o]])&&(s.console.error("Untranslated source string:",e),i=""),i.replace(/\{\d+\}/g,function(e){return(e=parseInt(e.match(/\d+/),10)+1)<n.length?n[e]:""})},setString:function(e,t){for(var i=e.split("."),n=a,r=0;r<i.length-1;r++)n[i[r]]||(n[i[r]]={}),n=n[i[r]];n[i[r]]=t}})}(OpenSeadragon),function(o){o.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},o.Point.prototype={clone:function(){return new o.Point(this.x,this.y)},plus:function(e){return new o.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new o.Point(this.x-e.x,this.y-e.y)},times:function(e){return new o.Point(this.x*e,this.y*e)},divide:function(e){return new o.Point(this.x/e,this.y/e)},negate:function(){return new o.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(e){return new o.Point(e(this.x),e(this.y))},equals:function(e){return e instanceof o.Point&&this.x===e.x&&this.y===e.y},rotate:function(e,t){if(t=t||new o.Point(0,0),e%90==0)switch(o.positiveModulo(e,360)){case 0:n=1,r=0;break;case 90:n=0,r=1;break;case 180:n=-1,r=0;break;case 270:n=0,r=-1}else var i=e*Math.PI/180,n=Math.cos(i),r=Math.sin(i);return i=n*(this.x-t.x)-r*(this.y-t.y)+t.x,t=r*(this.x-t.x)+n*(this.y-t.y)+t.y,new o.Point(i,t)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(h){h.TileSource=function(e,t,i,n,r,o){var s,a=this,l=arguments,l=h.isPlainObject(e)?e:{width:l[0],height:l[1],tileSize:l[2],tileOverlap:l[3],minLevel:l[4],maxLevel:l[5]};if(h.EventSource.call(this),h.extend(!0,this,l),!this.success)for(s=0;s<arguments.length;s++)if(h.isFunction(arguments[s])){this.success=arguments[s];break}this.success&&this.addHandler("ready",function(e){a.success(e)}),"string"===h.type(e)&&(this.url=e),this.url?(this.aspectRatio=1,this.dimensions=new h.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=l.width&&l.height?l.width/l.height:1,this.dimensions=new h.Point(l.width,l.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=l.tileOverlap||0,this.minLevel=l.minLevel||0,this.maxLevel=void 0!==l.maxLevel&&null!==l.maxLevel?l.maxLevel:l.width&&l.height?Math.ceil(Math.log(Math.max(l.width,l.height))/Math.log(2)):0,this.success&&h.isFunction(this.success)&&this.success(this))},h.TileSource.prototype={getTileSize:function(e){return h.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth||this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight||this.getTileSize(e)},setMaxLevel:function(e){this.maxLevel=e,this._memoizeLevelScale()},getLevelScale:function(e){return this._memoizeLevelScale(),this.getLevelScale(e)},_memoizeLevelScale:function(){for(var t={},e=0;e<=this.maxLevel;e++)t[e]=1/Math.pow(2,this.maxLevel-e);this.getLevelScale=function(e){return t[e]}},getNumTiles:function(e){var t=this.getLevelScale(e),i=Math.ceil(t*this.dimensions.x/this.getTileWidth(e)),e=Math.ceil(t*this.dimensions.y/this.getTileHeight(e));return new h.Point(i,e)},getPixelRatio:function(e){var e=1/(t=this.dimensions.times(this.getLevelScale(e))).x*h.pixelDensityRatio,t=1/t.y*h.pixelDensityRatio;return new h.Point(e,t)},getClosestLevel:function(){for(var e,t=this.minLevel+1;t<=this.maxLevel&&!(1<(e=this.getNumTiles(t)).x||1<e.y);t++);return t-1},getTileAtPoint:function(e,t){var i=0<=t.x&&t.x<=1&&0<=t.y&&t.y<=1/this.aspectRatio,n=(h.console.assert(i,"[TileSource.getTileAtPoint] must be called with a valid point."),this.dimensions.x*this.getLevelScale(e)),i=t.x*n,n=t.y*n;return i=Math.floor(i/this.getTileWidth(e)),n=Math.floor(n/this.getTileHeight(e)),1<=t.x&&(i=this.getNumTiles(e).x-1),t.y>=1/this.aspectRatio-1e-15&&(n=this.getNumTiles(e).y-1),new h.Point(i,n)},getTileBounds:function(e,t,i,n){var r=this.dimensions.times(this.getLevelScale(e)),o=this.getTileWidth(e),s=this.getTileHeight(e),a=0===t?0:o*t-this.tileOverlap,e=0===i?0:s*i-this.tileOverlap,t=o+(0===t?1:2)*this.tileOverlap,s=s+(0===i?1:2)*this.tileOverlap,i=1/r.x;return t=Math.min(t,r.x-a),s=Math.min(s,r.y-e),n?new h.Rect(0,0,t,s):new h.Rect(a*i,e*i,t*i,s*i)},getImageInfo:function(n){var t,i,e,r,o,s,a=this,l=(n&&-1<(o=(r=(e=n.split("/"))[e.length-1]).lastIndexOf("."))&&(e[e.length-1]=r.slice(0,o)),null);this.splitHashDataForPost&&-1!==(s=n.indexOf("#"))&&(l=n.substring(s+1),n=n.substr(0,s)),t=function(e){"string"==typeof e&&(e=h.parseXml(e));var t=h.TileSource.determineType(a,e,n);t?(void 0===(i=t.prototype.configure.apply(a,[e,n,l])).ajaxWithCredentials&&(i.ajaxWithCredentials=a.ajaxWithCredentials),i=new t(i),a.ready=!0,a.raiseEvent("ready",{tileSource:i})):a.raiseEvent("open-failed",{message:"Unable to load TileSource",source:n})},n.match(/\.js$/)?(s=n.split("/").pop().replace(".js",""),h.jsonp({url:n,async:!1,callbackName:s,callback:t})):h.makeAjaxRequest({url:n,postData:l,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(e){e=function(e){var t,i,n,r=e.responseText;e.status;if(!e)throw new Error(h.getString("Errors.Security"));if(200!==e.status&&0!==e.status)throw t=404===(n=e.status)?"Not Found":e.statusText,new Error(h.getString("Errors.Status",n,t));if(r.match(/\s*<.*/))try{i=e.responseXML&&e.responseXML.documentElement?e.responseXML:h.parseXml(r)}catch(t){i=e.responseText}else if(r.match(/\s*[{[].*/))try{i=h.parseJSON(r)}catch(t){i=r}else i=r;return i}(e),t(e)},error:function(e,t){var i;try{i="HTTP "+e.status+" attempting to load TileSource: "+n}catch(e){i=(void 0!==t&&t.toString?t.toString():"Unknown error")+" attempting to load TileSource: "+n}h.console.error(i),a.raiseEvent("open-failed",{message:i,source:n,postData:l})}})},supports:function(e,t){return!1},configure:function(e,t,i){throw new Error("Method not implemented.")},getTileUrl:function(e,t,i){throw new Error("Method not implemented.")},getTilePostData:function(e,t,i){return null},getTileAjaxHeaders:function(e,t,i){return{}},getTileHashKey:function(e,t,i,n,r,o){return r?n+"+"+JSON.stringify(r):n},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&0<=t&&0<=i&&t<n.x&&i<n.y}},h.extend(!0,h.TileSource.prototype,h.EventSource.prototype),h.TileSource.determineType=function(e,t,i){for(var n in OpenSeadragon)if(n.match(/.+TileSource$/)&&h.isFunction(OpenSeadragon[n])&&h.isFunction(OpenSeadragon[n].prototype.supports)&&OpenSeadragon[n].prototype.supports.call(e,t,i))return OpenSeadragon[n];return h.console.error("No TileSource was able to open %s %s",i,t),null}}(OpenSeadragon),function(d){function u(e,t){for(var i,n=(h=t.Image).Url,r=h.Format,o=h.Size,s=h.DisplayRect||[],a=parseInt(o.Width,10),l=parseInt(o.Height,10),o=parseInt(h.TileSize,10),h=parseInt(h.Overlap,10),c=[],u=0;u<s.length;u++)i=s[u].Rect,c.push(new d.DisplayRect(parseInt(i.X,10),parseInt(i.Y,10),parseInt(i.Width,10),parseInt(i.Height,10),parseInt(i.MinLevel,10),parseInt(i.MaxLevel,10)));return d.extend(!0,{width:a,height:l,tileSize:o,tileOverlap:h,minLevel:null,maxLevel:null,tilesUrl:n,fileFormat:r,displayRects:c},t)}d.DziTileSource=function(e,t,i,n,r,o,s,a,l){var h,c,u,e=d.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:r,fileFormat:o,displayRects:s,minLevel:a,maxLevel:l};if(this._levelRects={},this.tilesUrl=e.tilesUrl,this.fileFormat=e.fileFormat,this.displayRects=e.displayRects,this.displayRects)for(h=this.displayRects.length-1;0<=h;h--)for(u=(c=this.displayRects[h]).minLevel;u<=c.maxLevel;u++)this._levelRects[u]||(this._levelRects[u]=[]),this._levelRects[u].push(c);d.TileSource.apply(this,[e])},d.extend(d.DziTileSource.prototype,d.TileSource.prototype,{supports:function(e,t){var i;return e.Image?i=e.Image.xmlns:!e.documentElement||"Image"!==e.documentElement.localName&&"Image"!==e.documentElement.tagName||(i=e.documentElement.namespaceURI),-1!==(i=(i||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==i.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(e,t,i){return e=(d.isPlainObject(e)?u:function(e,t){if(!t||!t.documentElement)throw new Error(d.getString("Errors.Xml"));var i,n,r,o,s,a=t.documentElement,l=a.localName||a.tagName,h=t.documentElement.namespaceURI,t=null,c=[];if("Image"===l)try{if(void 0===(o=a.getElementsByTagName("Size")[0])&&(o=a.getElementsByTagNameNS(h,"Size")[0]),t={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:a.getAttribute("Url"),Format:a.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(a.getAttribute("Overlap"),10),TileSize:parseInt(a.getAttribute("TileSize"),10),Size:{Height:parseInt(o.getAttribute("Height"),10),Width:parseInt(o.getAttribute("Width"),10)}}},!d.imageFormatSupported(t.Image.Format))throw new Error(d.getString("Errors.ImageFormat",t.Image.Format.toUpperCase()));for(void 0===(i=a.getElementsByTagName("DisplayRect"))&&(i=a.getElementsByTagNameNS(h,"DisplayRect")[0]),s=0;s<i.length;s++)void 0===(r=(n=i[s]).getElementsByTagName("Rect")[0])&&(r=n.getElementsByTagNameNS(h,"Rect")[0]),c.push({Rect:{X:parseInt(r.getAttribute("X"),10),Y:parseInt(r.getAttribute("Y"),10),Width:parseInt(r.getAttribute("Width"),10),Height:parseInt(r.getAttribute("Height"),10),MinLevel:parseInt(n.getAttribute("MinLevel"),10),MaxLevel:parseInt(n.getAttribute("MaxLevel"),10)}});return c.length&&(t.Image.DisplayRect=c),u(0,t)}catch(e){throw e instanceof Error?e:new Error(d.getString("Errors.Dzi"))}else{if("Collection"===l)throw new Error(d.getString("Errors.Dzc"));if("Error"===l)throw a=a.getElementsByTagName("Message")[0].firstChild.nodeValue,new Error(a)}throw new Error(d.getString("Errors.Dzi"))})(this,e),t&&!e.tilesUrl&&(e.tilesUrl=t.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),-1!==t.search(/\.(dzi|xml|js)\?/)?e.queryParams=t.match(/\?.*/):e.queryParams=""),e},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,i){var n,r,o,s,a,l,h=this._levelRects[e];if(!(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)){if(!h||!h.length)return!0;for(l=h.length-1;0<=l;l--)if(!(e<(n=h[l]).minLevel||e>n.maxLevel)&&(a=this.getLevelScale(e),r=n.x*a,o=n.y*a,s=r+n.width*a,a=o+n.height*a,r=Math.floor(r/this._tileWidth),o=Math.floor(o/this._tileWidth),s=Math.ceil(s/this._tileWidth),a=Math.ceil(a/this._tileWidth),r<=t)&&t<s&&o<=i&&i<a)return!0}return!1}})}(OpenSeadragon),function(h){function c(e){var t=Array.isArray(e.profile)?e.profile[0]:e.profile,i=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(t),t=!1;return 2===e.version&&1<e.profile.length&&e.profile[1].supports&&(t=-1!==e.profile[1].supports.indexOf("sizeByW")),3===e.version&&e.extraFeatures&&(t=-1!==e.extraFeatures.indexOf("sizeByWh")),!i||t}function u(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+","+(3===e.version?e.sizes[i].height:"")+"/0/default."+e.tileFormat,width:e.sizes[i].width,height:e.sizes[i].height});return t.sort(function(e,t){return e.width-t.width})}h.IIIFTileSource=function(e){if(h.extend(!0,this,e),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(e.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=e.version,this.tile_width&&this.tile_height)e.tileWidth=this.tile_width,e.tileHeight=this.tile_height;else if(this.tile_width)e.tileSize=this.tile_width;else if(this.tile_height)e.tileSize=this.tile_height;else if(this.tiles)if(1===this.tiles.length)e.tileWidth=this.tiles[0].width,e.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var t=0;t<this.tiles.length;t++)for(var i=0;i<this.tiles[t].scaleFactors.length;i++){var n=this.tiles[t].scaleFactors[i];this.scale_factors.push(n),e.tileSizePerScaleFactor[n]={width:this.tiles[t].width,height:this.tiles[t].height||this.tiles[t].width}}}else if(c(e)){for(var r=Math.min(this.height,this.width),o=[256,512,1024],s=[],a=0;a<o.length;a++)o[a]<=r&&s.push(o[a]);e.tileSize=0<s.length?Math.max.apply(null,s):r}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,e.levels=u(this),h.extend(!0,e,{width:e.levels[e.levels.length-1].width,height:e.levels[e.levels.length-1].height,tileSize:Math.max(e.height,e.width),tileOverlap:0,minLevel:0,maxLevel:e.levels.length-1}),this.levels=e.levels):h.console.error("Nothing in the info.json to construct image pyramids from");var l;e.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?(l=Math.max.apply(null,this.scale_factors),e.maxLevel=Math.round(Math.log(l)*Math.LOG2E)):e.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),h.TileSource.apply(this,[e])},h.extend(h.IIIFTileSource.prototype,h.TileSource.prototype,{supports:function(e,t){return!!(e.protocol&&"http://iiif.io/api/image"===e.protocol||e["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"===e["@context"]||"http://iiif.io/api/image/1/context.json"===e["@context"])||e.profile&&0===e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||e.identifier&&e.width&&e.height||e.documentElement&&"info"===e.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"===e.documentElement.namespaceURI)},configure:function(e,t,i){if(h.isPlainObject(e)){if(e["@context"]){var n=e["@context"];if(Array.isArray(n))for(var r=0;r<n.length;r++)if("string"==typeof n[r]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(n[r])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===n[r])){n=n[r];break}switch(n){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":e.version=1;break;case"http://iiif.io/api/image/2/context.json":e.version=2;break;case"http://iiif.io/api/image/3/context.json":e.version=3;break;default:h.console.error("Data has a @context property which contains no known IIIF context URI.")}}else e["@context"]="http://iiif.io/api/image/1.0/context.json",e["@id"]=t.replace("/info.json",""),e.version=1;if(!e["@id"]&&e.id&&(e["@id"]=e.id),e.preferredFormats)for(var o=0;o<e.preferredFormats.length;o++)if(OpenSeadragon.imageFormatSupported(e.preferredFormats[o])){e.tileFormat=e.preferredFormats[o];break}return e}var s=function(e){if(!e||!e.documentElement)throw new Error(h.getString("Errors.Xml"));var t=e.documentElement;if("info"===t.tagName)try{return function e(t,i,n){var r,o;if(3===t.nodeType&&n)(o=t.nodeValue.trim()).match(/^\d*$/)&&(o=Number(o)),i[n]?(h.isArray(i[n])||(i[n]=[i[n]]),i[n].push(o)):i[n]=o;else if(1===t.nodeType)for(r=0;r<t.childNodes.length;r++)e(t.childNodes[r],i,t.nodeName)}(t,e={}),e}catch(e){throw e instanceof Error?e:new Error(h.getString("Errors.IIIF"))}throw new Error(h.getString("Errors.IIIF"))}(e);return s["@context"]="http://iiif.io/api/image/1.0/context.json",s["@id"]=t.replace("/info.xml",""),s.version=1,s},getTileWidth:function(e){return this.emulateLegacyImagePyramid?h.TileSource.prototype.getTileWidth.call(this,e):(e=Math.pow(2,this.maxLevel-e),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[e]?this.tileSizePerScaleFactor[e].width:this._tileWidth)},getTileHeight:function(e){return this.emulateLegacyImagePyramid?h.TileSource.prototype.getTileHeight.call(this,e):(e=Math.pow(2,this.maxLevel-e),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[e]?this.tileSizePerScaleFactor[e].height:this._tileHeight)},getLevelScale:function(e){return this.emulateLegacyImagePyramid?0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel?this.levels[e].width/this.levels[this.maxLevel].width:NaN:h.TileSource.prototype.getLevelScale.call(this,e)},getNumTiles:function(e){return this.emulateLegacyImagePyramid?this.getLevelScale(e)?new h.Point(1,1):new h.Point(0,0):h.TileSource.prototype.getNumTiles.call(this,e)},getTileAtPoint:function(e,t){return this.emulateLegacyImagePyramid?new h.Point(0,0):h.TileSource.prototype.getTileAtPoint.call(this,e,t)},getTileUrl:function(e,t,i){var n,r,o,s,a,l,h,c,u;return this.emulateLegacyImagePyramid?(u=null,0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel?this.levels[e].url:u):(o=Math.pow(.5,this.maxLevel-e),s=Math.ceil(this.width*o),a=Math.ceil(this.height*o),l=this.getTileWidth(e),h=this.getTileHeight(e),c=Math.ceil(l/o),u=Math.ceil(h/o),e=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,s<l&&a<h?(r=2===this.version&&s===this.width?"full":3===this.version&&s===this.width&&a===this.height?"max":3===this.version?s+","+a:s+",",n="full"):(a=t*c,s=i*u,c=Math.min(c,this.width-a),u=Math.min(u,this.height-s),n=0===t&&0===i&&c===this.width&&u===this.height?"full":[a,s,c,u].join(","),c=Math.ceil(c*o),o=Math.ceil(u*o),r=2===this.version&&c===this.width?"full":3===this.version&&c===this.width&&o===this.height?"max":3===this.version?c+","+o:c+","),[this["@id"],n,r,"0",e].join("/"))},__testonly__:{canBeTiled:c,constructLevels:u}})}(OpenSeadragon),function(o){o.OsmTileSource=function(e,t,i,n,r){(e=o.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:r}).width&&e.height||(e.width=65572864,e.height=65572864),e.tileSize||(e.tileSize=256,e.tileOverlap=0),e.tilesUrl||(e.tilesUrl="http://tile.openstreetmap.org/"),e.minLevel=8,o.TileSource.apply(this,[e])},o.extend(o.OsmTileSource.prototype,o.TileSource.prototype,{supports:function(e,t){return e.type&&"openstreetmaps"===e.type},configure:function(e,t,i){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(OpenSeadragon),function(o){o.TmsTileSource=function(e,t,i,n,r){e=o.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:r},t=256*Math.ceil(e.width/256),i=256*Math.ceil(e.height/256);e.maxLevel=Math.ceil(Math.log(i<t?t/256:i/256)/Math.log(2))-1,e.tileSize=256,e.width=t,e.height=i,o.TileSource.apply(this,[e])},o.extend(o.TmsTileSource.prototype,o.TileSource.prototype,{supports:function(e,t){return e.type&&"tiledmapservice"===e.type},configure:function(e,t,i){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(e){void 0===e.tileSize&&(e.tileSize=256),void 0===e.fileFormat&&(e.fileFormat="jpg",this.fileFormat=e.fileFormat);var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,i){return{x:Math.ceil(e/i),y:Math.ceil(t/i)}},_calculateAbsoluteTileNumber:function(e,t,i){for(var n=0,r={},o=0;o<e;o++)n+=(r=this.gridSize[o]).x*r.y;return n+((r=this.gridSize[e]).x*i+t)},supports:function(e,t){return e.type&&"zoomifytileservice"===e.type},configure:function(e,t,i){return e},getTileUrl:function(e,t,i){var n=this._calculateAbsoluteTileNumber(e,t,i),n=Math.floor(n/256);return this.tilesUrl+"TileGroup"+n+"/"+e+"-"+t+"-"+i+"."+this.fileFormat}})}(OpenSeadragon),function(h){h.LegacyTileSource=function(e){var t,i,n;(t=h.isArray(e)?{type:"legacy-image-pyramid",levels:e}:t).levels=function(e){for(var t,i=[],n=0;n<e.length;n++)(t=e[n]).height&&t.width&&t.url?i.push({url:t.url,width:Number(t.width),height:Number(t.height)}):h.console.error("Unsupported image format: %s",t.url||"<no URL>");return i.sort(function(e,t){return e.height-t.height})}(t.levels),0<t.levels.length?(i=t.levels[t.levels.length-1].width,n=t.levels[t.levels.length-1].height):(n=i=0,h.console.error("No supported image formats found")),h.extend(!0,t,{width:i,height:n,tileSize:Math.max(n,i),tileOverlap:0,minLevel:0,maxLevel:0<t.levels.length?t.levels.length-1:0}),h.TileSource.apply(this,[t]),this.levels=t.levels},h.extend(h.LegacyTileSource.prototype,h.TileSource.prototype,{supports:function(e,t){return e.type&&"legacy-image-pyramid"===e.type||e.documentElement&&"legacy-image-pyramid"===e.documentElement.getAttribute("type")},configure:function(e,t,i){if(h.isPlainObject(e))return e.levels;var n=e;if(!n||!n.documentElement)throw new Error(h.getString("Errors.Xml"));var r,o,s,e=n.documentElement,a=e.tagName,l=null;if("image"===a)try{for(l={type:e.getAttribute("type"),levels:[]},s=e.getElementsByTagName("level"),o=0;o<s.length;o++)r=s[o],l.levels.push({url:r.getAttribute("url"),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10)});return l.levels}catch(n){throw n instanceof Error?n:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"===a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"===a)throw new Error("Error: "+n)}throw new Error("Unknown element "+a)},getLevelScale:function(e){return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel?this.levels[e].width/this.levels[this.maxLevel].width:NaN},getNumTiles:function(e){return this.getLevelScale(e)?new h.Point(1,1):new h.Point(0,0)},getTileUrl:function(e,t,i){return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel?this.levels[e].url:null}})}(OpenSeadragon),function(a){a.ImageTileSource=function(e){e=a.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},e),a.TileSource.apply(this,[e])},a.extend(a.ImageTileSource.prototype,a.TileSource.prototype,{supports:function(e,t){return e.type&&"image"===e.type},configure:function(e,t,i){return e},getImageInfo:function(e){var t=this._image=new Image,i=this;this.crossOriginPolicy&&(t.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(t.useCredentials=this.ajaxWithCredentials),a.addEvent(t,"load",function(){i.width=t.naturalWidth,i.height=t.naturalHeight,i.aspectRatio=i.width/i.height,i.dimensions=new a.Point(i.width,i.height),i._tileWidth=i.width,i._tileHeight=i.height,i.tileOverlap=0,i.minLevel=0,i.levels=i._buildLevels(),i.maxLevel=i.levels.length-1,i.ready=!0,i.raiseEvent("ready",{tileSource:i})}),a.addEvent(t,"error",function(){i.raiseEvent("open-failed",{message:"Error loading image at "+e,source:e})}),t.src=e},getLevelScale:function(e){return e>=this.minLevel&&e<=this.maxLevel?this.levels[e].width/this.levels[this.maxLevel].width:NaN},getNumTiles:function(e){return this.getLevelScale(e)?new a.Point(1,1):new a.Point(0,0)},getTileUrl:function(e,t,i){return e>=this.minLevel&&e<=this.maxLevel?this.levels[e].url:null},getContext2D:function(e,t,i){return e>=this.minLevel&&e<=this.maxLevel?this.levels[e].context2D:null},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var e=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(this.buildPyramid&&a.supportsCanvas&&this.useCanvas){var t=this._image.naturalWidth,i=this._image.naturalHeight,n=document.createElement("canvas"),r=n.getContext("2d");if(n.width=t,n.height=i,r.drawImage(this._image,0,0,t,i),e[0].context2D=r,delete this._image,!a.isCanvasTainted(n))for(;2<=t&&2<=i;){var t=Math.floor(t/2),i=Math.floor(i/2),o=document.createElement("canvas"),s=o.getContext("2d");o.width=t,o.height=i,s.drawImage(n,0,0,t,i),e.splice(0,0,{context2D:s,width:t,height:i}),n=o,r=s}}else delete this._image;return e},_freeupCanvasMemory:function(){for(var e=0;e<this.levels.length;e++)this.levels[e].context2D&&(this.levels[e].context2D.canvas.height=0,this.levels[e].context2D.canvas.width=0)}})}(OpenSeadragon),function(r){r.TileSourceCollection=function(e,t,i,n){r.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(n){function r(i){n.requestAnimationFrame(function(){var e,t;(e=i).shouldFade&&(t=n.now(),t=1-(t-=e.fadeBeginTime)/e.fadeLength,t=Math.min(1,t),t=Math.max(0,t),e.imgGroup&&n.setElementOpacity(e.imgGroup,t,!0),0<t)&&r(e)})}function i(e,t){var i;e.element.disabled||(t>=n.ButtonState.GROUP&&e.currentState===n.ButtonState.REST&&((i=e).shouldFade=!1,i.imgGroup&&n.setElementOpacity(i.imgGroup,1,!0),e.currentState=n.ButtonState.GROUP),t>=n.ButtonState.HOVER&&e.currentState===n.ButtonState.GROUP&&(e.imgHover&&(e.imgHover.style.visibility=""),e.currentState=n.ButtonState.HOVER),t>=n.ButtonState.DOWN&&e.currentState===n.ButtonState.HOVER&&(e.imgDown&&(e.imgDown.style.visibility=""),e.currentState=n.ButtonState.DOWN))}function o(e,t){var i;e.element.disabled||(t<=n.ButtonState.HOVER&&e.currentState===n.ButtonState.DOWN&&(e.imgDown&&(e.imgDown.style.visibility="hidden"),e.currentState=n.ButtonState.HOVER),t<=n.ButtonState.GROUP&&e.currentState===n.ButtonState.HOVER&&(e.imgHover&&(e.imgHover.style.visibility="hidden"),e.currentState=n.ButtonState.GROUP),t<=n.ButtonState.REST&&e.currentState===n.ButtonState.GROUP&&((i=e).shouldFade=!0,i.fadeBeginTime=n.now()+i.fadeDelay,window.setTimeout(function(){r(i)},i.fadeDelay),e.currentState=n.ButtonState.REST))}n.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},n.Button=function(e){var t=this;n.EventSource.call(this),n.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:n.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:n.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},e),this.element=e.element||n.makeNeutralElement("div"),e.element||(this.imgRest=n.makeTransparentImage(this.srcRest),this.imgGroup=n.makeTransparentImage(this.srcGroup),this.imgHover=n.makeTransparentImage(this.srcHover),this.imgDown=n.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,n.setElementPointerEventsNone(this.imgRest),n.setElementPointerEventsNone(this.imgGroup),n.setElementPointerEventsNone(this.imgHover),n.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",n.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",n.Browser.vendor===n.BROWSERS.FIREFOX&&n.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=n.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new n.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){e.insideElementPressed?(i(t,n.ButtonState.DOWN),t.raiseEvent("enter",{originalEvent:e.originalEvent})):e.buttonDownAny||i(t,n.ButtonState.HOVER)},focusHandler:function(e){t.tracker.enterHandler(e),t.raiseEvent("focus",{originalEvent:e.originalEvent})},leaveHandler:function(e){o(t,n.ButtonState.GROUP),e.insideElementPressed&&t.raiseEvent("exit",{originalEvent:e.originalEvent})},blurHandler:function(e){t.tracker.leaveHandler(e),t.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(e){i(t,n.ButtonState.DOWN),t.raiseEvent("press",{originalEvent:e.originalEvent})},releaseHandler:function(e){e.insideElementPressed&&e.insideElementReleased?(o(t,n.ButtonState.HOVER),t.raiseEvent("release",{originalEvent:e.originalEvent})):e.insideElementPressed?o(t,n.ButtonState.GROUP):i(t,n.ButtonState.HOVER)},clickHandler:function(e){e.quick&&t.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){13===e.keyCode?(t.raiseEvent("click",{originalEvent:e.originalEvent}),t.raiseEvent("release",{originalEvent:e.originalEvent}),e.preventDefault=!0):e.preventDefault=!1}}),o(this,n.ButtonState.REST)},n.extend(n.Button.prototype,n.EventSource.prototype,{notifyGroupEnter:function(){i(this,n.ButtonState.GROUP)},notifyGroupExit:function(){o(this,n.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,n.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,n.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}})}(OpenSeadragon),function(r){r.ButtonGroup=function(e){r.extend(!0,this,{buttons:[],clickTimeThreshold:r.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:r.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},e);var t,i=this.buttons.concat([]),n=this;if(this.element=e.element||r.makeNeutralElement("div"),!e.group)for(this.element.style.display="inline-block",t=0;t<i.length;t++)this.element.appendChild(i[t].element);r.setElementTouchActionNone(this.element),this.tracker=new r.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){for(var t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupEnter()},leaveHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupExit()}})},r.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var e=this.buttons.pop();this.element.removeChild(e.element),e.destroy()}this.tracker.destroy(),this.element=null}}}(OpenSeadragon),function(S){S.Rect=function(e,t,i,n,r){var o,s;this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,this.width="number"==typeof i?i:0,this.height="number"==typeof n?n:0,this.degrees="number"==typeof r?r:0,this.degrees=S.positiveModulo(this.degrees,360),270<=this.degrees?(o=this.getTopRight(),this.x=o.x,this.y=o.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=270):180<=this.degrees?(o=this.getBottomRight(),this.x=o.x,this.y=o.y,this.degrees-=180):90<=this.degrees&&(o=this.getBottomLeft(),this.x=o.x,this.y=o.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=90)},S.Rect.fromSummits=function(e,t,i){var n=e.distanceTo(t),r=e.distanceTo(i);return i=t.minus(e),t=Math.atan(i.y/i.x),i.x<0?t+=Math.PI:i.y<0&&(t+=2*Math.PI),new S.Rect(e.x,e.y,n,r,t/Math.PI*180)},S.Rect.prototype={clone:function(){return new S.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new S.Point(this.x,this.y)},getBottomRight:function(){return new S.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new S.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new S.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new S.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new S.Point(this.width,this.height)},equals:function(e){return e instanceof S.Rect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.degrees===e.degrees},times:function(e){return new S.Rect(this.x*e,this.y*e,this.width*e,this.height*e,this.degrees)},translate:function(e){return new S.Rect(this.x+e.x,this.y+e.y,this.width,this.height,this.degrees)},union:function(e){var t=this.getBoundingBox(),i=e.getBoundingBox(),n=Math.min(t.x,i.x),r=Math.min(t.y,i.y);return e=Math.max(t.x+t.width,i.x+i.width),i=Math.max(t.y+t.height,i.y+i.height),new S.Rect(n,r,e-n,i-r)},intersection:function(e){for(var t,i,n,r,o,s,a=1e-10,l=[],h=this.getTopLeft(),c=(e.containsPoint(h,a)&&l.push(h),h=this.getTopRight(),e.containsPoint(h,a)&&l.push(h),h=this.getBottomLeft(),e.containsPoint(h,a)&&l.push(h),h=this.getBottomRight(),e.containsPoint(h,a)&&l.push(h),h=e.getTopLeft(),this.containsPoint(h,a)&&l.push(h),h=e.getTopRight(),this.containsPoint(h,a)&&l.push(h),h=e.getBottomLeft(),this.containsPoint(h,a)&&l.push(h),h=e.getBottomRight(),this.containsPoint(h,a)&&l.push(h),this._getSegments()),u=e._getSegments(),d=0;d<c.length;d++)for(var p=c[d],g=0;g<u.length;g++){var m=u[g];t=p[0],i=p[1],n=m[0],r=m[1],s=o=void 0,o=i.minus(t),s=r.minus(n),(m=0!=(i=-s.x*o.y+o.x*s.y)&&(r=(o.x*(t.y-n.y)-o.y*(t.x-n.x))/i,i=(s.x*(t.y-n.y)-s.y*(t.x-n.x))/i,-a<=r)&&r<=1-a&&-a<=i&&i<=1-a?new S.Point(t.x+i*o.x,t.y+i*o.y):null)&&l.push(m)}if(0===l.length)return null;for(var f=l[0].x,v=l[0].x,y=l[0].y,w=l[0].y,x=1;x<l.length;x++){var T=l[x];T.x<f&&(f=T.x),T.x>v&&(v=T.x),T.y<y&&(y=T.y),T.y>w&&(w=T.y)}return new S.Rect(f,y,v-f,w-y)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[e,t],[t,n],[n,i],[i,e]]},rotate:function(e,t){if(0===(e=S.positiveModulo(e,360)))return this.clone();t=t||this.getCenter();var i=this.getTopLeft().rotate(e,t);return e=(e=this.getTopRight().rotate(e,t).minus(i)).apply(function(e){return Math.abs(e)<1e-15?0:e}),t=Math.atan(e.y/e.x),e.x<0?t+=Math.PI:e.y<0&&(t+=2*Math.PI),new S.Rect(i.x,i.y,this.width,this.height,t/Math.PI*180)},getBoundingBox:function(){var e,t,i,n,r,o,s;return 0===this.degrees?this.clone():(e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),s=this.getBottomRight(),n=Math.min(e.x,t.x,i.x,s.x),r=Math.max(e.x,t.x,i.x,s.x),o=Math.min(e.y,t.y,i.y,s.y),s=Math.max(e.y,t.y,i.y,s.y),new S.Rect(n,o,r-n,s-o))},getIntegerBoundingBox:function(){var e=this.getBoundingBox(),t=Math.floor(e.x),i=Math.floor(e.y),n=Math.ceil(e.width+e.x-t),e=Math.ceil(e.height+e.y-i);return new S.Rect(t,i,n,e)},containsPoint:function(e,t){t=t||0;var i=this.getTopLeft(),n=this.getTopRight(),r=this.getBottomLeft(),o=n.minus(i),s=r.minus(i);return(e.x-i.x)*o.x+(e.y-i.y)*o.y>=-t&&(e.x-n.x)*o.x+(e.y-n.y)*o.y<=t&&(e.x-i.x)*s.x+(e.y-i.y)*s.y>=-t&&(e.x-r.x)*s.x+(e.y-r.y)*s.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(h){var s={};function a(e){e.quick&&(e="horizontal"===this.scroll?Math.floor(e.position.x/this.panelWidth):Math.floor(e.position.y/this.panelHeight),this.viewer.goToPage(e)),this.element.focus()}function l(e){var t,i,n,r,o;this.dragging=!0,this.element&&(t=Number(this.element.style.marginLeft.replace("px","")),i=Number(this.element.style.marginTop.replace("px","")),n=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),o=h.getElementSize(this.viewer.canvas),"horizontal"===this.scroll?0<-e.delta.x?t>-(n-o.x)&&(this.element.style.marginLeft=t+2*e.delta.x+"px",u(this,o.x,t+2*e.delta.x)):-e.delta.x<0&&t<0&&(this.element.style.marginLeft=t+2*e.delta.x+"px",u(this,o.x,t+2*e.delta.x)):0<-e.delta.y?i>-(r-o.y)&&(this.element.style.marginTop=i+2*e.delta.y+"px",u(this,o.y,i+2*e.delta.y)):-e.delta.y<0&&i<0&&(this.element.style.marginTop=i+2*e.delta.y+"px",u(this,o.y,i+2*e.delta.y)))}function c(e){var t,i,n,r,o;this.element&&(t=Number(this.element.style.marginLeft.replace("px","")),i=Number(this.element.style.marginTop.replace("px","")),n=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),o=h.getElementSize(this.viewer.canvas),"horizontal"===this.scroll?0<e.scroll?t>-(n-o.x)&&(this.element.style.marginLeft=t-60*e.scroll+"px",u(this,o.x,t-60*e.scroll)):e.scroll<0&&t<0&&(this.element.style.marginLeft=t-60*e.scroll+"px",u(this,o.x,t-60*e.scroll)):e.scroll<0?i>o.y-r&&(this.element.style.marginTop=i+60*e.scroll+"px",u(this,o.y,i+60*e.scroll)):0<e.scroll&&i<0&&(this.element.style.marginTop=i+60*e.scroll+"px",u(this,o.y,i+60*e.scroll)),e.preventDefault=!0)}function u(e,t,i){for(var n,r,o,s="horizontal"===e.scroll?e.panelWidth:e.panelHeight,a=Math.ceil(t/s)+5,l=(a=(n=Math.ceil((Math.abs(i)+t)/s)+1)-a)<0?0:a;l<n&&l<e.panels.length;l++)(r=e.panels[l]).activePanel||(o=(o=e.viewer.tileSources[l]).referenceStripThumbnailUrl?{type:"image",url:o.referenceStripThumbnailUrl}:o,o=new h.Viewer({id:r.id,tileSources:[o],element:r,navigatorSizeRatio:e.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:e.viewer.loadTilesWithAjax,ajaxHeaders:e.viewer.ajaxHeaders,useCanvas:e.useCanvas}),h.setElementPointerEventsNone(o.canvas),h.setElementPointerEventsNone(o.container),o.innerTracker.setTracking(!1),o.outerTracker.setTracking(!1),e.miniViewers[r.id]=o,r.activePanel=!0)}function d(e){e=e.eventSource.element,"horizontal"===this.scroll?e.style.marginBottom="0px":e.style.marginLeft="0px"}function p(e){e=e.eventSource.element,"horizontal"===this.scroll?e.style.marginBottom="-"+h.getElementSize(e).y/2+"px":e.style.marginLeft="-"+h.getElementSize(e).x/2+"px"}function g(e){if(e.ctrl||e.alt||e.meta)e.preventDefault=!1;else switch(e.keyCode){case 38:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 40:case 37:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 39:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;default:e.preventDefault=!1}}function m(e){if(e.ctrl||e.alt||e.meta)e.preventDefault=!1;else switch(e.keyCode){case 61:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 45:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 48:case 119:case 87:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 115:case 83:case 97:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 100:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;default:e.preventDefault=!1}}h.ReferenceStrip=function(e){var t,i,n,r=e.viewer,o=h.getElementSize(r.element);for(e.id||(e.id="referencestrip-"+h.now(),this.element=h.makeNeutralElement("div"),this.element.id=e.id,this.element.className="referencestrip"),e=h.extend(!0,{sizeRatio:h.DEFAULT_SETTINGS.referenceStripSizeRatio,position:h.DEFAULT_SETTINGS.referenceStripPosition,scroll:h.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:h.DEFAULT_SETTINGS.clickTimeThreshold},e,{element:this.element}),h.extend(this,e),s[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,(i=this.element.style).marginTop="0px",i.marginRight="0px",i.marginBottom="0px",i.marginLeft="0px",i.left="0px",i.bottom="0px",i.border="0px",i.background="#000",i.position="relative",h.setElementTouchActionNone(this.element),h.setElementOpacity(this.element,.8),this.viewer=r,this.tracker=new h.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:h.delegate(this,a),dragHandler:h.delegate(this,l),scrollHandler:h.delegate(this,c),enterHandler:h.delegate(this,d),leaveHandler:h.delegate(this,p),keyDownHandler:h.delegate(this,g),keyHandler:h.delegate(this,m),preProcessEventHandler:function(e){"wheel"===e.eventType&&(e.preventDefault=!0)}}),e.width&&e.height?(this.element.style.width=e.width+"px",this.element.style.height=e.height+"px",r.addControl(this.element,{anchor:h.ControlAnchor.BOTTOM_LEFT})):"horizontal"===e.scroll?(this.element.style.width=o.x*e.sizeRatio*r.tileSources.length+12*r.tileSources.length+"px",this.element.style.height=o.y*e.sizeRatio+"px",r.addControl(this.element,{anchor:h.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=o.y*e.sizeRatio*r.tileSources.length+12*r.tileSources.length+"px",this.element.style.width=o.x*e.sizeRatio+"px",r.addControl(this.element,{anchor:h.ControlAnchor.TOP_LEFT})),this.panelWidth=o.x*this.sizeRatio+8,this.panelHeight=o.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},n=0;n<r.tileSources.length;n++)(t=h.makeNeutralElement("div")).id=this.element.id+"-"+n,t.style.width=this.panelWidth+"px",t.style.height=this.panelHeight+"px",t.style.display="inline",t.style.float="left",t.style.cssFloat="left",t.style.styleFloat="left",t.style.padding="2px",h.setElementTouchActionNone(t),h.setElementPointerEventsNone(t),this.element.appendChild(t),t.activePanel=!1,this.panels.push(t);u(this,"vertical"===this.scroll?o.y:o.x,0),this.setFocus(0)},h.ReferenceStrip.prototype={setFocus:function(e){var t,i=this.element.querySelector("#"+this.element.id+"-"+e),n=h.getElementSize(this.viewer.canvas),r=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),s=-Number(this.element.style.marginLeft.replace("px","")),a=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==i&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=i,this.currentSelected.style.background="#999","horizontal"===this.scroll?(t=Number(e)*(this.panelWidth+3))>s+n.x-this.panelWidth?(t=Math.min(t,r-n.x),this.element.style.marginLeft=-t+"px",u(this,n.x,-t)):t<s&&(t=Math.max(0,t-n.x/2),this.element.style.marginLeft=-t+"px",u(this,n.x,-t)):(t=Number(e)*(this.panelHeight+3))>a+n.y-this.panelHeight?(t=Math.min(t,o-n.y),this.element.style.marginTop=-t+"px",u(this,n.y,-t)):t<a&&(t=Math.max(0,t-n.y/2),this.element.style.marginTop=-t+"px",u(this,n.y,-t)),this.currentPage=e,d.call(this,{eventSource:this.tracker}))},update:function(){return!!s[this.id].animating},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}}}(OpenSeadragon),function(s){s.DisplayRect=function(e,t,i,n,r,o){s.Rect.apply(this,[e,t,i,n]),this.minLevel=r,this.maxLevel=o},s.extend(s.DisplayRect.prototype,s.Rect.prototype)}(OpenSeadragon),function(r){r.Spring=function(e){var t=arguments;"object"!=typeof e&&(e={initial:t.length&&"number"==typeof t[0]?t[0]:void 0,springStiffness:1<t.length?t[1].springStiffness:5,animationTime:1<t.length?t[1].animationTime:1.5}),r.console.assert("number"==typeof e.springStiffness&&0!==e.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),r.console.assert("number"==typeof e.animationTime&&0<=e.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),e.exponential&&(this._exponential=!0,delete e.exponential),r.extend(!0,this,e),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:r.now()},r.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},r.Spring.prototype={resetTo:function(e){r.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=e,this.start.time=this.target.time=this.current.time=r.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(e){r.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(e){this.start.value+=e,this.target.value+=e,this._exponential&&(r.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(e){this._exponential=e,this._exponential&&(r.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=r.now(),t=this._exponential?(e=this.start._logValue,this.target._logValue):(e=this.start.value,this.target.value),i=this.current.time>=this.target.time?t:e+(t-e)*(n=this.springStiffness,i=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(n*-i))/(1-Math.exp(-n)));var e,t,i,n=this.current.value;return this._exponential?this.current.value=Math.exp(i):this.current.value=i,n!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(t){function i(e){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null},e),this.image=null}i.prototype={errorMsg:null,start:function(){var r=this,e=this.abort;this.image=new Image,this.image.onload=function(){r.finish(!0)},this.image.onabort=this.image.onerror=function(){r.errorMsg="Image load aborted",r.finish(!1)},this.jobId=window.setTimeout(function(){r.errorMsg="Image load exceeded timeout ("+r.timeout+" ms)",r.finish(!1)},this.timeout),this.loadWithAjax?(this.request=t.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",postData:this.postData,success:function(t){try{n=new window.Blob([t.response])}catch(e){var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;"TypeError"===e.name&&i&&((i=new i).append(t.response),n=i.getBlob())}0===n.size&&(r.errorMsg="Empty image response.",r.finish(!1));var n=(window.URL||window.webkitURL).createObjectURL(n);r.image.src=n},error:function(e){r.errorMsg="Image load aborted - XHR error: Ajax returned "+e.status,r.finish(!1)}}),this.abort=function(){r.request.abort(),"function"==typeof e&&e()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(e){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},e)},t.ImageLoader.prototype={addJob:function(n){var r=this,e=new i({src:n.src,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.loadWithAjax?n.ajaxHeaders:null,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,postData:n.postData,callback:function(e){var t,i;t=r,e=e,i=n.callback,t.jobsInProgress--,(!t.jobLimit||t.jobsInProgress<t.jobLimit)&&0<t.jobQueue.length&&(t.jobQueue.shift().start(),t.jobsInProgress++),i(e.image,e.errorMsg,e.request)},abort:n.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(e.start(),this.jobsInProgress++):this.jobQueue.push(e)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var t=this.jobQueue[e];"function"==typeof t.abort&&t.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(d){d.Tile=function(e,t,i,n,r,o,s,a,l,h,c,u){this.level=e,this.x=t,this.y=i,this.bounds=n,this.sourceBounds=h,this.exists=r,this.url=o,this.postData=c,this.context2D=s,this.loadWithAjax=a,this.ajaxHeaders=l,void 0===u&&(d.console.error("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),u=d.TileSource.prototype.getTileHashKey(e,t,i,o,l,c)),this.cacheKey=u,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},d.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(e){this.cacheImageRecord?this.loaded?(this.element||(this.element=d.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!==e&&e.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),d.setElementOpacity(this.element,this.opacity)):d.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):d.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(e,t,i,n,r){var o,s,a=this.position.times(d.pixelDensityRatio),l=this.size.times(d.pixelDensityRatio);this.context2D||this.cacheImageRecord?(s=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&s?(e.save(),e.globalAlpha=this.opacity,"number"==typeof i&&1!==i&&(a=a.times(i),l=l.times(i)),n instanceof d.Point&&(a=a.plus(n)),1===e.globalAlpha&&this._hasTransparencyChannel()&&(r&&(a.x=Math.round(a.x),a.y=Math.round(a.y),l.x=Math.round(l.x),l.y=Math.round(l.y)),e.clearRect(a.x,a.y,l.x,l.y)),t({context:e,tile:this,rendered:s}),i=this.sourceBounds?(o=Math.min(this.sourceBounds.width,s.canvas.width),Math.min(this.sourceBounds.height,s.canvas.height)):(o=s.canvas.width,s.canvas.height),e.translate(a.x+l.x/2,0),this.flipped&&e.scale(-1,1),e.drawImage(s.canvas,0,0,o,i,-l.x/2,a.y,l.x,l.y),e.restore()):d.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):d.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var e;if(this.cacheImageRecord)e=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return d.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;e=this.context2D}return e.canvas.width/(this.size.x*d.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(e,t,i){var n=Math.max(1,Math.ceil((i.x-t.x)/2));return t=Math.max(1,Math.ceil((i.y-t.y)/2)),new d.Point(n,t).minus(this.position.times(d.pixelDensityRatio).times(e||1).apply(function(e){return e%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(o){o.OverlayPlacement=o.Placement,o.OverlayRotationMode=o.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),o.Overlay=function(e,t,i){i=o.isPlainObject(e)?e:{element:e,location:t,placement:i},this.element=i.element,this.style=i.element.style,this._init(i)},o.Overlay.prototype={_init:function(e){this.location=e.location,this.placement=void 0===e.placement?o.Placement.TOP_LEFT:e.placement,this.onDraw=e.onDraw,this.checkResize=void 0===e.checkResize||e.checkResize,this.width=void 0===e.width?null:e.width,this.height=void 0===e.height?null:e.height,this.rotationMode=e.rotationMode||o.OverlayRotationMode.EXACT,this.location instanceof o.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=o.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new o.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(e,t){var i=o.Placement.properties[this.placement];i&&(i.isHorizontallyCentered?e.x-=t.x/2:i.isRight&&(e.x-=t.x),i.isVerticallyCentered?e.y-=t.y/2:i.isBottom&&(e.y-=t.y))},destroy:function(){var e=this.element,t=this.style,i=(e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent)&&(t.display="none",document.body.appendChild(e)),this.onDraw=null,t.top="",t.left="",t.position="",null!==this.width&&(t.width=""),null!==this.height&&(t.height=""),o.getCssPropertyWithVendorPrefix("transformOrigin")),e=o.getCssPropertyWithVendorPrefix("transform");i&&e&&(t[i]="",t[e]="")},drawHTML:function(e,t){var i=this.element,n=(i.parentNode!==e&&(i.prevElementParent=i.parentNode,i.prevNextSibling=i.nextSibling,e.appendChild(i),this.style.position="absolute",this.size=o.getElementSize(i)),this._getOverlayPositionAndSize(t));e=n.position,i=this.size=n.size,t=n.rotate,this.onDraw?this.onDraw(e,i,this.element):((n=this.style).left=e.x+"px",n.top=e.y+"px",null!==this.width&&(n.width=i.x+"px"),null!==this.height&&(n.height=i.y+"px"),e=o.getCssPropertyWithVendorPrefix("transformOrigin"),i=o.getCssPropertyWithVendorPrefix("transform"),e&&i&&(t?(n[e]=this._getTransformOrigin(),n[i]="rotate("+t+"deg)"):(n[e]="",n[i]="")),n.display="block")},_getOverlayPositionAndSize:function(e){var t,i=e.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(e),r=(this.adjust(i,n),0);return e.degrees&&this.rotationMode!==o.OverlayRotationMode.NO_ROTATION&&(this.rotationMode===o.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height?(t=new o.Rect(i.x,i.y,n.x,n.y),i=(t=this._getBoundingBox(t,e.degrees)).getTopLeft(),n=t.getSize()):r=e.degrees),{position:i,size:n,rotate:r}},_getSizeInPixels:function(e){var t,i=this.size.x,n=this.size.y;return null===this.width&&null===this.height||(t=e.deltaPixelsFromPointsNoRotate(new o.Point(this.width||0,this.height||0),!0),null!==this.width&&(i=t.x),null!==this.height&&(n=t.y)),!this.checkResize||null!==this.width&&null!==this.height||(t=this.size=o.getElementSize(this.element),null===this.width&&(i=t.x),null===this.height&&(n=t.y)),new o.Point(i,n)},_getBoundingBox:function(e,t){var i=this._getPlacementPoint(e);return e.rotate(t,i).getBoundingBox()},_getPlacementPoint:function(e){var t=new o.Point(e.x,e.y),i=o.Placement.properties[this.placement];return i&&(i.isHorizontallyCentered?t.x+=e.width/2:i.isRight&&(t.x+=e.width),i.isVerticallyCentered?t.y+=e.height/2:i.isBottom&&(t.y+=e.height)),t},_getTransformOrigin:function(){var e="",t=o.Placement.properties[this.placement];return t&&(t.isLeft?e="left":t.isRight&&(e="right"),t.isTop?e+=" top":t.isBottom&&(e+=" bottom")),e},update:function(e,t){t=o.isPlainObject(e)?e:{location:e,placement:t},this._init({location:t.location||this.location,placement:(void 0!==t.placement?t:this).placement,onDraw:t.onDraw||this.onDraw,checkResize:t.checkResize||this.checkResize,width:(void 0!==t.width?t:this).width,height:(void 0!==t.height?t:this).height,rotationMode:t.rotationMode||this.rotationMode})},getBounds:function(e){o.console.assert(e,"A viewport must now be passed to Overlay.getBounds.");var t,i=this.width,n=this.height;return null!==i&&null!==n||(t=e.deltaPointsFromPixelsNoRotate(this.size,!0),null===i&&(i=t.x),null===n&&(n=t.y)),t=this.location.clone(),this.adjust(t,new o.Point(i,n)),this._adjustBoundsForRotation(e,new o.Rect(t.x,t.y,i,n))},_adjustBoundsForRotation:function(e,t){return e&&0!==e.degrees&&this.rotationMode!==o.OverlayRotationMode.EXACT?this.rotationMode!==o.OverlayRotationMode.BOUNDING_BOX?t.rotate(-e.degrees,this._getPlacementPoint(t)):null===this.width||null===this.height?t:(t=this._getOverlayPositionAndSize(e),e.viewerElementToViewportRectangle(new o.Rect(t.position.x,t.position.y,t.size.x,t.size.y))):t}}}(OpenSeadragon),function(a){a.Drawer=function(e){a.console.assert(e.viewer,"[Drawer] options.viewer is required");var t=arguments;a.isPlainObject(e)||(e={source:t[0],viewport:t[1],element:t[2]}),a.console.assert(e.viewport,"[Drawer] options.viewport is required"),a.console.assert(e.element,"[Drawer] options.element is required"),e.source&&a.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=e.viewer,this.viewport=e.viewport,this.debugGridColor="string"==typeof e.debugGridColor?[e.debugGridColor]:e.debugGridColor||a.DEFAULT_SETTINGS.debugGridColor,e.opacity&&a.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=a.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=a.getElement(e.element),this.canvas=a.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas&&(t=this._calculateCanvasSize(),this.canvas.width=t.x,this.canvas.height=t.y),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",a.setElementOpacity(this.canvas,this.opacity,!0),a.setElementPointerEventsNone(this.canvas),a.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},a.Drawer.prototype={addOverlay:function(e,t,i,n){return a.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(e,t,i,n),this},updateOverlay:function(e,t,i){return a.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(e,t,i),this},removeOverlay:function(e){return a.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(e),this},clearOverlays:function(){return a.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(e){return e=this.viewport.pixelFromPointNoRotate(e,!0),new a.Point(e.x*a.pixelDensityRatio,e.y*a.pixelDensityRatio)},clipWithPolygons:function(e,t){var i;this.useCanvas&&((i=this._getContext(t)).beginPath(),e.forEach(function(e){e.forEach(function(e,t){i[0===t?"moveTo":"lineTo"](e.x,e.y)})}),i.clip())},setOpacity:function(e){a.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var t=this.viewer.world,i=0;i<t.getItemCount();i++)t.getItemAt(i).setOpacity(e);return this},getOpacity:function(){a.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var e=this.viewer.world,t=0,i=0;i<e.getItemCount();i++){var n=e.getItemAt(i).getOpacity();t<n&&(t=n)}return t},needsUpdate:function(){return a.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return a.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return a.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return a.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){var e;this.canvas.innerHTML="",this.useCanvas&&(e=this._calculateCanvasSize(),this.canvas.width===e.x&&this.canvas.height===e.y||(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas&&(e=this._calculateSketchCanvasSize(),this.sketchCanvas.width=e.x,this.sketchCanvas.height=e.y,this._updateImageSmoothingEnabled(this.sketchContext))),this._clear())},_clear:function(e,t){this.useCanvas&&(e=this._getContext(e),t?e.clearRect(t.x,t.y,t.width,t.height):(t=e.canvas,e.clearRect(0,0,t.width,t.height)))},viewportToDrawerRectangle:function(e){var t=this.viewport.pixelFromPointNoRotate(e.getTopLeft(),!0);return e=this.viewport.deltaPixelsFromPointsNoRotate(e.getSize(),!0),new a.Rect(t.x*a.pixelDensityRatio,t.y*a.pixelDensityRatio,e.x*a.pixelDensityRatio,e.y*a.pixelDensityRatio)},drawTile:function(e,t,i,n,r,o){a.console.assert(e,"[Drawer.drawTile] tile is required"),a.console.assert(t,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas?(i=this._getContext(i),e.drawCanvas(i,t,n=n||1,r,o)):e.drawHTML(this.canvas)},_getContext:function(e){var i,t=this.context;return e&&(null===this.sketchCanvas&&(this.sketchCanvas=document.createElement("canvas"),e=this._calculateSketchCanvasSize(),this.sketchCanvas.width=e.x,this.sketchCanvas.height=e.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()&&(i=this).viewer.addHandler("rotate",function e(){var t;0!==i.viewport.getRotation()&&(i.viewer.removeHandler("rotate",e),t=i._calculateSketchCanvasSize(),i.sketchCanvas.width=t.x,i.sketchCanvas.height=t.y)}),this._updateImageSmoothingEnabled(this.sketchContext)),t=this.sketchContext),t},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(e,t){this.useCanvas&&((t=this._getContext(t)).beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip())},drawRectangle:function(e,t,i){this.useCanvas&&((i=this._getContext(i)).save(),i.fillStyle=t,i.fillRect(e.x,e.y,e.width,e.height),i.restore())},blendSketch:function(e,t,i,n){var r,o=e;a.isPlainObject(o)||(o={opacity:e,scale:t,translate:i,compositeOperation:n}),this.useCanvas&&this.sketchCanvas&&(e=o.opacity,n=o.compositeOperation,r=o.bounds,this.context.save(),this.context.globalAlpha=e,n&&(this.context.globalCompositeOperation=n),r?(r.x<0&&(r.width+=r.x,r.x=0),r.x+r.width>this.canvas.width&&(r.width=this.canvas.width-r.x),r.y<0&&(r.height+=r.y,r.y=0),r.y+r.height>this.canvas.height&&(r.height=this.canvas.height-r.y),this.context.drawImage(this.sketchCanvas,r.x,r.y,r.width,r.height,r.x,r.y,r.width,r.height)):(t=o.scale||1,e=(i=o.translate)instanceof a.Point?i:new a.Point(0,0),r=n=0,i&&(o=this.sketchCanvas.width-this.canvas.width,i=this.sketchCanvas.height-this.canvas.height,n=Math.round(o/2),r=Math.round(i/2)),this.context.drawImage(this.sketchCanvas,e.x-n*t,e.y-r*t,(this.canvas.width+2*n)*t,(this.canvas.height+2*r)*t,-n,-r,this.canvas.width+2*n,this.canvas.height+2*r)),this.context.restore())},drawDebugInfo:function(e,t,i,n){var r,o,s;this.useCanvas&&(s=this.viewer.world.getIndexOfItem(n)%this.debugGridColor.length,(r=this.context).save(),r.lineWidth=2*a.pixelDensityRatio,r.font="small-caps bold "+13*a.pixelDensityRatio+"px arial",r.strokeStyle=this.debugGridColor[s],r.fillStyle=this.debugGridColor[s],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),n.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:n.getRotation(!0),point:n.viewport.pixelFromPointNoRotate(n._getRotationPoint(!0),!0)}),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),r.strokeRect(e.position.x*a.pixelDensityRatio,e.position.y*a.pixelDensityRatio,e.size.x*a.pixelDensityRatio,e.size.y*a.pixelDensityRatio),o=(e.position.x+e.size.x/2)*a.pixelDensityRatio,s=(e.position.y+e.size.y/2)*a.pixelDensityRatio,r.translate(o,s),r.rotate(Math.PI/180*-this.viewport.degrees),r.translate(-o,-s),0===e.x&&0===e.y&&(r.fillText("Zoom: "+this.viewport.getZoom(),e.position.x*a.pixelDensityRatio,(e.position.y-30)*a.pixelDensityRatio),r.fillText("Pan: "+this.viewport.getBounds().toString(),e.position.x*a.pixelDensityRatio,(e.position.y-20)*a.pixelDensityRatio)),r.fillText("Level: "+e.level,(e.position.x+10)*a.pixelDensityRatio,(e.position.y+20)*a.pixelDensityRatio),r.fillText("Column: "+e.x,(e.position.x+10)*a.pixelDensityRatio,(e.position.y+30)*a.pixelDensityRatio),r.fillText("Row: "+e.y,(e.position.x+10)*a.pixelDensityRatio,(e.position.y+40)*a.pixelDensityRatio),r.fillText("Order: "+i+" of "+t,(e.position.x+10)*a.pixelDensityRatio,(e.position.y+50)*a.pixelDensityRatio),r.fillText("Size: "+e.size.toString(),(e.position.x+10)*a.pixelDensityRatio,(e.position.y+60)*a.pixelDensityRatio),r.fillText("Position: "+e.position.toString(),(e.position.x+10)*a.pixelDensityRatio,(e.position.y+70)*a.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),n.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),r.restore())},debugRect:function(e){var t;this.useCanvas&&((t=this.context).save(),t.lineWidth=2*a.pixelDensityRatio,t.strokeStyle=this.debugGridColor[0],t.fillStyle=this.debugGridColor[0],t.strokeRect(e.x*a.pixelDensityRatio,e.y*a.pixelDensityRatio,e.width*a.pixelDensityRatio,e.height*a.pixelDensityRatio),t.restore())},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(e){return e=this._getContext(e).canvas,new a.Point(e.width,e.height)},getCanvasCenter:function(){return new a.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(e){var t=e.point?e.point.times(a.pixelDensityRatio):this.getCanvasCenter(),i=this._getContext(e.useSketch);i.save(),i.translate(t.x,t.y),this.viewer.viewport.flipped?(i.rotate(Math.PI/180*-e.degrees),i.scale(-1,1)):i.rotate(Math.PI/180*e.degrees),i.translate(-t.x,-t.y)},_flip:function(e){var t=(e=e||{}).point?e.point.times(a.pixelDensityRatio):this.getCanvasCenter();(e=this._getContext(e.useSketch)).translate(t.x,0),e.scale(-1,1),e.translate(-t.x,0)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var e=a.pixelDensityRatio,t=this.viewport.getContainerSize();return{x:Math.round(t.x*e),y:Math.round(t.y*e)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();return 0===this.viewport.getRotation()?e:{x:e=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y)),y:e}}}}(OpenSeadragon),function(a){a.Viewport=function(e){var t=arguments;(e=t.length&&t[0]instanceof a.Point?{containerSize:t[0],contentSize:t[1],config:t[2]}:e).config&&(a.extend(!0,e,e.config),delete e.config),this._margins=a.extend({left:0,top:0,right:0,bottom:0},e.margins||{}),delete e.margins,a.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:a.DEFAULT_SETTINGS.springStiffness,animationTime:a.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:a.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:a.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:a.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:a.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:a.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:a.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:a.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:a.DEFAULT_SETTINGS.maxZoomLevel,degrees:a.DEFAULT_SETTINGS.degrees,flipped:a.DEFAULT_SETTINGS.flipped,homeFillsViewer:a.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:a.DEFAULT_SETTINGS.silenceMultiImageWarnings},e),this._updateContainerInnerSize(),this.centerSpringX=new a.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new a.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new a.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new a.Rect(0,0,1,1),1),this.goHome(!0),this.update()},a.Viewport.prototype={resetContentSize:function(e){return a.console.assert(e,"[Viewport.resetContentSize] contentSize is required"),a.console.assert(e instanceof a.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),a.console.assert(0<e.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),a.console.assert(0<e.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new a.Rect(0,0,1,e.y/e.x),e.x),this},setHomeBounds:function(e,t){a.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(e,t)},_setContentBounds:function(e,t){a.console.assert(e,"[Viewport._setContentBounds] bounds is required"),a.console.assert(e instanceof a.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),a.console.assert(0<e.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),a.console.assert(0<e.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(t),this._contentBounds=e.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(t),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:t,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){var e;return this.defaultZoomLevel||(e=this._contentAspectRatio/this.getAspectRatio(),(this.homeFillsViewer?1<=e?e:1:1<=e?1:e)/this._contentBounds.width)},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var e=this._contentBounds.getCenter(),t=1/this.getHomeZoom(),i=t/this.getAspectRatio();return new a.Rect(e.x-t/2,e.y-i/2,t,i)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel||this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new a.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return a.extend({},this._margins)},setMargins:function(e){a.console.assert("object"===a.type(e),"[Viewport.setMargins] margins must be an object"),this._margins=a.extend({left:0,top:0,right:0,bottom:0},e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(e){var t=this.getCenter(e),i=1/this.getZoom(e);return e=i/this.getAspectRatio(),new a.Rect(t.x-i/2,t.y-e/2,i,e)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e);return e=this._containerInnerSize.x*this.getZoom(e),t.x-=this._margins.left/e,t.y-=this._margins.top/e,t.width+=(this._margins.left+this._margins.right)/e,t.height+=(this._margins.top+this._margins.bottom)/e,t},getCenter:function(e){var t,i,n,r=new a.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),o=new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return e?r:this.zoomPoint?(t=this.pixelFromPoint(this.zoomPoint,!0),e=(i=1/(n=this.getZoom()))/this.getAspectRatio(),e=new a.Rect(r.x-i/2,r.y-e/2,i,e),n=this._pixelFromPoint(this.zoomPoint,e).minus(t).divide(this._containerInnerSize.x*n),o.plus(n)):o},getZoom:function(e){return(e?this.zoomSpring.current:this.zoomSpring.target).value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var t,i,n;return e=new a.Rect(e.x,e.y,e.width,e.height),this.wrapHorizontal||(t=this.visibilityRatio*e.width,i=e.x+e.width,n=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,i=this._contentBoundsNoRotate.x-i+t,n=n-e.x-t,t>this._contentBoundsNoRotate.width?e.x+=(i+n)/2:n<0?e.x+=n:0<i&&(e.x+=i)),this.wrapVertical||(t=this.visibilityRatio*e.height,n=e.y+e.height,i=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,n=this._contentBoundsNoRotate.y-n+t,i=i-e.y-t,t>this._contentBoundsNoRotate.height?e.y+=(n+i)/2:i<0?e.y+=i:0<n&&(e.y+=n)),e},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t=this.getZoom(),i=this._applyZoomConstraints(t);return t!==i&&this.zoomTo(i,this.zoomPoint,e),t=this.getBoundsNoRotate(),i=this._applyBoundaryConstraints(t),this._raiseConstraintsEvent(e),t.x===i.x&&t.y===i.y&&!e||this.fitBounds(i.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(e,t){var i,n,r=(t=t||{}).immediately||!1,o=t.constraints||!1,s=this.getAspectRatio();return t=e.getCenter(),(e=new a.Rect(e.x,e.y,e.width,e.height,e.degrees+this.getRotation()).getBoundingBox()).getAspectRatio()>=s?e.height=e.width/s:e.width=e.height*s,e.x=t.x-e.width/2,e.y=t.y-e.height/2,s=1/e.width,o&&(i=e.getAspectRatio(),s!==(n=this._applyZoomConstraints(s))&&(e.width=1/(s=n),e.x=t.x-e.width/2,e.height=e.width/i,e.y=t.y-e.height/2),t=(e=this._applyBoundaryConstraints(e)).getCenter(),this._raiseConstraintsEvent(r)),r?(this.panTo(t,!0),this.zoomTo(s,null,!0)):(this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0),n=this.getBounds(),0===(i=this.getZoom())||Math.abs(s/i-1)<1e-8?(this.zoomTo(s,!0),this.panTo(t,r)):(i=(e=e.rotate(-this.getRotation())).getTopLeft().times(s).minus(n.getTopLeft().times(i)).divide(s-i),this.zoomTo(s,i,r)))},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(e){var t=new a.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(t,e)},fitHorizontally:function(e){var t=new a.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(t,e)},getConstrainedBounds:function(e){return e=this.getBounds(e),this._applyBoundaryConstraints(e)},panBy:function(e,t){var i=new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(i.plus(e),t)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(e,t,i){var n=this;return this.zoomPoint=t instanceof a.Point&&!isNaN(t.x)&&!isNaN(t.y)?t:null,i?this._adjustCenterSpringsForZoomPoint(function(){n.zoomSpring.resetTo(e)}):this.zoomSpring.springTo(e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:e,refPoint:t,immediately:i}),this},setRotation:function(e){return this.viewer&&this.viewer.drawer.canRotate()&&(this.degrees=a.positiveModulo(e,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:e})),this},getRotation:function(){return this.degrees},resize:function(e,t){var i,n=this.getBoundsNoRotate(),r=n;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(i=e.x/this.containerSize.x,r.width=n.width*i,r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(r,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new a.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this,t=(this._adjustCenterSpringsForZoomPoint(function(){e.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update(),this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom);return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){var t;this.zoomPoint?(t=this.pixelFromPoint(this.zoomPoint,!0),e(),t=this.pixelFromPoint(this.zoomPoint,!0).minus(t),t=this.deltaPointsFromPixels(t,!0),this.centerSpringX.shiftBy(t.x),this.centerSpringY.shiftBy(t.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)):e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(e,t){return e.minus(t.getTopLeft()).times(this._containerInnerSize.x/t.width).plus(new a.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(e,t){return t=this.getBoundsNoRotate(t),e.minus(new a.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/t.width).plus(t.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(e,t){var i=this._contentBoundsNoRotate.width;return new a.Point(e*this._contentSizeNoRotate.x/i,t*this._contentSizeNoRotate.x/i)},viewportToImageCoordinates:function(e,t){if(e instanceof a.Point)return this.viewportToImageCoordinates(e.x,e.y);if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)this.silenceMultiImageWarnings||a.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===i)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(e,t,!0)}return this._viewportToImageDelta(e-this._contentBoundsNoRotate.x,t-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(e,t){var i=this._contentBoundsNoRotate.width;return new a.Point(e/this._contentSizeNoRotate.x*i,t/this._contentSizeNoRotate.x*i)},imageToViewportCoordinates:function(e,t){if(e instanceof a.Point)return this.imageToViewportCoordinates(e.x,e.y);if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)this.silenceMultiImageWarnings||a.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===i)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(e,t,!0)}return(t=this._imageToViewportDelta(e,t)).x+=this._contentBoundsNoRotate.x,t.y+=this._contentBoundsNoRotate.y,t},imageToViewportRectangle:function(e,t,i,n){var r=e;if(r instanceof a.Rect||(r=new a.Rect(e,t,i,n)),this.viewer){var o=this.viewer.world.getItemCount();if(1<o)this.silenceMultiImageWarnings||a.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===o)return this.viewer.world.getItemAt(0).imageToViewportRectangle(e,t,i,n,!0)}return i=this.imageToViewportCoordinates(r.x,r.y),n=this._imageToViewportDelta(r.width,r.height),new a.Rect(i.x,i.y,n.x,n.y,r.degrees)},viewportToImageRectangle:function(e,t,i,n){var r=e;if(r instanceof a.Rect||(r=new a.Rect(e,t,i,n)),this.viewer){var o=this.viewer.world.getItemCount();if(1<o)this.silenceMultiImageWarnings||a.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===o)return this.viewer.world.getItemAt(0).viewportToImageRectangle(e,t,i,n,!0)}return i=this.viewportToImageCoordinates(r.x,r.y),n=this._viewportToImageDelta(r.width,r.height),new a.Rect(i.x,i.y,n.x,n.y,r.degrees)},viewerElementToImageCoordinates:function(e){return e=this.pointFromPixel(e,!0),this.viewportToImageCoordinates(e)},imageToViewerElementCoordinates:function(e){return e=this.imageToViewportCoordinates(e),this.pixelFromPoint(e,!0)},windowToImageCoordinates:function(e){return a.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer."),e=e.minus(a.getElementPosition(this.viewer.element)),this.viewerElementToImageCoordinates(e)},imageToWindowCoordinates:function(e){return a.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(e).plus(a.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(e){return a.Rect.fromSummits(this.pointFromPixel(e.getTopLeft(),!0),this.pointFromPixel(e.getTopRight(),!0),this.pointFromPixel(e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(e){return a.Rect.fromSummits(this.pixelFromPoint(e.getTopLeft(),!0),this.pixelFromPoint(e.getTopRight(),!0),this.pixelFromPoint(e.getBottomLeft(),!0))},windowToViewportCoordinates:function(e){return a.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer."),e=e.minus(a.getElementPosition(this.viewer.element)),this.viewerElementToViewportCoordinates(e)},viewportToWindowCoordinates:function(e){return a.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(e).plus(a.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){if(this.viewer){var t=this.viewer.world.getItemCount();if(1<t)this.silenceMultiImageWarnings||a.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===t)return this.viewer.world.getItemAt(0).viewportToImageZoom(e)}return t=this._contentSizeNoRotate.x,e*(this._containerInnerSize.x/t*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(e){if(this.viewer){var t=this.viewer.world.getItemCount();if(1<t)this.silenceMultiImageWarnings||a.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===t)return this.viewer.world.getItemAt(0).imageToViewportZoom(e)}return e*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped!==e&&(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e})),this}}}(OpenSeadragon),function(y){y.TiledImage=function(e){var t=this,i=(y.console.assert(e.tileCache,"[TiledImage] options.tileCache is required"),y.console.assert(e.drawer,"[TiledImage] options.drawer is required"),y.console.assert(e.viewer,"[TiledImage] options.viewer is required"),y.console.assert(e.imageLoader,"[TiledImage] options.imageLoader is required"),y.console.assert(e.source,"[TiledImage] options.source is required"),y.console.assert(!e.clip||e.clip instanceof y.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),y.EventSource.call(this),this._tileCache=e.tileCache,delete e.tileCache,this._drawer=e.drawer,delete e.drawer,this._imageLoader=e.imageLoader,delete e.imageLoader,e.clip instanceof y.Rect&&(this._clip=e.clip.clone()),delete e.clip,e.x||0),n=(delete e.x,e.y||0),r=(delete e.y,this.normHeight=e.source.dimensions.y/e.source.dimensions.x,this.contentAspectX=e.source.dimensions.x/e.source.dimensions.y,1),o=(e.width?(r=e.width,delete e.width,e.height&&(y.console.error("specifying both width and height to a tiledImage is not supported"),delete e.height)):e.height&&(r=e.height/this.normHeight,delete e.height),e.fitBounds),s=(delete e.fitBounds,e.fitBoundsPlacement||OpenSeadragon.Placement.CENTER),a=(delete e.fitBoundsPlacement,e.degrees||0);delete e.degrees,y.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:y.DEFAULT_SETTINGS.springStiffness,animationTime:y.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:y.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:y.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:y.DEFAULT_SETTINGS.wrapVertical,immediateRender:y.DEFAULT_SETTINGS.immediateRender,blendTime:y.DEFAULT_SETTINGS.blendTime,alwaysBlend:y.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:y.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:y.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:y.DEFAULT_SETTINGS.iOSDevice,debugMode:y.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:y.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:y.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:y.DEFAULT_SETTINGS.placeholderFillStyle,opacity:y.DEFAULT_SETTINGS.opacity,preload:y.DEFAULT_SETTINGS.preload,compositeOperation:y.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:y.DEFAULT_SETTINGS.subPixelRoundingForTransparency},e),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new y.Spring({initial:i,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new y.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new y.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new y.Spring({initial:a,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),o&&this.fitBounds(o,s,!0),this._drawingHandler=function(e){t.viewer.raiseEvent("tile-drawing",y.extend({tiledImage:t},e))}},y.extend(y.TiledImage.prototype,y.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=y.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),i=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(e||t||i||n)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(e){return e?new y.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new y.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return y.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(e){var t,i=this.getBoundsNoRotate(e);return this._clip&&(t=(e?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,t=this._clip.times(t),i=new y.Rect(i.x+t.x,i.y+t.y,t.width,t.height)),i.rotate(this.getRotation(e),this._getRotationPoint(e))},getTileBounds:function(e,t,i){var n=this.source.getNumTiles(e),r=(n.x+t%n.x)%n.x,o=(n.y+i%n.y)%n.y;return e=this.source.getTileBounds(e,r,o),this.getFlip()&&(e.x=1-e.x-e.width),e.x+=(t-r)/n.x,e.y+=this._worldHeightCurrent/this._worldWidthCurrent*((i-o)/n.y),e},getContentSize:function(){return new y.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var e=this.imageToWindowCoordinates(new y.Point(0,0)),t=this.imageToWindowCoordinates(this.getContentSize());return new y.Point(t.x-e.x,t.y-e.y)},_viewportToImageDelta:function(e,t,i){return i=(i?this._scaleSpring.current:this._scaleSpring.target).value,new y.Point(e*(this.source.dimensions.x/i),t*(this.source.dimensions.y*this.contentAspectX/i))},viewportToImageCoordinates:function(e,t,i){e=e instanceof y.Point?(i=t,e):new y.Point(e,t);return e=e.rotate(-this.getRotation(i),this._getRotationPoint(i)),i?this._viewportToImageDelta(e.x-this._xSpring.current.value,e.y-this._ySpring.current.value):this._viewportToImageDelta(e.x-this._xSpring.target.value,e.y-this._ySpring.target.value)},_imageToViewportDelta:function(e,t,i){return i=(i?this._scaleSpring.current:this._scaleSpring.target).value,new y.Point(e/this.source.dimensions.x*i,t/this.source.dimensions.y/this.contentAspectX*i)},imageToViewportCoordinates:function(e,t,i){return e instanceof y.Point&&(i=t,t=e.y,e=e.x),t=this._imageToViewportDelta(e,t),i?(t.x+=this._xSpring.current.value,t.y+=this._ySpring.current.value):(t.x+=this._xSpring.target.value,t.y+=this._ySpring.target.value),t.rotate(this.getRotation(i),this._getRotationPoint(i))},imageToViewportRectangle:function(e,t,i,n,r){var o=e;return o instanceof y.Rect?r=t:o=new y.Rect(e,t,i,n),i=this.imageToViewportCoordinates(o.getTopLeft(),r),n=this._imageToViewportDelta(o.width,o.height,r),new y.Rect(i.x,i.y,n.x,n.y,o.degrees+this.getRotation(r))},viewportToImageRectangle:function(e,t,i,n,r){var o=e;return e instanceof y.Rect?r=t:o=new y.Rect(e,t,i,n),i=this.viewportToImageCoordinates(o.getTopLeft(),r),n=this._viewportToImageDelta(o.width,o.height,r),new y.Rect(i.x,i.y,n.x,n.y,o.degrees-this.getRotation(r))},viewerElementToImageCoordinates:function(e){return e=this.viewport.pointFromPixel(e,!0),this.viewportToImageCoordinates(e)},imageToViewerElementCoordinates:function(e){return e=this.imageToViewportCoordinates(e),this.viewport.pixelFromPoint(e,!0)},windowToImageCoordinates:function(e){return e=e.minus(OpenSeadragon.getElementPosition(this.viewer.element)),this.viewerElementToImageCoordinates(e)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(e){var t=this._scaleSpring.current.value;return e=e.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new y.Rect((e.x-this._xSpring.current.value)/t,(e.y-this._ySpring.current.value)/t,e.width/t,e.height/t,e.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var i=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(i&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y)}else{if(i)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y)}this._needsDraw=!0,i||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},setCroppingPolygons:function(e){try{if(!y.isArray(e))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=e.map(function(e){return e.map(function(e){try{if((t=e)instanceof y.Point||"number"==typeof t.x&&"number"==typeof t.y)return{x:e.x,y:e.y};throw new Error}catch(e){throw new Error("A Provided cropping polygon point is not supported")}var t})})}catch(e){y.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),y.console.error(e),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(e,t,i){t=t||y.Placement.CENTER;var n,r=y.Placement.properties[t],o=this.contentAspectX,s=0,a=0,l=1;t=1,this._clip&&(o=this._clip.getAspectRatio(),l=this._clip.width/this.source.dimensions.x,t=this._clip.height/this.source.dimensions.y,a=e.getAspectRatio()>o?(s=this._clip.x/this._clip.height*e.height,this._clip.y/this._clip.height*e.height):(s=this._clip.x/this._clip.width*e.width,this._clip.y/this._clip.width*e.width)),e.getAspectRatio()>o?(n=e.height/t,t=0,r.isHorizontallyCentered?t=(e.width-e.height*o)/2:r.isRight&&(t=e.width-e.height*o),this.setPosition(new y.Point(e.x-s+t,e.y-a),i),this.setHeight(n,i)):(n=e.width/l,l=0,r.isVerticallyCentered?l=(e.height-e.width/o)/2:r.isBottom&&(l=e.height-e.width/o),this.setPosition(new y.Point(e.x-s,e.y-a+l),i),this.setWidth(n,i))},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(e){y.console.assert(!e||e instanceof y.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),e instanceof y.Rect?this._clip=e.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(e){this.flipped=!!e,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return(e?this._degreesSpring.current:this._degreesSpring.target).value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var i=this._scaleSpring.target.value===e;if(t){if(i&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e)}else{if(i)return;this._scaleSpring.springTo(e)}this._updateForScale(),this._needsDraw=!0,i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,t=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2))));return t=Math.max(t,this.source.minLevel||0),{lowestLevel:Math.min(e,t),highestLevel:t}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;)this.lastDrawn.pop().beingDrawn=!1;var e=this.viewport,t=this._viewportToTiledImageRectangle(e.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var i=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(t=t.intersection(i)))return}for(var n=(i=this._getLevelsInterval()).lowestLevel,r=(i=i.highestLevel,null),o=!1,s=y.now(),a=i;n<=a;a--){var l=!1,h=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(a),!0).x*this._scaleSpring.current.value;if(a===n||!o&&h>=this.minPixelRatio)o=l=!0;else if(!o)continue;var c=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(a),!1).x*this._scaleSpring.current.value,u=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,u=this.immediateRender?1:u,h=Math.min(1,(h-.5)/.5),c=u/Math.abs(u-c),r=this._updateLevel(o,l,a,h,c,t,s,r);if(this._providesCoverage(this.coverage,a))break}this._drawTiles(this.lastDrawn),r&&!r.context2D?(this._loadTile(r,s),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(e,t,i){var n,r=this.wrapHorizontal?(n=y.positiveModulo(t.x,1),y.positiveModulo(i.x,1)):(n=Math.max(0,t.x),Math.min(1,i.x)),o=1/this.source.aspectRatio,s=this.wrapVertical?(a=y.positiveModulo(t.y,o),y.positiveModulo(i.y,o)):(a=Math.max(0,t.y),Math.min(o,i.y)),a=this.source.getTileAtPoint(e,new y.Point(n,a)),s=this.source.getTileAtPoint(e,new y.Point(r,s));return e=this.source.getNumTiles(e),this.wrapHorizontal&&(a.x+=e.x*Math.floor(t.x),s.x+=e.x*Math.floor(i.x)),this.wrapVertical&&(a.y+=e.y*Math.floor(t.y/o),s.y+=e.y*Math.floor(i.y/o)),{topLeft:a,bottomRight:s}},_updateLevel:function(e,t,i,n,r,o,s,a){var l=o.getBoundingBox().getTopLeft(),h=o.getBoundingBox().getBottomRight(),c=(this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:e,level:i,opacity:n,visibility:r,drawArea:o,topleft:l,bottomright:h,currenttime:s,best:a}),this._resetCoverage(this.coverage,i),this._resetCoverage(this.loadingCoverage,i),(h=this._getCornerTiles(i,l,h)).topLeft),u=h.bottomRight,d=this.source.getNumTiles(i),p=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(u.x+=1,this.wrapHorizontal||(u.x=Math.min(u.x,d.x-1)));for(var g,m=c.x;m<=u.x;m++)for(var f=c.y;f<=u.y;f++)g=this.getFlip()?(g=(d.x+m%d.x)%d.x,m+d.x-g-g-1):m,null!==o.intersection(this.getTileBounds(i,g,f))&&(a=this._updateTile(t,e,g,f,i,n,r,p,d,s,a));return a},_updateTile:function(e,t,i,n,r,o,s,a,l,h,c){var u=this._getTile(i,n,r,h,l,this._worldWidthCurrent,this._worldHeightCurrent),l=t;return this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:u}),this._setCoverage(this.coverage,r,i,n,!1),t=u.loaded||u.loading||this._isCovered(this.loadingCoverage,r,i,n),this._setCoverage(this.loadingCoverage,r,i,n,t),u.exists&&(e&&!l&&(this._isCovered(this.coverage,r,i,n)?this._setCoverage(this.coverage,r,i,n,!0):l=!0),l)&&(this._positionTile(u,this.source.tileOverlap,this.viewport,a,s),u.loaded||(u.context2D?this._setTileLoaded(u):(s=this._tileCache.getImageRecord(u.cacheKey))&&(s=s.getImage(),this._setTileLoaded(u,s))),u.loaded?this._blendTile(u,i,n,r,o,h)&&(this._needsDraw=!0):u.loading?this._tilesLoading++:t||(c=this._compareTiles(c,u))),c},_getTile:function(e,t,i,n,r,o,s){var a,l,h,c,u,d,p,g,m,f=this.tilesMatrix,v=this.source;return f[i]||(f[i]={}),f[i][e]||(f[i][e]={}),f[i][e][t]&&!f[i][e][t].flipped==!this.flipped||(a=(r.x+e%r.x)%r.x,l=(r.y+t%r.y)%r.y,h=this.getTileBounds(i,e,t),c=v.getTileBounds(i,a,l,!0),u=v.tileExists(i,a,l),d=v.getTileUrl(i,a,l),m=v.getTilePostData(i,a,l),this.loadTilesWithAjax?(p=v.getTileAjaxHeaders(i,a,l),y.isPlainObject(this.ajaxHeaders)&&(p=y.extend({},this.ajaxHeaders,p))):p=null,g=v.getContext2D?v.getContext2D(i,a,l):void 0,m=new y.Tile(i,e,t,h,u,d,g,this.loadTilesWithAjax,p,c,m,v.getTileHashKey(i,a,l,d,p,m)),this.getFlip()?0==a&&(m.isRightMost=!0):a==r.x-1&&(m.isRightMost=!0),l==r.y-1&&(m.isBottomMost=!0),m.flipped=this.flipped,f[i][e][t]=m),(m=f[i][e][t]).lastTouchTime=n,m},_loadTile:function(n,r){var o=this;n.loading=!0,this._imageLoader.addJob({src:n.url,postData:n.postData,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(e,t,i){o._onTileLoad(n,r,e,t,i)},abort:function(){n.loading=!1}})},_onTileLoad:function(t,e,i,n,r){function o(){var e=s.source.getClosestLevel();s._setTileLoaded(t,i,e,r)}var s;i?e<this.lastResetTime?(y.console.warn("Ignoring tile %s loaded before reset: %s",t,t.url),t.loading=!1):(s=this)._midDraw?window.setTimeout(o,1):o():(y.console.error("Tile %s failed to load: %s - error: %s",t,t.url,n),this.viewer.raiseEvent("tile-load-failed",{tile:t,tiledImage:this,time:e,message:n,tileRequest:r}),t.loading=!1,t.exists=!1)},_setTileLoaded:function(e,t,i,n){var r=0,o=this;function s(){return r++,a}function a(){0==--r&&(e.loading=!1,e.loaded=!0,e.context2D||o._tileCache.cacheTile({image:t,tile:e,cutoff:i,tiledImage:o}),o._needsDraw=!0)}this.viewer.raiseEvent("tile-loaded",{tile:e,tiledImage:this,tileRequest:n,image:t,getCompletionCallback:s}),s()()},_positionTile:function(e,t,i,n,r){(a=e.bounds.getTopLeft()).x*=this._scaleSpring.current.value,a.y*=this._scaleSpring.current.value,a.x+=this._xSpring.current.value,a.y+=this._ySpring.current.value;(l=e.bounds.getSize()).x*=this._scaleSpring.current.value,l.y*=this._scaleSpring.current.value;var o=i.pixelFromPointNoRotate(a,!0),s=i.pixelFromPointNoRotate(a,!1),a=i.deltaPixelsFromPointsNoRotate(l,!0),l=i.deltaPixelsFromPointsNoRotate(l,!1),l=s.plus(l.divide(2)),l=n.squaredDistanceTo(l);t||(a=a.plus(new y.Point(1,1))),e.isRightMost&&this.wrapHorizontal&&(a.x+=.75),e.isBottomMost&&this.wrapVertical&&(a.y+=.75),e.position=o,e.size=a,e.squaredDistance=l,e.visibility=r},_blendTile:function(e,t,i,n,r,o){var s,a=1e3*this.blendTime;if(e.blendStart||(e.blendStart=o),s=o-e.blendStart,o=a?Math.min(1,s/a):1,this.alwaysBlend&&(o*=r),e.opacity=o,this.lastDrawn.push(e),1===o)this._setCoverage(this.coverage,n,t,i,!0),this._hasOpaqueTile=!0;else if(s<a)return!0;return!1},_compareTiles:function(e,t){return!e||t.visibility>e.visibility||t.visibility===e.visibility&&t.squaredDistance<e.squaredDistance?t:e},_drawTiles:function(e){if(0!==this.opacity&&(0!==e.length||this.placeholderFillStyle)){var t,i,n,r,o,s=e[0],a=(s&&(t=this.opacity<1||this.compositeOperation&&"source-over"!==this.compositeOperation||!this._isBottomItem()&&s._hasTransparencyChannel()),this.viewport.getZoom(!0)),l=this.viewportToImageZoom(a);if(1<e.length&&l>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360==0&&y.supportsCanvas&&this.viewer.useCanvas&&(t=!0,i=s.getScaleForEdgeSmoothing(),n=s.getTranslationForEdgeSmoothing(i,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0))),t&&(i||(r=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),!this._drawer.viewer.viewport.getFlip()||0===this.viewport.degrees&&this.getRotation(!0)%360==0||(r.x=this._drawer.viewer.container.clientWidth-(r.x+r.width)),r=r.times(y.pixelDensityRatio)),this._drawer._clear(!0,r)),i||(0!==this.viewport.degrees&&this._drawer._offsetForRotation({degrees:this.viewport.degrees,useSketch:t}),this.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:t}),0===this.viewport.degrees&&this.getRotation(!0)%360==0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip()),a=!1,this._clip&&(this._drawer.saveContext(t),l=(l=this.imageToViewportRectangle(this._clip,!0)).rotate(-this.getRotation(!0),this._getRotationPoint(!0)),l=this._drawer.viewportToDrawerRectangle(l),i&&(l=l.times(i)),n&&(l=l.translate(n)),this._drawer.setClip(l,t),a=!0),this._croppingPolygons){this._drawer.saveContext(t);try{var h=this._croppingPolygons.map(function(e){return e.map(function(e){return e=this.imageToViewportCoordinates(e.x,e.y,!0).rotate(-this.getRotation(!0),this._getRotationPoint(!0)),e=this._drawer.viewportCoordToDrawerCoord(e),i?e.times(i):e})});this._drawer.clipWithPolygons(h,t)}catch(e){y.console.error(e)}a=!0}this.placeholderFillStyle&&!1===this._hasOpaqueTile&&(h=this._drawer.viewportToDrawerRectangle(this.getBounds(!0)),i&&(h=h.times(i)),n&&(h=h.translate(n)),o=null,o="function"==typeof this.placeholderFillStyle?this.placeholderFillStyle(this,this._drawer.context):this.placeholderFillStyle,this._drawer.drawRectangle(h,o,t));var c=!1;(o="number"==typeof(l=this.subPixelRoundingForTransparency)?g(l):l&&y.Browser?g(h=p(h=l[y.Browser.vendor])?l["*"]:h):d)===y.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS?c=!0:o===y.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&(c=!(this.viewer&&this.viewer.isAnimating()));for(var u=e.length-1;0<=u;u--)s=e[u],this._drawer.drawTile(s,this._drawingHandler,t,i,n,c),s.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:s});a&&this._drawer.restoreContext(t),i||(this.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(t),0!==this.viewport.degrees&&this._drawer._restoreRotationChanges(t)),t&&(i&&(0!==this.viewport.degrees&&this._drawer._offsetForRotation({degrees:this.viewport.degrees,useSketch:!1}),this.getRotation(!0)%360!=0)&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1}),this._drawer.blendSketch({opacity:this.opacity,scale:i,translate:n,compositeOperation:this.compositeOperation,bounds:r}),i)&&(this.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(!1),0!==this.viewport.degrees)&&this._drawer._restoreRotationChanges(!1),i||0===this.viewport.degrees&&this.getRotation(!0)%360==0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(e)}},_drawDebugInfo:function(e){if(this.debugMode)for(var t=e.length-1;0<=t;t--){var i=e[t];try{this._drawer.drawDebugInfo(i,e.length,t,this)}catch(e){y.console.error(e)}}},_providesCoverage:function(e,t,i,n){var r,o,s,a;if(!e[t])return!1;if(void 0!==i&&void 0!==n)return void 0===e[t][i]||void 0===e[t][i][n]||!0===e[t][i][n];for(s in r=e[t])if(Object.prototype.hasOwnProperty.call(r,s))for(a in o=r[s])if(Object.prototype.hasOwnProperty.call(o,a)&&!o[a])return!1;return!0},_isCovered:function(e,t,i,n){return void 0===i||void 0===n?this._providesCoverage(e,t+1):this._providesCoverage(e,t+1,2*i,2*n)&&this._providesCoverage(e,t+1,2*i,2*n+1)&&this._providesCoverage(e,t+1,2*i+1,2*n)&&this._providesCoverage(e,t+1,2*i+1,2*n+1)},_setCoverage:function(e,t,i,n,r){e[t]?(e[t][i]||(e[t][i]={}),e[t][i][n]=r):y.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",t)},_resetCoverage:function(e,t){e[t]={}}});var d=y.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function p(e){return e!==y.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&e!==y.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&e!==y.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function g(e){return p(e)?d:e}}(OpenSeadragon),function(g){function m(e){g.console.assert(e,"[TileCache.cacheTile] options is required"),g.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),g.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=e.tile,this.tiledImage=e.tiledImage}function f(e){g.console.assert(e,"[ImageRecord] options is required"),g.console.assert(e.image,"[ImageRecord] options.image is required"),this._image=e.image,this._tiles=[]}f.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){var e;return this._renderedContext||((e=document.createElement("canvas")).width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null),this._renderedContext},setRenderedContext:function(e){g.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=e},addTile:function(e){g.console.assert(e,"[ImageRecord.addTile] tile is required"),this._tiles.push(e)},removeTile:function(e){for(var t=0;t<this._tiles.length;t++)if(this._tiles[t]===e)return void this._tiles.splice(t,1);g.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",e)},getTileCount:function(){return this._tiles.length}},g.TileCache=function(e){this._maxImageCacheCount=(e=e||{}).maxImageCacheCount||g.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},g.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(e){g.console.assert(e,"[TileCache.cacheTile] options is required"),g.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),g.console.assert(e.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),g.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var t=e.cutoff||0,i=this._tilesLoaded.length,n=this._imagesLoaded[e.tile.cacheKey];if(n||(g.console.assert(e.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),n=this._imagesLoaded[e.tile.cacheKey]=new f({image:e.image}),this._imagesLoadedCount++),n.addTile(e.tile),e.tile.cacheImageRecord=n,this._imagesLoadedCount>this._maxImageCacheCount){for(var r,o,s,a,l,h,c=null,u=-1,d=null,p=this._tilesLoaded.length-1;0<=p;p--)(r=(h=this._tilesLoaded[p]).tile).level<=t||r.beingDrawn||(!c||(a=r.lastTouchTime,o=c.lastTouchTime,l=r.level,s=c.level,a<o)||a===o&&s<l)&&(c=r,u=p,d=h);c&&0<=u&&(this._unloadTile(d),i=u)}this._tilesLoaded[i]=new m({tile:e.tile,tiledImage:e.tiledImage})},clearTilesFor:function(e){var t;g.console.assert(e,"[TileCache.clearTilesFor] tiledImage is required");for(var i=0;i<this._tilesLoaded.length;++i)(t=this._tilesLoaded[i]).tiledImage===e&&(this._unloadTile(t),this._tilesLoaded.splice(i,1),i--)},getImageRecord:function(e){return g.console.assert(e,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[e]},_unloadTile:function(e){g.console.assert(e,"[TileCache._unloadTile] tileRecord is required");var t=e.tile,i=e.tiledImage;t.unload(),t.cacheImageRecord=null,(e=this._imagesLoaded[t.cacheKey]).removeTile(t),e.getTileCount()||(e.destroy(),delete this._imagesLoaded[t.cacheKey],this._imagesLoadedCount--),i.viewer.raiseEvent("tile-unloaded",{tile:t,tiledImage:i})}}}(OpenSeadragon),function(g){g.World=function(e){var t=this;g.console.assert(e.viewer,"[World] options.viewer is required"),g.EventSource.call(this),this.viewer=e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(e){t._autoRefigureSizes?t._figureSizes():t._needsSizesFigured=!0},this._figureSizes()},g.extend(g.World.prototype,g.EventSource.prototype,{addItem:function(e,t){g.console.assert(e,"[World.addItem] item is required"),g.console.assert(e instanceof g.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(t=t||{}).index?(t=Math.max(0,Math.min(this._items.length,t.index)),this._items.splice(t,0,e)):this._items.push(e),this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,e.addHandler("bounds-change",this._delegatedFigureSizes),e.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:e})},getItemAt:function(e){return g.console.assert(void 0!==e,"[World.getItemAt] index is required"),this._items[e]},getIndexOfItem:function(e){return g.console.assert(e,"[World.getIndexOfItem] item is required"),g.indexOf(this._items,e)},getItemCount:function(){return this._items.length},setItemIndex:function(e,t){g.console.assert(e,"[World.setItemIndex] item is required"),g.console.assert(void 0!==t,"[World.setItemIndex] index is required");var i=this.getIndexOfItem(e);if(t>=this._items.length)throw new Error("Index bigger than number of layers.");t!==i&&-1!==i&&(this._items.splice(i,1),this._items.splice(t,0,e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:e,previousIndex:i,newIndex:t}))},removeItem:function(e){g.console.assert(e,"[World.removeItem] item is required");var t=g.indexOf(this._items,e);-1!==t&&(e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy(),this._items.splice(t,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(e))},removeAll:function(){var e,t;for(this.viewer._cancelPendingImages(),t=0;t<this._items.length;t++)(e=this._items[t]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<i.length;t++)e=i[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){(this._autoRefigureSizes=e)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(e){var t,i,n,r=(e=e||{}).immediately||!1,o=e.layout||g.DEFAULT_SETTINGS.collectionLayout,s=e.rows||g.DEFAULT_SETTINGS.collectionRows,a=e.columns||g.DEFAULT_SETTINGS.collectionColumns,l=e.tileSize||g.DEFAULT_SETTINGS.collectionTileSize,h=l+(e.tileMargin||g.DEFAULT_SETTINGS.collectionTileMargin),c=!e.rows&&a?a:Math.ceil(this._items.length/s),u=0,d=0;this.setAutoRefigureSizes(!1);for(var p=0;p<this._items.length;p++)p&&p%c==0&&("horizontal"===o?(d+=h,u=0):(u+=h,d=0)),n=(i=(n=(t=this._items[p]).getBounds()).width>n.height?l:l*(n.width/n.height))*(n.height/n.width),n=new g.Point(u+(l-i)/2,d+(l-n)/2),t.setPosition(n,r),t.setWidth(i,r),"horizontal"===o?u+=h:d+=h;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var e=this._homeBounds?this._homeBounds.clone():null,t=this._contentSize?this._contentSize.clone():null,i=this._contentFactor||0;if(this._items.length){for(var n=this._items[0],r=n.getBounds(),o=(this._contentFactor=n.getContentSize().x/r.width,n.getClippedBounds().getBoundingBox()),s=o.x,a=o.y,l=o.x+o.width,h=o.y+o.height,c=1;c<this._items.length;c++)r=(n=this._items[c]).getBounds(),this._contentFactor=Math.max(this._contentFactor,n.getContentSize().x/r.width),o=n.getClippedBounds().getBoundingBox(),s=Math.min(s,o.x),a=Math.min(a,o.y),l=Math.max(l,o.x+o.width),h=Math.max(h,o.y+o.height);this._homeBounds=new g.Rect(s,a,l-s,h-a),this._contentSize=new g.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new g.Rect(0,0,1,1),this._contentSize=new g.Point(1,1),this._contentFactor=1;this._contentFactor===i&&this._homeBounds.equals(e)&&this._contentSize.equals(t)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(OpenSeadragon),function(e){function i(e){return e?Array.prototype.slice.call(e):[]}e.$=function(e,t){return t||0!==e.indexOf("#")?(t||document).querySelector(e):document.getElementById(e.substr(1,e.length))},e.$$=function(e,t){return i((t||document).querySelectorAll(e))},e.ff={toArray:i}}(this),function(F){var n,r,H,t,a=F,s=document,i=s.documentElement,e=s.body,o=$("#header"),l=$("#main"),h=$(".page",l),A=!1,c=!1,N=0;function M(){r=a.innerHeight,H=a.innerWidth,n=o?o.offsetHeight:0,j()}function j(){var e=a.pageYOffset||i.scrollTop;A=e<t,t=e}setTimeout(function(){i.classList.add("is-js-init")},400),M();var u;void 0!==(L=document.createElement("a").style)[z="webkitTransform"]&&(u=z),void 0!==L[z="msTransform"]&&(u=z),void 0!==L[z="transform"]&&(u=z);var W=[];function d(e,t){W.push({selector:e,callback:t})}e.addEventListener("click",function(t){t.ctrlKey||W.forEach(function(e){t.target&&t.target.matches(e.selector+", "+e.selector+" *")&&(t.stopPropagation(),e.callback(t,t.target.closest(e.selector)))})},!1);var p=!1;function g(){i.classList.contains("is-menu-open")&&(p&&a.clearTimeout(p),i.classList.remove("is-scrollBlocked"),$('.header_btn [aria-controls="primaryNav"]').setAttribute("aria-expanded","false"),$("#primaryNav").setAttribute("aria-hidden","true"),i.scrollTop=N,a.setTimeout(function(){i.classList.remove("is-menu-open"),i.classList.remove("is-nav-hide")},50))}function U(e,t){e&&e.preventDefault(),g(),(t.matches('[aria-expanded="true"]')?m:(i.classList.contains("is-panel-open")&&m(),V))(t.getAttribute("aria-controls"))}function m(e){var t;i.classList.contains("is-panel-open")&&(t=!!(e=e?$('.js-panel-toggle[aria-controls="'+e+'"][aria-expanded="true"]'):$('.js-panel-toggle[aria-controls][aria-expanded="true"]'))&&$("#"+e.getAttribute("aria-controls")),i.classList.remove("is-panel-open"),e&&e.setAttribute("aria-expanded","false"),t)&&t.setAttribute("aria-hidden","true")}function V(e){var t=$("#"+e),e=$('.js-panel-toggle[aria-controls="'+e+'"]');e&&t&&(i.classList.add("is-panel-open"),e.setAttribute("aria-expanded","true"),t.setAttribute("aria-hidden","false"))}$("#primaryNav").setAttribute("aria-hidden","true"),d(".js-nav-open",function(e){e.preventDefault(),m(),i.classList.contains("is-menu-open")?g():i.classList.contains("is-menu-open")||(p&&a.clearTimeout(p),N=t,i.classList.add("is-menu-open"),$('.header_btn [aria-controls="primaryNav"]').setAttribute("aria-expanded","true"),$("#primaryNav").setAttribute("aria-hidden","false"),p=a.setTimeout(function(){i.classList.add("is-scrollBlocked")},100))}),d(".js-nav-close",function(e){e.preventDefault(),g()}),d(".js-panel-toggle[aria-controls]",U),d(".js-panel-close",function(e,t){U(e,$('.js-panel-toggle[aria-controls="'+t.closest('[aria-modal="true"], [role="dialog"]').id+'"]'))});var G=parseInt(a.getComputedStyle(e,null).getPropertyValue("font-size")),f=G;function v(){X(),te(),24<=f?$(".js-settings-size-inc").setAttribute("disabled","disabled"):$(".js-settings-size-inc").removeAttribute("disabled"),f<=12?$(".js-settings-size-dec").setAttribute("disabled","disabled"):$(".js-settings-size-dec").removeAttribute("disabled")}function q(e){e&&e.preventDefault(),i.style.removeProperty("--text-font-size"),f=G,v(),i.removeAttribute("data-theme-color"),$('input[name="color-theme-radios"][value="light"]',o).checked=!0}d(".js-settings-size-dec",function(e){e&&e.preventDefault();--f,i.style.setProperty("--text-font-size",f+"px"),v()}),d(".js-settings-size-inc",function(e){e&&e.preventDefault();f+=1,i.style.setProperty("--text-font-size",f+"px"),v()}),$$('input[name="color-theme-radios"]',o).forEach(function(e){e.addEventListener("change",function(e){"dark"==this.value?i.setAttribute("data-theme-color","dark"):i.removeAttribute("data-theme-color")},!1)}),d(".js-settings-reset",q),q();var y=$(".page_nav",l),Q=$(".page_content",l);var Z,w=0;function X(){var i=$$(".note",l),n=$(".page_content",l);i.forEach(function(e,t){0!==t&&(e.style[u]="",e.getBoundingClientRect().top<i[t-1].getBoundingClientRect().top+i[t-1].offsetHeight&&(e.style[u]="translateY("+(i[t-1].getBoundingClientRect().top+i[t-1].offsetHeight-e.getBoundingClientRect().top)+"px)"),n)&&t===i.length-1&&(n.style.marginBottom="",e.getBoundingClientRect().top+e.offsetHeight>n.getBoundingClientRect().top+n.offsetHeight)&&(n.style.marginBottom=e.getBoundingClientRect().top+e.offsetHeight-n.getBoundingClientRect().top-n.offsetHeight+"px")})}$$(".js-acc",l).forEach(function(e){var t,i=e.firstElementChild,e=e.lastElementChild,n="acc-btn-"+w,r="acc-content-"+w;i&&e&&((t=$("a",i))?(t.classList.add("js-acc-trigger"),t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls",r),t.id=n):(t=i.className,i.className="",i.innerHTML='<button type="button" aria-expanded="false" class="js-acc-trigger '+t+'" aria-controls="'+r+'" id="'+n+'">'+i.innerHTML+"</button>"),e.setAttribute("aria-hidden","true"),e.setAttribute("aria-labelledby",n),e.id=r,e.classList.add("js-acc-content"),w++)}),d(".js-acc-trigger[aria-expanded][aria-controls]",function(e,t){e&&e.preventDefault();e=$("#"+t.getAttribute("aria-controls"));"true"==t.getAttribute("aria-expanded")?(t.setAttribute("aria-expanded","false"),e.setAttribute("aria-hidden","true")):(t.setAttribute("aria-expanded","true"),e.setAttribute("aria-hidden","false"))}),d('.page_content a[href^="#note-"]:not([href^="#note-p"])',function(e,t){var i=$(".page_infos #notes .js-acc-content",l);i&&i.matches('[aria-hidden="true"]')&&!function(e){var t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:F});e.dispatchEvent(t)}($(".page_infos #notes .js-acc-trigger",l))}),$$('a[href^="#note-"][id^="note-anchor-"]',ae||l).forEach(function(e){var t,i=$(e.getAttribute("href"));e.setAttribute("aria-hidden","true"),i&&(i=i.parentNode.innerHTML,(t=s.createElement("small")).classList.add("note"),t.innerHTML=i,$("*"+e.getAttribute("href"),t).outerHTML=e.outerHTML,$('[href^="#note-anchor-"]',t).remove(),$('[id^="note-anchor-"]',t).setAttribute("aria-label","Voir la note en fin d’article"),$('[id^="note-anchor-"]',t).removeAttribute("id"),e.after(t))}),d('.page_content a[href^="#note-p"], .page_content a[href^="#note-p"] + .note',function(e,t){e&&e.preventDefault();var i,e=t.matches(".note")?t:t.nextElementSibling,t=t.matches("a")?t.href:!!t.previousElementSibling&&t.previousElementSibling.href;e&&e.matches(".note")&&(i=$(".note.is-open",l),e.classList.toggle("is-open"),i&&i!=e&&i.classList.remove("is-open"),t)&&support.history&&e.classList.contains("is-open")&&history.replaceState({},"",t)}),$$('.note[id^="note-p"]',Z||l).forEach(function(e){var t=s.createElement("a"),i=$(".note_label",e);t.setAttribute("aria-hidden","true"),t.setAttribute("href","#"+e.id),t.id=e.id,e.removeAttribute("id"),t.innerHTML=i?i.innerHTML:"1",e.before(t)});var x=!1,T=!1,S=!1;function Y(e,t){T&&x&&S&&(S.classList.contains("is-open")?E():T&&x&&S&&!S.classList.contains("is-open")&&(x.setAttribute("aria-expanded","false"),T.setAttribute("aria-hidden","true"),S.classList.add("is-open")))}function E(){T&&x&&S&&S.classList.contains("is-open")&&(x.setAttribute("aria-expanded","true"),T.setAttribute("aria-hidden","false"),S.classList.remove("is-open"))}x=$(".side_trigger button",l),T=$("#side-summary"),S=!!T&&T.parentNode,x&&T&&S&&(d(".side_trigger button",Y),summaryTriggerInitialText=x.innerHTML,x.setAttribute("aria-haspopup","true"),x.setAttribute("aria-controls","side-summary"),x.setAttribute("aria-expanded","false"),T.setAttribute("aria-hidden","true"),T.setAttribute("aria-modal","true"),T.setAttribute("role","dialog"),T.setAttribute("aria-labelledby","summarySideTitle")),d('.side_inner a[href^="#"]',function(){T&&S&&S.classList.contains("is-open")&&Math.abs(H-T.clientWidth)<10&&E()});var b,_=[],K=!1,J=[],P=!1;function ee(){var i,e;_.length&&(e=i=!1,_.forEach(function(e,t){e.getBoundingClientRect().top<=.8*r&&e.getBoundingClientRect().top+e.clientHeight>=n&&(i=e)}),K!=i)&&(i&&(e=$(".plates",i)),P&&P.classList.remove("is-visible"),e&&(C(e),e.classList.add("is-visible")),K=i,P=e)}function C(e){var t,i,n,r,o,e=$(".plates_figs",e),s=$$(".plates_fig",e);s.length&&(t=s.length?parseInt(a.getComputedStyle(s[0],null).getPropertyValue("border-left-width")):0,i=e.clientWidth-1,e=e.clientHeight-1,o=r=!(n=1.496),1<s.length?e<2*((i/2-2*t)*n+2*t)?r=((o=e/2)-2*t)/n+2*t:o=((r=i/2)-2*t)*n+2*t:1==s.length&&(e<(i-2*t)*n+2*t?r=((o=e)-2*t)/n+2*t:o=((r=i)-2*t)*n+2*t),s.forEach(function(e){e.style.height=o?Math.floor(o)+"px":"",e.style.width=r?Math.floor(r)+"px":""}))}function te(){P&&C(P)}(b=$$(".txt_plate[data-views]:not(.txt_plate[data-views] ~ .txt_plate[data-views])",b||l).map(function(e){return e.closest(".page_chapter")})).length&&b.forEach(function(e,t){var i,n,r,o;e=e,(o=$$(".txt_plate[data-views]",e)).length&&(i=s.createElement("div"),n="",r=[],i.classList.add("plates"),o.forEach(function(i){i.getAttribute("data-views").split(",").forEach(function(e,t){r.push({src:apiURL+bookID+e+"/full/1000,/0/native.jpg",lgd:i.hasAttribute("data-lgd"+(t+1))?i.getAttribute("data-lgd"+(t+1)):0===t&&i.hasAttribute("data-lgd")?i.getAttribute("data-lgd"):""})})}),r=r.slice(0,4),i.classList.remove("plates-1"),i.classList.remove("plates-2"),i.classList.remove("plates-3"),i.classList.remove("plates-4"),i.classList.add("plates-"+r.length),n+='<div class="plates_inner"><div class="plates_figs">',r.forEach(function(e){n+='<figure class="plates_fig"><img src="'+e.src+'" alt=""><button class="viewer_trigger" type="button"><span class="icon-zoom_in"></span><span class="srOnly">Voir dans la visionneuse</span></button><figcaption class="srOnly">'+e.lgd+"</figcaption></figure>"}),n+='</div><div class="plates_lgds" aria-hidden="true">',r.forEach(function(e){n+=e.lgd&&""!==e.lgd?'<div class="plates_lgd">'+e.lgd+"</div>":""}),n+="</div></div>",i.innerHTML=n,e.append(i),C(i),J.push(i))}),_=$$(".plates",l).map(function(e){return e.closest(".page_chapter")}),ee();var R,k=!1,D=!1;function ie(e){k&&D&&(e&&e.preventDefault(),D.close())}(R=$$(".illusTab_i img, .figure_img",R||l)).forEach(function(e){e.insertAdjacentHTML("afterend",'<button class="viewer_trigger" type="button"><span class="icon-zoom_in"></span><span class="srOnly">Voir dans la visionneuse</span></button>')}),R.length&&((k=s.createElement("div")).setAttribute("aria-hidden","true"),k.classList.add("viewer"),k.innerHTML='<button type="button" class="viewer_close"><span class="icon-clear"></span></button><div class="viewer_panel" data-panel-name="infos"><button type="button" class="viewer_panelClose"><span class="icon-clear"></span></button><div class="viewer_panelInner txt txt-xs"></div></div><div class="viewer_nav"><button type="button" class="viewer_btn viewer_btn-infos"><span class="icon-info"></span></button><button type="button" class="viewer_btn viewer_btn-zoom_in" id="viewer-zoom-in"><span class="icon-zoom_in"></span></button><button type="button" class="viewer_btn viewer_btn-zoom_out" id="viewer-zoom-out"><span class="icon-zoom_out"></span></button><button type="button" class="viewer_btn viewer_btn-rotate" id="viewer-rotate-left"><span class="icon-rotate_left"></span></button><a href="#" class="viewer_btn viewer_btn-dl" target="_blank"><span class="icon-vertical_align_bottom"></span></a></div><div class="viewer_navigator" id="viewer-navigator"></div>',e.append(k),(D=OpenSeadragon({element:k,viewportMargins:{left:40,top:40,right:40,bottom:40},showHomeControl:!1,showFullPageControl:!1,zoomInButton:"viewer-zoom-in",zoomOutButton:"viewer-zoom-out",rotateLeftButton:"viewer-rotate-left",showRotationControl:!0,gestureSettingsTouch:{pinchRotate:!0},showNavigator:!0,navigatorId:"viewer-navigator",navigatorOpacity:1,navigatorBorderColor:"#000",navigatorDisplayRegionColor:"#979797"})).addHandler("open",function(e){k.classList.add("is-open")}),D.addHandler("close",function(e){k.classList.remove("is-open"),k.classList.remove("has-panel-infos-open")})),d(".viewer_trigger",function(e,t){e&&e.preventDefault();var i,n;k&&(e=t.previousElementSibling)&&e.matches("img[src]")&&(t=e,k)&&D&&(e=t.getAttribute("src"),n=function(e){var t=!1;-1!==e.indexOf(apiURL+bookID)&&(t=(t=(t=e.replace(apiURL+bookID,"")).split("/"))[0]);return t}(e),i=n?apiURL+bookID+n+"/info.json":{type:"image",url:e,buildPyramid:!1},n=n?apiURL+bookID+n+"/full/full/0/native.jpg":e,t=!!(e=t.closest("figure"))&&$("figcaption",e),$(".viewer_btn-dl",k).setAttribute("href",n),$('.viewer_panel[data-panel-name="infos"] .viewer_panelInner',k).innerHTML=t?"<p>"+t.innerHTML+"</p>":"",D.open(i))}),d(".viewer_close",ie),d(".viewer_btn-infos",function(e){e&&e.preventDefault();k.classList.toggle("has-panel-infos-open")}),d('.viewer_panel[data-panel-name="infos"] .viewer_panelClose',function(e){e&&e.preventDefault();k.classList.remove("has-panel-infos-open")});var O=!1,I=!1,L=(fetch("./index.json").then(e=>e.json()).then(e=>{e&&e.length&&(O={},I=lunr(function(){this.use(lunr.fr),this.ref("link"),this.field("title"),this.field("body"),e.forEach(function(e){this.add(e),O[e.link]=e},this)}))}),$(".search_form")),z=$("#search-query"),ne=$(".search_results");L.addEventListener("submit",function(e){e.preventDefault()}),z.addEventListener("input",function(e){var t,i;ne.innerHTML="",O&&I&&(t=[],(i="")!=this.value&&((t=I.search(unicodeNormalizer(this.value))).length?(i+='<p class="search_resultsNb f1-14 op-50 txt-r">'+t.length+" "+(1<t.length?"résultats":"résultat")+"</p>",t.forEach(function(e){O[e.ref]&&(i=(i=(i+='<article class="search_i resultItem">')+(O[e.ref].type?'<p class="resultItem_type f1-14 op-50">'+O[e.ref].type+"</p>":""))+'<p class="resultItem_t f1-18"><a href="'+O[e.ref].link+'">'+O[e.ref].title+"</a></p></article>")},this)):i+='<p class="search_resultsNb f1-14 op-50 txt-r">0 résultat</p>'),ne.innerHTML=i)}),s.addEventListener("keydown",function(e){27==e.keyCode&&(D&&D.isOpen()?ie:i.classList.contains("is-menu-open")?g:i.classList.contains("is-panel-open")?m:E)()}),a.addEventListener("resize",function(){M()},!1);re=function(){(!c||250<Math.abs(c-r))&&(c=r,i.style.setProperty("--vh",r+"px")),X(),te()},oe=300;var re,oe,se,B,ae=function(){var e=this,t=arguments,i=se&&!B;clearTimeout(B),B=setTimeout(function(){B=null,se||re.apply(e,t)},oe),i&&re.apply(e,t)},le=(a.addEventListener("resize",ae,!1),ae(),!1);function he(){le=!1,A||t<n?i.classList.remove("is-nav-hide"):(m(),i.classList.add("is-nav-hide")),h&&y&&Q&&(Q.getBoundingClientRect().top<n&&h.getBoundingClientRect().top+h.clientHeight>y.clientHeight+n?y.classList.add("is-fixed"):y.classList.remove("is-fixed")),ee()}a.addEventListener("scroll",function(){j(),le||(le=!0,a.requestAnimationFrame(he))},!1)}(window);